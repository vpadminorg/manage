import{d as W,r as m,a0 as j,$ as ce,b as ue,a1 as me,o as E,c as pe,j as e,k as l,w as f,x as O,e as t,t as z,y as _,Y as fe,a2 as ge,m as S,Z as _e,T as ve,n as G,G as ye,I as be,a3 as he,W as Ce,v as we}from"./index-_v2uieGc.js";import{E as ke}from"./el-input-number-CpYWFrA0.js";/* empty css                */import"./el-checkbox-C6h3hzMD.js";import{E as Ee}from"./el-tree-select-lk2_rJZl.js";/* empty css                */import{E as Ve,a as Ne}from"./el-table-column-Q2QHI77F.js";/* empty css               */import{_ as Ie}from"./index-Bi2yoGwv.js";/* empty css               */import{E as Te,a as Re}from"./el-form-item-BZcdB44L.js";import{l as M,g as Se,u as Fe,a as Ue,d as qe}from"./index-C4xAmeYd.js";import{E as $e}from"./index-7OoO_SlU.js";import{E as xe}from"./index-DJNwvRpE.js";import{E as Ae}from"./index-ctcZQfix.js";import"./index-D4mmW5IN.js";import"./index-BFoUAo4m.js";import"./_initCloneObject-DMl0_0C4.js";import"./_baseClone-Cj6s47u0.js";const De={class:"p-2"},Pe={class:"search"},Be={class:"dialog-footer"},Le=W({name:"Category"}),sa=W({...Le,setup(Ke){const{proxy:r}=ve(),V=m([]),N=m([]),y=m(!1),b=m(!0),h=m(!0),p=m(!1),F=m(),I=m(),U=m(),d=j({visible:!1,title:""}),q={id:void 0,categoryName:void 0,categoryCode:void 0,parentId:void 0,sortNum:0},Y=j({form:{...q},queryParams:{pageNum:1,pageSize:10,categoryName:void 0,categoryCode:void 0},rules:{id:[{required:!0,message:"主键不能为空",trigger:"blur"}],categoryName:[{required:!0,message:"分类名称不能为空",trigger:"blur"}],categoryCode:[{required:!0,message:"分类编码不能为空",trigger:"blur"}],parentId:[{required:!0,message:"父级id不能为空",trigger:"blur"}]}}),{queryParams:g,form:s,rules:Z}=ce(Y),v=async()=>{p.value=!0;const o=await M(g.value),a=r==null?void 0:r.handleTree(o.data,"id","parentId");a&&(V.value=a,p.value=!1)},$=async()=>{const o=await M();N.value=[];const a={id:0,categoryName:"顶级节点",children:[]};a.children=r==null?void 0:r.handleTree(o.data,"id","parentId"),N.value.push(a)},H=()=>{T(),d.visible=!1},T=()=>{var o;s.value={...q},(o=I.value)==null||o.resetFields()},C=()=>{v()},J=()=>{var o;(o=F.value)==null||o.resetFields(),C()},x=o=>{d.visible=!0,d.title="添加流程分类",G(()=>{T(),$(),o!=null&&o.id?s.value.parentId=o.id:s.value.parentId=0})},X=()=>{h.value=!h.value,A(V.value,h.value)},A=(o,a)=>{o.forEach(c=>{var i;(i=U.value)==null||i.toggleRowExpansion(c,a),c.children&&c.children.length>0&&A(c.children,a)})},ee=o=>{p.value=!0,d.visible=!0,d.title="修改流程分类",G(async()=>{T(),await $(),o!=null&&(s.value.parentId=o.id);const a=await Se(o.id);p.value=!1,Object.assign(s.value,a.data)})},ae=()=>{I.value.validate(async o=>{o&&(y.value=!0,s.value.id?await Fe(s.value).finally(()=>y.value=!1):await Ue(s.value).finally(()=>y.value=!1),r==null||r.$modal.msgSuccess("操作成功"),d.visible=!1,await v())})},le=async o=>{await(r==null?void 0:r.$modal.confirm('是否确认删除流程分类编号为"'+o.id+'"的数据项？')),p.value=!0,await qe(o.id).finally(()=>p.value=!1),await v(),r==null||r.$modal.msgSuccess("删除成功")};return ue(()=>{v()}),(o,a)=>{var L,K;const c=ye,i=Te,u=be,D=Re,P=$e,te=Ie,oe=xe,w=Ve,R=he,ne=Ne,re=Ae,se=Ee,ie=ke,de=Ce,k=me("hasPermi"),B=we;return E(),pe("div",De,[e(ge,{"enter-active-class":(L=t(r))==null?void 0:L.animate.searchAnimate.enter,"leave-active-class":(K=t(r))==null?void 0:K.animate.searchAnimate.leave},{default:l(()=>[f(O("div",Pe,[e(D,{ref_key:"queryFormRef",ref:F,model:t(g),inline:!0},{default:l(()=>[e(i,{label:"分类名称",prop:"categoryName"},{default:l(()=>[e(c,{modelValue:t(g).categoryName,"onUpdate:modelValue":a[0]||(a[0]=n=>t(g).categoryName=n),placeholder:"请输入分类名称",clearable:"",onKeyup:z(C,["enter"])},null,8,["modelValue"])]),_:1}),e(i,{label:"分类编码",prop:"categoryCode"},{default:l(()=>[e(c,{modelValue:t(g).categoryCode,"onUpdate:modelValue":a[1]||(a[1]=n=>t(g).categoryCode=n),placeholder:"请输入分类编码",clearable:"",onKeyup:z(C,["enter"])},null,8,["modelValue"])]),_:1}),e(i,null,{default:l(()=>[e(u,{type:"primary",icon:"Search",onClick:C},{default:l(()=>[_("搜索")]),_:1}),e(u,{icon:"Refresh",onClick:J},{default:l(()=>[_("重置")]),_:1})]),_:1})]),_:1},8,["model"])],512),[[fe,t(b)]])]),_:1},8,["enter-active-class","leave-active-class"]),e(re,{shadow:"never"},{header:l(()=>[e(oe,{gutter:10,class:"mb8"},{default:l(()=>[e(P,{span:1.5},{default:l(()=>[f((E(),S(u,{type:"primary",plain:"",icon:"Plus",onClick:a[2]||(a[2]=n=>x())},{default:l(()=>[_("新增")]),_:1})),[[k,["workflow:category:add"]]])]),_:1}),e(P,{span:1.5},{default:l(()=>[e(u,{type:"info",plain:"",icon:"Sort",onClick:X},{default:l(()=>[_("展开/折叠")]),_:1})]),_:1}),e(te,{showSearch:t(b),"onUpdate:showSearch":a[3]||(a[3]=n=>_e(b)?b.value=n:null),onQueryTable:v},null,8,["showSearch"])]),_:1})]),default:l(()=>[f((E(),S(ne,{ref_key:"categoryTableRef",ref:U,data:t(V),"row-key":"id","default-expand-all":t(h),"tree-props":{children:"children",hasChildren:"hasChildren"}},{default:l(()=>[e(w,{label:"分类名称",prop:"categoryName"}),e(w,{label:"分类编码",align:"center",prop:"categoryCode"}),e(w,{label:"排序",align:"center",prop:"sortNum"}),e(w,{label:"操作",align:"center","class-name":"small-padding fixed-width"},{default:l(n=>[e(R,{content:"修改",placement:"top"},{default:l(()=>[f(e(u,{link:"",type:"primary",icon:"Edit",onClick:Q=>ee(n.row)},null,8,["onClick"]),[[k,["workflow:category:edit"]]])]),_:2},1024),e(R,{content:"新增",placement:"top"},{default:l(()=>[f(e(u,{link:"",type:"primary",icon:"Plus",onClick:Q=>x(n.row)},null,8,["onClick"]),[[k,["workflow:category:add"]]])]),_:2},1024),e(R,{content:"删除",placement:"top"},{default:l(()=>[f(e(u,{link:"",type:"primary",icon:"Delete",onClick:Q=>le(n.row)},null,8,["onClick"]),[[k,["workflow:category:remove"]]])]),_:2},1024)]),_:1})]),_:1},8,["data","default-expand-all"])),[[B,t(p)]])]),_:1}),e(de,{modelValue:t(d).visible,"onUpdate:modelValue":a[8]||(a[8]=n=>t(d).visible=n),title:t(d).title,width:"500px","append-to-body":""},{footer:l(()=>[O("div",Be,[e(u,{loading:t(y),type:"primary",onClick:ae},{default:l(()=>[_("确 定")]),_:1},8,["loading"]),e(u,{onClick:H},{default:l(()=>[_("取 消")]),_:1})])]),default:l(()=>[f((E(),S(D,{ref_key:"categoryFormRef",ref:I,model:t(s),rules:t(Z),"label-width":"80px"},{default:l(()=>[e(i,{label:"父级分类",prop:"parentId"},{default:l(()=>[e(se,{modelValue:t(s).parentId,"onUpdate:modelValue":a[4]||(a[4]=n=>t(s).parentId=n),data:t(N),props:{value:"id",label:"categoryName",children:"children"},"value-key":"id",placeholder:"请选择父级id","check-strictly":""},null,8,["modelValue","data"])]),_:1}),e(i,{label:"分类名称",prop:"categoryName"},{default:l(()=>[e(c,{modelValue:t(s).categoryName,"onUpdate:modelValue":a[5]||(a[5]=n=>t(s).categoryName=n),placeholder:"请输入分类名称"},null,8,["modelValue"])]),_:1}),e(i,{label:"分类编码",prop:"categoryCode"},{default:l(()=>[e(c,{modelValue:t(s).categoryCode,"onUpdate:modelValue":a[6]||(a[6]=n=>t(s).categoryCode=n),placeholder:"请输入分类编码"},null,8,["modelValue"])]),_:1}),e(i,{label:"排序",prop:"sortNum"},{default:l(()=>[e(ie,{modelValue:t(s).sortNum,"onUpdate:modelValue":a[7]||(a[7]=n=>t(s).sortNum=n),placeholder:"请输入排序","controls-position":"right",min:0},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])),[[B,t(p)]])]),_:1},8,["modelValue","title"])])}}});export{sa as default};
