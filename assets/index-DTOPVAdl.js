import{d as we,$ as be,r as u,a0 as j,b5 as ke,b as Ce,o as p,c as Ve,j as e,k as t,e as l,Z as T,x,y as d,a2 as Ee,w as C,t as M,Y as P,m as _,R as I,q as z,T as Se,G as De,I as Ne,ab as Re,af as $e,W as Ke,v as Te}from"./index-SwfHvmsR.js";import{_ as xe}from"./index-CwtlzU0C.js";import{E as Ie,a as ze}from"./el-table-column-DvXjLevZ.js";import"./el-checkbox-gjRiKN0S.js";import{_ as Le}from"./index-YuVMnXy9.js";/* empty css               */import{_ as Ue}from"./index-D6KF0Zrv.js";import{E as Be,a as Fe}from"./el-form-item-BTGfmHo9.js";/* empty css                       *//* empty css                        *//* empty css               *//* empty css                *//* empty css                */import{g as Pe,a as Ae,d as qe,b as Ye,e as He}from"./index-C7R48aWB.js";import{m as Qe}from"./index-BpX7_Uah.js";import{l as Ge}from"./index-eHxN05NE.js";import{w as Je}from"./index-BWlz0r_B.js";import{E as Oe}from"./index-Bqsyo0rw.js";import{E as je}from"./index-BMMvtxBL.js";import{E as Me}from"./index-Cu3lnjet.js";import{b as We,a as Ze}from"./index-gGP__DGH.js";import{E as Xe}from"./index-gXvdNh_C.js";import"./_initCloneObject-DuYGRlJO.js";import"./_baseClone-D_rg-wPN.js";const et={class:"p-2"},tt={class:"mb-[10px]"},at={class:"mb-[10px]"},nt={style:{"text-align":"right",margin:"5px 0px 0px 0px"}},Rt=we({__name:"index",setup(lt){const{proxy:o}=Se(),{wf_business_status:W}=be(o==null?void 0:o.useDict("wf_business_status")),A=u(),q=u(),c=u(!0),Z=u([]),Y=u([]),X=u(!0),H=u(!0),w=u(!0),V=u(0),ee=u(""),E=u([]),te=u([]),L=u([]),S=u(""),b=j({visible:!1,title:"流程定义"}),f=u("running"),D=u(""),i=u({pageNum:1,pageSize:10,name:void 0,key:void 0,categoryCode:void 0}),ae=a=>{i.value.categoryCode=a.categoryCode,a.categoryCode==="ALL"&&(i.value.categoryCode=""),v()},ne=(a,n)=>a?n.categoryName.indexOf(a)!==-1:!0;ke(()=>{q.value.filter(S.value)},{flush:"post"});const le=async()=>{const a=await Ge();L.value=[];const n={categoryCode:"ALL",categoryName:"顶级节点",children:[]};n.children=o==null?void 0:o.handleTree(a.data,"id","parentId"),L.value.push(n)},v=()=>{f.value==="running"?y():U()},oe=()=>{var a;(a=A.value)==null||a.resetFields(),i.value.categoryCode="",i.value.pageNum=1,i.value.pageSize=10,v()},se=a=>{Z.value=a.map(n=>n.id),Y.value=a.map(n=>n.businessKey),X.value=a.length!==1,H.value=!a.length},y=()=>{c.value=!0,Pe(i.value).then(a=>{E.value=a.rows,V.value=a.total,c.value=!1})},U=()=>{c.value=!0,Ae(i.value).then(a=>{E.value=a.rows,V.value=a.total,c.value=!1})},Q=async a=>{const n=a.businessKey||Y.value;await(o==null?void 0:o.$modal.confirm("是否确认删除业务id为【"+n+"】的数据项？")),c.value=!0,f.value==="running"?(await qe(n).finally(()=>c.value=!1),y()):(await Ye(n).finally(()=>c.value=!1),U()),o==null||o.$modal.msgSuccess("删除成功")},ie=async a=>{E.value=[],i.value.pageNum=1,a==="running"?y():U()},re=async a=>{if(await(o==null?void 0:o.$modal.confirm("是否确认作废业务id为【"+a.businessKey+"】的数据项？")),c.value=!0,f.value==="running"){let n={businessKey:a.businessKey,deleteReason:D.value};await He(n).finally(()=>c.value=!1),y(),o==null||o.$modal.msgSuccess("操作成功")}},ue=async a=>{(o==null?void 0:o.$refs[`popoverRef${a}`]).hide()},de=async a=>{await(o==null?void 0:o.$modal.confirm("是否确认切换？")),c.value=!0,Qe(ee.value,a).then(n=>{o==null||o.$modal.msgSuccess("操作成功"),y(),b.visible=!1,c.value=!1})},ce=a=>{const n=j({wfDefinitionConfigVo:a.wfDefinitionConfigVo,wfNodeConfigVo:a.wfNodeConfigVo,businessKey:a.businessKey,taskId:a.id,type:"view"});Je.routerJump(n,o)};return Ce(()=>{y(),le()}),(a,n)=>{const N=De,me=Oe,R=je,h=Me,G=We,pe=Ze,B=Be,g=Ne,fe=Fe,_e=Ue,$=Xe,r=Ie,K=Re,ge=Le,ve=$e,J=ze,ye=xe,he=Ke,O=Te;return p(),Ve("div",et,[e($,{gutter:20},{default:t(()=>[e(h,{lg:4,xs:24,style:{}},{default:t(()=>[e(R,{shadow:"hover"},{default:t(()=>[e(N,{modelValue:l(S),"onUpdate:modelValue":n[0]||(n[0]=m=>T(S)?S.value=m:null),placeholder:"请输入流程分类名","prefix-icon":"Search",clearable:""},null,8,["modelValue"]),e(me,{ref_key:"categoryTreeRef",ref:q,class:"mt-2","node-key":"id",data:l(L),props:{label:"categoryName",children:"children"},"expand-on-click-node":!1,"filter-node-method":ne,"highlight-current":"","default-expand-all":"",onNodeClick:ae},null,8,["data"])]),_:1})]),_:1}),e(h,{lg:20,xs:24},{default:t(()=>{var m,F;return[x("div",tt,[e(R,{shadow:"hover",class:"text-center"},{default:t(()=>[e(pe,{modelValue:l(f),"onUpdate:modelValue":n[1]||(n[1]=s=>T(f)?f.value=s:null),onChange:n[2]||(n[2]=s=>ie(l(f)))},{default:t(()=>[e(G,{value:"running"},{default:t(()=>[d("运行中")]),_:1}),e(G,{value:"finish"},{default:t(()=>[d("已完成")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),e(Ee,{"enter-active-class":(m=l(o))==null?void 0:m.animate.searchAnimate.enter,"leave-active-class":(F=l(o))==null?void 0:F.animate.searchAnimate.leave},{default:t(()=>[C(x("div",at,[e(R,{shadow:"hover"},{default:t(()=>[C(e(fe,{ref_key:"queryFormRef",ref:A,model:l(i),inline:!0,"label-width":"120px"},{default:t(()=>[e(B,{label:"流程定义名称",prop:"name"},{default:t(()=>[e(N,{modelValue:l(i).name,"onUpdate:modelValue":n[3]||(n[3]=s=>l(i).name=s),placeholder:"请输入流程定义名称",onKeyup:M(v,["enter"])},null,8,["modelValue"])]),_:1}),e(B,{label:"流程定义KEY",prop:"key"},{default:t(()=>[e(N,{modelValue:l(i).key,"onUpdate:modelValue":n[4]||(n[4]=s=>l(i).key=s),placeholder:"请输入流程定义KEY",onKeyup:M(v,["enter"])},null,8,["modelValue"])]),_:1}),e(B,null,{default:t(()=>[e(g,{type:"primary",icon:"Search",onClick:v},{default:t(()=>[d("搜索")]),_:1}),e(g,{icon:"Refresh",onClick:oe},{default:t(()=>[d("重置")]),_:1})]),_:1})]),_:1},8,["model"]),[[P,l(w)]])]),_:1})],512),[[P,l(w)]])]),_:1},8,["enter-active-class","leave-active-class"]),e(R,{shadow:"hover"},{header:t(()=>[e($,{gutter:10,class:"mb8"},{default:t(()=>[e(h,{span:1.5},{default:t(()=>[e(g,{type:"danger",plain:"",icon:"Delete",disabled:l(H),onClick:Q},{default:t(()=>[d("删除")]),_:1},8,["disabled"])]),_:1}),e(_e,{showSearch:l(w),"onUpdate:showSearch":n[5]||(n[5]=s=>T(w)?w.value=s:null),onQueryTable:v},null,8,["showSearch"])]),_:1})]),default:t(()=>[C((p(),_(J,{border:"",data:l(E),onSelectionChange:se},{default:t(()=>[e(r,{type:"selection",width:"55",align:"center"}),e(r,{align:"center",type:"index",label:"序号",width:"60"}),e(r,{"show-overflow-tooltip":!0,align:"center",label:"流程定义名称"},{default:t(s=>[x("span",null,I(s.row.processDefinitionName)+"v"+I(s.row.processDefinitionVersion)+".0",1)]),_:1}),e(r,{align:"center",prop:"processDefinitionKey",label:"流程定义KEY"}),e(r,{align:"center",prop:"processDefinitionVersion",label:"版本号",width:"90"},{default:t(s=>[d(" v"+I(s.row.processDefinitionVersion)+".0",1)]),_:1}),l(f)==="running"?(p(),_(r,{key:0,align:"center",prop:"isSuspended",label:"状态","min-width":"70"},{default:t(s=>[s.row.isSuspended?(p(),_(K,{key:1,type:"danger"},{default:t(()=>[d("挂起")]),_:1})):(p(),_(K,{key:0,type:"success"},{default:t(()=>[d("激活")]),_:1}))]),_:1})):z("",!0),e(r,{align:"center",label:"流程状态","min-width":"70"},{default:t(s=>[e(ge,{options:l(W),value:s.row.businessStatus},null,8,["options","value"])]),_:1}),e(r,{align:"center",prop:"startTime",label:"启动时间",width:"160"}),l(f)==="finish"?(p(),_(r,{key:1,align:"center",prop:"endTime",label:"结束时间",width:"160"})):z("",!0),e(r,{label:"操作",align:"center",width:130},{default:t(s=>[l(f)==="running"?(p(),_($,{key:0,gutter:10,class:"mb8"},{default:t(()=>[e(h,{span:1.5},{default:t(()=>[e(ve,{ref:`popoverRef${s.$index}`,trigger:"click",placement:"left",width:300},{reference:t(()=>[e(g,{link:"",type:"primary",size:"small",icon:"CircleClose"},{default:t(()=>[d("作废")]),_:1})]),default:t(()=>[e(N,{modelValue:l(D),"onUpdate:modelValue":n[6]||(n[6]=k=>T(D)?D.value=k:null),resize:"none",rows:3,type:"textarea",placeholder:"请输入作废原因"},null,8,["modelValue"]),x("div",nt,[e(g,{size:"small",text:"",onClick:k=>ue(s.$index)},{default:t(()=>[d("取消")]),_:2},1032,["onClick"]),e(g,{size:"small",type:"primary",onClick:k=>re(s.row)},{default:t(()=>[d("确认")]),_:2},1032,["onClick"])])]),_:2},1536)]),_:2},1024),e(h,{span:1.5},{default:t(()=>[e(g,{link:"",type:"primary",size:"small",icon:"Delete",onClick:k=>Q(s.row)},{default:t(()=>[d("删除")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)):z("",!0),e($,{gutter:10,class:"mb8"},{default:t(()=>[e(h,{span:1.5},{default:t(()=>[e(g,{link:"",type:"primary",size:"small",icon:"View",onClick:k=>ce(s.row)},{default:t(()=>[d("查看")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[O,l(c)]]),C(e(ye,{page:l(i).pageNum,"onUpdate:page":n[7]||(n[7]=s=>l(i).pageNum=s),limit:l(i).pageSize,"onUpdate:limit":n[8]||(n[8]=s=>l(i).pageSize=s),total:l(V),onPagination:v},null,8,["page","limit","total"]),[[P,l(V)>0]])]),_:1})]}),_:1})]),_:1}),l(b).visible?(p(),_(he,{key:0,modelValue:l(b).visible,"onUpdate:modelValue":n[9]||(n[9]=m=>l(b).visible=m),title:l(b).title,width:"70%"},{default:t(()=>[C((p(),_(J,{data:l(te)},{default:t(()=>[e(r,{fixed:"",align:"center",type:"index",label:"序号",width:"60"}),e(r,{fixed:"",align:"center",prop:"name",label:"流程定义名称"}),e(r,{align:"center",prop:"key",label:"标识Key"}),e(r,{align:"center",prop:"version",label:"版本号",width:"90"},{default:t(m=>[d(" v"+I(m.row.version)+".0",1)]),_:1}),e(r,{align:"center",prop:"suspensionState",label:"状态","min-width":"70"},{default:t(m=>[m.row.suspensionState==1?(p(),_(K,{key:0,type:"success"},{default:t(()=>[d("激活")]),_:1})):(p(),_(K,{key:1,type:"danger"},{default:t(()=>[d("挂起")]),_:1}))]),_:1}),e(r,{align:"center",prop:"deploymentTime",label:"部署时间","show-overflow-tooltip":!0}),e(r,{fixed:"right",label:"操作",align:"center",width:"200","class-name":"small-padding fixed-width"},{default:t(m=>[e(g,{link:"",type:"primary",size:"small",icon:"Sort",onClick:F=>de(m.row.id)},{default:t(()=>[d("切换")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[O,l(c)]])]),_:1},8,["modelValue","title"])):z("",!0)])}}});export{Rt as default};
