import{d as B,$ as q,r as n,a0 as I,b as X,o as m,c as j,j as e,k as o,w as D,x as C,e as l,t as F,F as Z,p as ee,m as w,y as M,Y as R,a2 as te,q as U,R as ae,T as oe,G as le,C as re,D as se,I as ne,a3 as ie,v as ue}from"./index-SwfHvmsR.js";import{_ as de}from"./index-CwtlzU0C.js";import{E as pe,a as me}from"./el-table-column-DvXjLevZ.js";import"./el-checkbox-gjRiKN0S.js";import{_ as ce}from"./index-YuVMnXy9.js";/* empty css               */import{_ as _e}from"./index-D6KF0Zrv.js";/* empty css                */import{E as ge,a as ve}from"./el-form-item-BTGfmHo9.js";import{E as fe}from"./el-date-picker-CnLWeVPa.js";import{_ as ye,l as be,g as De}from"./DeployDetailDialog-DrHKOc5L.js";import{E as we}from"./index-BMMvtxBL.js";import{E as Se}from"./index-gXvdNh_C.js";import"./_initCloneObject-DuYGRlJO.js";/* empty css                */import"./index-Bqsyo0rw.js";import"./_baseClone-D_rg-wPN.js";import"./index-CWevaQ9i.js";import"./el-descriptions-item-BsVAvZpH.js";const Ve={class:"p-2"},he={class:"mb-[10px]"},Te=B({name:"DeployHistory"}),Je=B({...Te,setup(Ee){const{proxy:s}=oe(),{vpa_deploy_status:S}=q(s==null?void 0:s.useDict("vpa_deploy_status")),V=n([]);n(!1);const v=n(!0),f=n(!0);n([]),n(!0),n(!0);const y=n(0),c=n(["",""]),h=n();n();const i=I({visible:!1,title:"发布详情",data:{projectName:"",deployDescription:"",startTime:"",errorMessage:""}}),H=I({form:{...{id:void 0,projectId:void 0,projectName:void 0,deployDescription:void 0,deployStatus:void 0,startTime:void 0,endTime:void 0,duration:void 0,commitId:void 0,errorMessage:void 0,deptId:void 0,userId:void 0}},queryParams:{pageNum:1,pageSize:10,projectName:void 0,deployDescription:void 0,deployStatus:void 0,params:{startTime:void 0}},rules:{id:[{required:!0,message:"主键不能为空",trigger:"blur"}],projectId:[{required:!0,message:"项目ID不能为空",trigger:"blur"}],projectName:[{required:!0,message:"项目名称不能为空",trigger:"blur"}],deployDescription:[{required:!0,message:"发布描述不能为空",trigger:"blur"}],deployStatus:[{required:!0,message:"发布状态不能为空",trigger:"change"}],startTime:[{required:!0,message:"开始时间不能为空",trigger:"blur"}],endTime:[{required:!0,message:"结束时间不能为空",trigger:"blur"}],duration:[{required:!0,message:"编译耗时不能为空",trigger:"blur"}],commitId:[{required:!0,message:"发布的提交ID不能为空",trigger:"blur"}],errorMessage:[{required:!0,message:"错误信息不能为空",trigger:"blur"}],deptId:[{required:!0,message:"部门id不能为空",trigger:"blur"}],userId:[{required:!0,message:"用户id不能为空",trigger:"blur"}]}}),{queryParams:r,form:ke,rules:qe}=q(H),_=async()=>{v.value=!0,r.value.params={},s==null||s.addDateRange(r.value,c.value,"StartTime");const u=await be(r.value);V.value=u.rows,y.value=u.total,v.value=!1},g=()=>{r.value.pageNum=1,_()},Y=()=>{var u;c.value=["",""],(u=h.value)==null||u.resetFields(),g()},L=async u=>{try{const a=await De(u.id);i.data.projectName=a.data.projectName,i.data.deployDescription=a.data.deployDescription,i.data.startTime=a.data.startTime,i.data.errorMessage=a.data.errorMessage,i.visible=!0}catch{s==null||s.$modal.msgError("获取详情失败")}};return X(()=>{_()}),(u,a)=>{var N,k;const T=le,p=ge,P=re,z=se,K=fe,b=ne,Q=ve,E=we,$=_e,x=Se,d=pe,A=ce,G=ie,O=me,J=de,W=ue;return m(),j("div",Ve,[e(te,{"enter-active-class":(N=l(s))==null?void 0:N.animate.searchAnimate.enter,"leave-active-class":(k=l(s))==null?void 0:k.animate.searchAnimate.leave},{default:o(()=>[D(C("div",he,[e(E,{shadow:"hover"},{default:o(()=>[e(Q,{ref_key:"queryFormRef",ref:h,model:l(r),inline:!0},{default:o(()=>[e(p,{label:"项目名称",prop:"projectName"},{default:o(()=>[e(T,{modelValue:l(r).projectName,"onUpdate:modelValue":a[0]||(a[0]=t=>l(r).projectName=t),placeholder:"请输入项目名称",clearable:"",onKeyup:F(g,["enter"])},null,8,["modelValue"])]),_:1}),e(p,{label:"发布描述",prop:"deployDescription"},{default:o(()=>[e(T,{modelValue:l(r).deployDescription,"onUpdate:modelValue":a[1]||(a[1]=t=>l(r).deployDescription=t),placeholder:"请输入发布描述",clearable:"",onKeyup:F(g,["enter"])},null,8,["modelValue"])]),_:1}),e(p,{label:"发布状态",prop:"deployStatus"},{default:o(()=>[e(z,{modelValue:l(r).deployStatus,"onUpdate:modelValue":a[2]||(a[2]=t=>l(r).deployStatus=t),placeholder:"请选择发布状态",clearable:""},{default:o(()=>[(m(!0),j(Z,null,ee(l(S),t=>(m(),w(P,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(p,{label:"开始时间",style:{width:"308px"}},{default:o(()=>[e(K,{modelValue:c.value,"onUpdate:modelValue":a[3]||(a[3]=t=>c.value=t),"value-format":"YYYY-MM-DD HH:mm:ss",type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期","default-time":[new Date(2e3,1,1,0,0,0),new Date(2e3,1,1,23,59,59)]},null,8,["modelValue","default-time"])]),_:1}),e(p,null,{default:o(()=>[e(b,{type:"primary",icon:"Search",onClick:g},{default:o(()=>[M("搜索")]),_:1}),e(b,{icon:"Refresh",onClick:Y},{default:o(()=>[M("重置")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})],512),[[R,f.value]])]),_:1},8,["enter-active-class","leave-active-class"]),e(E,{shadow:"never"},{header:o(()=>[e(x,{gutter:10,class:"mb8"},{default:o(()=>[e($,{showSearch:f.value,"onUpdate:showSearch":a[4]||(a[4]=t=>f.value=t),onQueryTable:_},null,8,["showSearch"])]),_:1})]),default:o(()=>[D((m(),w(O,{data:V.value},{default:o(()=>[U("",!0),e(d,{label:"项目名称",align:"center",prop:"projectName"}),e(d,{label:"发布描述",align:"center",prop:"deployDescription"}),e(d,{label:"发布状态",align:"center",prop:"deployStatus"},{default:o(t=>[e(A,{options:l(S),value:t.row.deployStatus},null,8,["options","value"])]),_:1}),e(d,{label:"开始时间",align:"center",prop:"startTime",width:"180"},{default:o(t=>[C("span",null,ae(u.parseTime(t.row.startTime)),1)]),_:1}),e(d,{label:"编译耗时",align:"center",prop:"duration"}),e(d,{label:"操作",align:"center","class-name":"small-padding fixed-width"},{default:o(t=>[t.row.deployStatus==="0"?(m(),w(G,{key:0,content:"查看详情",placement:"top"},{default:o(()=>[e(b,{link:"",type:"primary",icon:"View",onClick:Ie=>L(t.row)},null,8,["onClick"])]),_:2},1024)):U("",!0)]),_:1})]),_:1},8,["data"])),[[W,v.value]]),D(e(J,{page:l(r).pageNum,"onUpdate:page":a[5]||(a[5]=t=>l(r).pageNum=t),limit:l(r).pageSize,"onUpdate:limit":a[6]||(a[6]=t=>l(r).pageSize=t),total:y.value,onPagination:_},null,8,["page","limit","total"]),[[R,y.value>0]])]),_:1}),e(ye,{modelValue:l(i).visible,"onUpdate:modelValue":a[7]||(a[7]=t=>l(i).visible=t),title:l(i).title,data:l(i).data},null,8,["modelValue","title","data"])])}}});export{Je as default};
