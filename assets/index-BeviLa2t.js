import{ay as Ue,b6 as xe,d as M,ba as Ie,aG as Le,Q as Ke,bu as Be,o as g,m as k,k as t,aR as Pe,a4 as Re,e as o,ag as Fe,aO as Ye,aT as Me,aX as Oe,ac as ee,r as c,a0 as H,b as qe,b5 as Ae,J as Xe,c as j,j as e,Z as J,a2 as Qe,w as x,x as S,t as fe,y as r,Y as W,R as w,q as Z,T as Ge,P as He,G as je,I as Je,ab as We,ah as Ze,W as et,v as tt}from"./index-CCqTiRkP.js";import{E as lt}from"./el-upload-BZZtVkSe.js";/* empty css                    *//* empty css                */import"./el-checkbox-BsOdlv_l.js";import{E as at}from"./el-tree-select-cZ-PVLSs.js";import{_ as ot}from"./index-B_7jpnD9.js";import{E as nt,a as it}from"./el-table-column-BAmBbLsF.js";import{E as st}from"./el-link-G1n-NeGS.js";/* empty css               */import{_ as rt}from"./index-D97A161p.js";import{E as dt,a as ut}from"./el-form-item-B7HFcjSV.js";/* empty css               *//* empty css                */import{l as ct,g as mt,d as pt,a as ft,u as _t,c as vt,b as gt}from"./index-CfUlX3gu.js";import{_ as yt}from"./processPreview.vue_vue_type_script_setup_true_lang-CyseX7cM.js";import{l as wt}from"./index-q8gYnEaT.js";import{E as kt}from"./index-BMk1bPmy.js";import{E as bt}from"./index-DqIaDxYK.js";import{E as ht}from"./index-Cz1AFa5J.js";import{E as Ct}from"./index-zO4r2ipM.js";import"./index-ByVdwy5X.js";import"./_baseClone-CdCDDPli.js";import"./_initCloneObject-BtXgEfLK.js";import"./index-bRI2QMKW.js";import"./Viewer-V83WcO4W.js";import"./index-B0MZDWLQ.js";const St=Ue({type:{type:String,values:["primary","success","info","warning","danger",""],default:""},size:{type:String,values:xe,default:""},truncated:Boolean,lineClamp:{type:[String,Number]},tag:{type:String,default:"span"}}),Et=M({name:"ElText"}),Nt=M({...Et,props:St,setup(b){const n=b,I=Ie(),h=Le("text"),B=Ke(()=>[h.b(),h.m(n.type),h.m(I.value),h.is("truncated",n.truncated),h.is("line-clamp",!Be(n.lineClamp))]);return(d,f)=>(g(),k(Ye(d.tag),{class:Re(o(B)),style:Fe({"-webkit-line-clamp":d.lineClamp})},{default:t(()=>[Pe(d.$slots,"default")]),_:3},8,["class","style"]))}});var Vt=Me(Nt,[["__file","text.vue"]]);const $t=Oe(Vt),Dt=b=>ee({url:"/workflow/definitionConfig/getByDefId/"+b,method:"get"}),_e=b=>ee({url:"/workflow/definitionConfig/saveOrUpdate",method:"post",data:b}),Tt=(b,n)=>ee({url:`/workflow/definitionConfig/getByTableNameNotDefId/${b}/${n}`,method:"get"}),zt={class:"p-2"},Ut={class:"mb-[10px]"},xt={key:0},It={class:"mb5"},Lt=S("span",{class:"text-danger"},"*",-1),Kt=S("div",{class:"el-upload__text"},[S("em",null,"点击上传，选择BPMN流程文件")],-1),Bt=S("div",{class:"el-upload__text"},"仅支持 .zip、.bpmn20.xml、bpmn 格式文件",-1),Pt=S("div",{class:"el-upload__text"},"PS:如若部署请部署从本项目模型管理导出的数据",-1),Rt={class:"dialog-footer"},Ft=M({name:"processDefinition"}),fl=M({...Ft,setup(b){const{proxy:n}=Ge(),I=c(),h=c(),B=c(),d=c({}),f=c(!0),te=c([]),le=c([]),ae=c([]),ve=c(!0),oe=c(!0),L=c(!0),O=c(0),q=c(!1),ne=c([]),ie=c([]),P=c([]),R=c(""),V=c(),$=H({visible:!1,title:"部署流程文件"}),K=H({visible:!1,title:"历史版本"}),E=H({visible:!1,title:"流程定义配置"}),m=c({pageNum:1,pageSize:10,name:void 0,key:void 0,categoryCode:void 0});qe(()=>{y(),we()});const ge=a=>{m.value.categoryCode=a.categoryCode,a.categoryCode==="ALL"&&(m.value.categoryCode=""),D()},ye=(a,l)=>a?l.categoryName.indexOf(a)!==-1:!0;Ae(()=>{B.value.filter(R.value)},{flush:"post"});const we=async()=>{const a=await wt();P.value=[];const l={categoryCode:"ALL",categoryName:"顶级节点",children:[]};l.children=n==null?void 0:n.handleTree(a.data,"id","parentId"),P.value.push(l)},D=()=>{m.value.pageNum=1,y()},ke=()=>{var a;(a=h.value)==null||a.resetFields(),m.value.categoryCode="",m.value.pageNum=1,m.value.pageSize=10,D()},se=a=>{te.value=a.map(l=>l.id),le.value=a.map(l=>l.deploymentId),ae.value=a.map(l=>l.key),ve.value=a.length!==1,oe.value=!a.length},y=async()=>{f.value=!0;const a=await ct(m.value);ne.value=a.rows,O.value=a.total,f.value=!1},be=async(a,l)=>{K.visible=!0,f.value=!0;const _=await mt(l);_.data&&_.data.length>0&&(ie.value=_.data.filter(N=>N.id!==a)),f.value=!1},re=async(a,l)=>{f.value=!0;const _=await pt(a);if(I.value){const N=_.data.xmlStr;f.value=!1,I.value.openDialog(N,l)}},A=async a=>{const l=(a==null?void 0:a.id)||te.value,_=(a==null?void 0:a.deploymentId)||le.value,N=(a==null?void 0:a.key)||ae.value;await(n==null?void 0:n.$modal.confirm("是否确认删除流程定义KEY为【"+N+"】的数据项？")),f.value=!0,await ft(_,l).finally(()=>f.value=!1),await y(),n==null||n.$modal.msgSuccess("删除成功")},de=async a=>{let l;a.suspensionState===1?l=`暂停后，此流程下的所有任务都不允许往后流转，您确定挂起【${a.name||a.key}】吗？`:l=`启动后，此流程下的所有任务都允许往后流转，您确定激活【${a.name||a.key}】吗？`,await(n==null?void 0:n.$modal.confirm(l)),f.value=!0,await _t(a.id).finally(()=>f.value=!1),await y(),n==null||n.$modal.msgSuccess("操作成功")},ue=async a=>{await(n==null?void 0:n.$modal.confirm("是否确认转换流程定义key为【"+a.key+"】的数据项？")),await vt(a.id).finally(()=>f.value=!1),y(),n==null||n.$modal.msgSuccess("操作成功")},he=()=>{if(V.value==="ALL")return n==null||n.$modal.msgError("顶级节点不可作为分类！"),!1;if(!V.value)return n==null||n.$modal.msgError("请选择左侧要上传的分类！"),!1},Ce=a=>{let l=new FormData;q.value=!0,l.append("file",a.file),l.append("categoryCode",V.value),gt(l).then(()=>{$.visible=!1,n==null||n.$modal.msgSuccess("部署成功"),D()}).finally(()=>{q.value=!1})},ce=async a=>{E.visible=!0,d.value.processKey=a.key,d.value.definitionId=a.id,d.value.version=a.version;const l=await Dt(a.id);l.data?d.value=l.data:(d.value.tableName=void 0,d.value.remark=void 0)},Se=async()=>{Tt(d.value.tableName,d.value.definitionId).then(a=>{a.data&&a.data.length>0?He.confirm("表名已被【"+a.data[0].processKey+"】版本v"+a.data[0].version+".0绑定确认后将会删除绑定的流程KEY!","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>{_e(d.value).then(l=>{l.code===200&&(n==null||n.$modal.msgSuccess("操作成功"),E.visible=!1,y())})}):_e(d.value).then(l=>{l.code===200&&(n==null||n.$modal.msgSuccess("操作成功"),E.visible=!1,y())})})};return(a,l)=>{const _=je,N=kt,X=bt,v=ht,T=dt,p=Je,me=ut,Ee=rt,z=Ct,u=nt,F=st,Y=We,pe=it,Ne=ot,Ve=$t,$e=at,De=Xe("upload-filled"),Te=Ze,ze=lt,Q=et,G=tt;return g(),j("div",zt,[e(z,{gutter:20},{default:t(()=>[e(v,{lg:4,xs:24,style:{}},{default:t(()=>[e(X,{shadow:"hover"},{default:t(()=>[e(_,{modelValue:o(R),"onUpdate:modelValue":l[0]||(l[0]=i=>J(R)?R.value=i:null),placeholder:"请输入流程分类名","prefix-icon":"Search",clearable:""},null,8,["modelValue"]),e(N,{ref_key:"categoryTreeRef",ref:B,class:"mt-2","node-key":"id",data:o(P),props:{label:"categoryName",children:"children"},"expand-on-click-node":!1,"filter-node-method":ye,"highlight-current":"","default-expand-all":"",onNodeClick:ge},null,8,["data"])]),_:1})]),_:1}),e(v,{lg:20,xs:24},{default:t(()=>{var i,C;return[e(Qe,{"enter-active-class":(i=o(n))==null?void 0:i.animate.searchAnimate.enter,"leave-active-class":(C=o(n))==null?void 0:C.animate.searchAnimate.leave},{default:t(()=>[x(S("div",Ut,[e(X,{shadow:"hover"},{default:t(()=>[x(e(me,{ref_key:"queryFormRef",ref:h,model:o(m),inline:!0,"label-width":"120px"},{default:t(()=>[e(T,{label:"流程定义名称",prop:"name"},{default:t(()=>[e(_,{modelValue:o(m).name,"onUpdate:modelValue":l[1]||(l[1]=s=>o(m).name=s),placeholder:"请输入流程定义名称",clearable:"",onKeyup:fe(D,["enter"])},null,8,["modelValue"])]),_:1}),e(T,{label:"流程定义KEY",prop:"key"},{default:t(()=>[e(_,{modelValue:o(m).key,"onUpdate:modelValue":l[2]||(l[2]=s=>o(m).key=s),placeholder:"请输入流程定义KEY",clearable:"",onKeyup:fe(D,["enter"])},null,8,["modelValue"])]),_:1}),e(T,null,{default:t(()=>[e(p,{type:"primary",icon:"Search",onClick:D},{default:t(()=>[r("搜索")]),_:1}),e(p,{icon:"Refresh",onClick:ke},{default:t(()=>[r("重置")]),_:1})]),_:1})]),_:1},8,["model"]),[[W,o(L)]])]),_:1})],512),[[W,o(L)]])]),_:1},8,["enter-active-class","leave-active-class"]),e(X,{shadow:"hover"},{header:t(()=>[e(z,{gutter:10,class:"mb8"},{default:t(()=>[e(v,{span:1.5},{default:t(()=>[e(p,{type:"danger",icon:"Delete",disabled:o(oe),onClick:l[3]||(l[3]=s=>A())},{default:t(()=>[r("删除")]),_:1},8,["disabled"])]),_:1}),e(v,{span:1.5},{default:t(()=>[e(p,{type:"primary",icon:"UploadFilled",onClick:l[4]||(l[4]=s=>o($).visible=!0)},{default:t(()=>[r("部署流程文件")]),_:1})]),_:1}),e(Ee,{showSearch:o(L),"onUpdate:showSearch":l[5]||(l[5]=s=>J(L)?L.value=s:null),onQueryTable:y},null,8,["showSearch"])]),_:1})]),default:t(()=>[x((g(),k(pe,{border:"",data:o(ne),onSelectionChange:se},{default:t(()=>[e(u,{type:"selection",width:"55",align:"center"}),e(u,{align:"center",type:"index",label:"序号",width:"60"}),e(u,{align:"center",prop:"name",label:"流程定义名称","show-overflow-tooltip":!0}),e(u,{align:"center",prop:"key",label:"标识KEY",width:"80"}),e(u,{align:"center",prop:"version",label:"版本号",width:"80"},{default:t(s=>[r(" v"+w(s.row.version)+".0",1)]),_:1}),e(u,{align:"center",prop:"resourceName",label:"流程XML",width:"100","show-overflow-tooltip":!0},{default:t(s=>[e(F,{type:"primary",onClick:U=>re(s.row.id,"xml")},{default:t(()=>[r(w(s.row.resourceName),1)]),_:2},1032,["onClick"])]),_:1}),e(u,{align:"center",prop:"diagramResourceName",label:"流程图片",width:"100","show-overflow-tooltip":!0},{default:t(s=>[e(F,{type:"primary",onClick:U=>re(s.row.id,"bpmn")},{default:t(()=>[r(w(s.row.diagramResourceName),1)]),_:2},1032,["onClick"])]),_:1}),e(u,{align:"center",prop:"suspensionState",label:"状态",width:"80"},{default:t(s=>[s.row.suspensionState==1?(g(),k(Y,{key:0,type:"success"},{default:t(()=>[r("激活")]),_:1})):(g(),k(Y,{key:1,type:"danger"},{default:t(()=>[r("挂起")]),_:1}))]),_:1}),e(u,{align:"center",prop:"deploymentTime",label:"部署时间",width:"120","show-overflow-tooltip":!0}),e(u,{align:"center",label:"表名/表单KEY",width:"120","show-overflow-tooltip":!0},{default:t(s=>[s.row.wfDefinitionConfigVo?(g(),j("span",xt,w(s.row.wfDefinitionConfigVo.tableName),1)):Z("",!0)]),_:1}),e(u,{fixed:"right",label:"操作",align:"center",width:"220","class-name":"small-padding fixed-width"},{default:t(s=>[e(z,{gutter:10,class:"mb8"},{default:t(()=>[e(v,{span:1.5},{default:t(()=>[e(p,{link:"",type:"primary",size:"small",icon:s.row.suspensionState===1?"Lock":"Unlock",onClick:U=>de(s.row)},{default:t(()=>[r(w(s.row.suspensionState===1?"挂起流程":"激活流程"),1)]),_:2},1032,["icon","onClick"])]),_:2},1024),e(v,{span:1.5},{default:t(()=>[e(p,{link:"",type:"primary",size:"small",icon:"Document",onClick:U=>be(s.row.id,s.row.key)},{default:t(()=>[r(" 历史版本 ")]),_:2},1032,["onClick"])]),_:2},1024),e(v,{span:1.5},{default:t(()=>[e(p,{link:"",type:"primary",size:"small",icon:"Delete",onClick:U=>A(s.row)},{default:t(()=>[r("删除")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024),e(z,{gutter:10,class:"mb8"},{default:t(()=>[e(v,{span:1.5},{default:t(()=>[e(p,{link:"",type:"primary",size:"small",icon:"Sort",onClick:U=>ue(s.row)},{default:t(()=>[r(" 转换模型 ")]),_:2},1032,["onClick"])]),_:2},1024),e(v,{span:1.5},{default:t(()=>[e(p,{link:"",type:"primary",size:"small",icon:"Tickets",onClick:U=>ce(s.row)},{default:t(()=>[r("绑定业务")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[G,o(f)]]),x(e(Ne,{page:o(m).pageNum,"onUpdate:page":l[6]||(l[6]=s=>o(m).pageNum=s),limit:o(m).pageSize,"onUpdate:limit":l[7]||(l[7]=s=>o(m).pageSize=s),total:o(O),onPagination:y},null,8,["page","limit","total"]),[[W,o(O)>0]])]),_:1})]}),_:1})]),_:1}),e(yt,{ref_key:"previewRef",ref:I},null,512),o($).visible?(g(),k(Q,{key:0,modelValue:o($).visible,"onUpdate:modelValue":l[9]||(l[9]=i=>o($).visible=i),title:o($).title,width:"30%"},{default:t(()=>[x((g(),j("div",null,[S("div",It,[e(Ve,{class:"mx-1",size:"large"},{default:t(()=>[Lt,r("请选择部署流程分类：")]),_:1}),e($e,{modelValue:o(V),"onUpdate:modelValue":l[8]||(l[8]=i=>J(V)?V.value=i:null),data:o(P),props:{value:"categoryCode",label:"categoryName",children:"children"},filterable:"","value-key":"categoryCode","render-after-expand":!1,"check-strictly":"",style:{width:"240px"}},null,8,["modelValue","data"])]),e(ze,{class:"upload-demo",drag:"",multiple:"",accept:"application/zip,application/xml,.bpmn","before-upload":he,"http-request":Ce},{default:t(()=>[e(Te,{class:"UploadFilled"},{default:t(()=>[e(De)]),_:1}),Kt,Bt,Pt]),_:1})])),[[G,o(q)]])]),_:1},8,["modelValue","title"])):Z("",!0),o(K).visible?(g(),k(Q,{key:1,modelValue:o(K).visible,"onUpdate:modelValue":l[10]||(l[10]=i=>o(K).visible=i),title:o(K).title,width:"70%"},{default:t(()=>[x((g(),k(pe,{data:o(ie),onSelectionChange:se},{default:t(()=>[e(u,{type:"selection",width:"55",align:"center"}),e(u,{align:"center",type:"index",label:"序号",width:"60"}),e(u,{align:"center",prop:"name",label:"流程定义名称","show-overflow-tooltip":!0,"min-width":"80"}),e(u,{align:"center",prop:"key",label:"标识KEY"}),e(u,{align:"center",prop:"version",label:"版本号",width:"90"},{default:t(i=>[r(" v"+w(i.row.version)+".0",1)]),_:1}),e(u,{align:"center",prop:"resourceName",label:"流程XML","min-width":"80","show-overflow-tooltip":!0},{default:t(i=>[e(F,{type:"primary",onClick:C=>a.clickPreviewXML(i.row.id)},{default:t(()=>[r(w(i.row.resourceName),1)]),_:2},1032,["onClick"])]),_:1}),e(u,{align:"center",prop:"diagramResourceName",label:"流程图片","min-width":"80","show-overflow-tooltip":!0},{default:t(i=>[e(F,{type:"primary",onClick:C=>a.clickPreviewImg(i.row.id)},{default:t(()=>[r(w(i.row.diagramResourceName),1)]),_:2},1032,["onClick"])]),_:1}),e(u,{align:"center",prop:"suspensionState",label:"状态","min-width":"70"},{default:t(i=>[i.row.suspensionState==1?(g(),k(Y,{key:0,type:"success"},{default:t(()=>[r("激活")]),_:1})):(g(),k(Y,{key:1,type:"danger"},{default:t(()=>[r("挂起")]),_:1}))]),_:1}),e(u,{align:"center",prop:"deploymentTime",label:"部署时间","show-overflow-tooltip":!0}),e(u,{fixed:"right",label:"操作",align:"center",width:"200","class-name":"small-padding fixed-width"},{default:t(i=>[e(z,{gutter:10,class:"mb8"},{default:t(()=>[e(v,{span:1.5},{default:t(()=>[e(p,{link:"",type:"primary",size:"small",icon:i.row.suspensionState===1?"Lock":"Unlock",onClick:C=>de(i.row)},{default:t(()=>[r(w(i.row.suspensionState===1?"挂起流程":"激活流程"),1)]),_:2},1032,["icon","onClick"])]),_:2},1024),e(v,{span:1.5},{default:t(()=>[e(p,{type:"text",size:"small",icon:"Tickets",onClick:C=>ce(i.row)},{default:t(()=>[r("绑定业务")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024),e(z,{gutter:10,class:"mb8"},{default:t(()=>[e(v,{span:1.5},{default:t(()=>[e(p,{link:"",type:"primary",icon:"Sort",size:"small",onClick:C=>ue(i.row)},{default:t(()=>[r(" 转换模型 ")]),_:2},1032,["onClick"])]),_:2},1024),e(v,{span:1.5},{default:t(()=>[e(p,{link:"",type:"primary",icon:"Delete",size:"small",onClick:C=>A(i.row)},{default:t(()=>[r("删除")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[G,o(f)]])]),_:1},8,["modelValue","title"])):Z("",!0),e(Q,{modelValue:o(E).visible,"onUpdate:modelValue":l[15]||(l[15]=i=>o(E).visible=i),title:o(E).title,width:"650px","append-to-body":"","close-on-click-modal":!1},{footer:t(()=>[S("div",Rt,[e(p,{onClick:l[14]||(l[14]=i=>o(E).visible=!1)},{default:t(()=>[r("取消")]),_:1}),e(p,{type:"primary",onClick:Se},{default:t(()=>[r("保存")]),_:1})])]),default:t(()=>[e(me,{model:o(d),"label-width":"auto"},{default:t(()=>[e(T,{label:"流程KEY"},{default:t(()=>[e(_,{modelValue:o(d).processKey,"onUpdate:modelValue":l[11]||(l[11]=i=>o(d).processKey=i),disabled:""},null,8,["modelValue"])]),_:1}),e(T,{label:"表名",prop:"formId"},{default:t(()=>[e(_,{modelValue:o(d).tableName,"onUpdate:modelValue":l[12]||(l[12]=i=>o(d).tableName=i),placeholder:"示例:test_leave"},null,8,["modelValue"])]),_:1}),e(T,{label:"备注"},{default:t(()=>[e(_,{modelValue:o(d).remark,"onUpdate:modelValue":l[13]||(l[13]=i=>o(d).remark=i),type:"textarea",resize:"none"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}});export{fl as default};
