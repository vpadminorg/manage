import{d as Z,r as i,b3 as we,o as y,p as U,k as n,m as F,j as t,y as C,e as l,c as M,X as A,a0 as Ie,w as L,x as O,W as P,Q as G,F as ke,q as ye,t as W,R as be,G as Ne,I as Se,a9 as Ee,U as Ce,v as Te}from"./index-DDAliqzK.js";import{_ as xe}from"./index-RdVOGMqm.js";import{a as D,E as Ve}from"./el-table-column-DxCuKUMo.js";import"./el-checkbox-BucE91Wb.js";/* empty css               */import{_ as Re}from"./index-2eSzZeHe.js";import{E as Ue,a as Le}from"./el-form-item-Dtm-Ic1o.js";/* empty css               *//* empty css                */import{c as X,o as H,d as Be}from"./index-CmqILhzb.js";import{f as J,h as Fe,i as Me,j as Ae}from"./index-DXcrzSX8.js";import{E as Y}from"./index-CSfZWYHi.js";import{E as De}from"./index-x58AzXEe.js";import{E as Ke}from"./index-CokWeuRK.js";import{E as Qe}from"./index-D7RFStbC.js";const $e={key:0,class:"p-2"},qe={class:"search"},ze={key:1,class:"p-2"},je={class:"dialog-footer"},Oe=Z({name:"User"}),ra=Z({...Oe,props:{width:{type:String,default:"70%"},height:{type:String,default:"100%"},title:{type:String,default:"加签人员"},multiple:{type:Boolean,default:!0},userIdList:{type:Array,default:()=>[]}},emits:["submitCallback"],setup(T,{expose:ee,emit:ae}){const{proxy:_}=be(),te=T,B=i(Y),f=i(D),w=i(),K=i(),p=i(!0),x=i(!0),I=i(),g=i(!1),V=i(0),R=i(""),b=i([]),r=i(i()),v=i([]),E=i(""),o=i({pageNum:1,pageSize:10,userName:"",nickName:"",taskId:""}),Q=async(a,e)=>{b.value=[],re(),E.value="add",v.value=e,g.value=!0,o.value.taskId=a,p.value=!0;const s=await J(a);o.value.excludeUserIds=s.data;const u=await X(o.value);if(p.value=!1,w.value=u.rows,V.value=u.total,w.value&&v.value.length>0){const c=await H(v.value);c.data&&c.data.length>0&&(r.value=c.data,c.data.forEach(m=>{f.value.toggleRowSelection(w.value.find(S=>S.userId==m.userId),!0)}))}},le=async()=>{p.value=!0;const a=await J(o.value.taskId);o.value.excludeUserIds=a.data;const e=await X(o.value);if(p.value=!1,w.value=e.rows,V.value=e.total,w.value&&v.value.length>0){const s=await H(v.value);s.data&&s.data.length>0&&(r.value=s.data,s.data.forEach(u=>{f.value.toggleRowSelection(w.value.find(c=>c.userId==u.userId),!0)}))}},oe=async a=>{b.value=[],p.value=!0,o.value.taskId=a,E.value="delete",g.value=!0;const e=await Fe(a);K.value=e.data,p.value=!1},N=()=>{o.value.pageNum=1,Q(o.value.taskId,v.value)},ne=()=>{o.value.pageNum=1,o.value.deptId=void 0,o.value.userName=void 0,o.value.nickName=void 0,B.value.setCurrentKey(null),N()},se=a=>{if(te.multiple)r.value=a.filter((e,s,u)=>u.findIndex(c=>c.userId===e.userId)===s),a.forEach(e=>{r.value&&!r.value.includes(e)&&f.value.toggleRowSelection(e,void 0)}),v.value=r.value.map(e=>e.userId);else{if(r.value=a,a.length>1){let e=a.shift();f.value.toggleRowSelection(e,void 0)}a.length===0&&(r.value=[])}},ue=a=>{I.value=a},re=async()=>{const a=await Be();b.value=a.data},ie=(a,e)=>a?e.label.indexOf(a)!==-1:!0;we(()=>{g.value&&b.value&&b.value.length>0&&B.value.filter(R.value)},{flush:"post"});const de=a=>{o.value.deptId=a.id,le()},ce=(a,e)=>{f.value.selection&&f.value.selection.length>0&&f.value.selection.forEach((s,u)=>{a.userId===s.userId&&f.value.selection.splice(u,1)}),r.value&&r.value.length>0&&r.value.splice(e,1),f.value.toggleRowSelection(a,void 0),v.value&&v.value.length>0&&v.value.forEach((s,u)=>{s===a.userId&&v.value.splice(u,1)})},me=async()=>{if(E.value==="add"){if(r.value&&r.value.length>0){p.value=!0;let a=r.value.map(u=>u.userId),e=r.value.map(u=>u.nickName),s={taskId:o.value.taskId,assignees:a,assigneeNames:e};await Me(s),$("submitCallback"),p.value=!1,_==null||_.$modal.msgSuccess("操作成功"),g.value=!1}}else if(I.value&&I.value.length>0){p.value=!0;let a=I.value.map(m=>m.id),e=I.value.map(m=>m.executionId),s=I.value.map(m=>m.assignee),u=I.value.map(m=>m.assigneeName),c={taskId:o.value.taskId,taskIds:a,executionIds:e,assigneeIds:s,assigneeNames:u};await Ae(c),$("submitCallback"),p.value=!1,_==null||_.$modal.msgSuccess("操作成功"),g.value=!1}},$=ae;return ee({getAddMultiInstanceList:Q,getDeleteMultiInstanceList:oe}),(a,e)=>{const s=Ne,u=De,c=Ke,m=Ue,S=Se,pe=Le,ve=Re,q=Qe,h=Ve,fe=xe,ge=Ee,he=Ce,z=Te;return y(),U(he,{modelValue:l(g),"onUpdate:modelValue":e[7]||(e[7]=k=>A(g)?g.value=k:null),draggable:"",title:T.title,width:T.width,height:T.height,"append-to-body":"","close-on-click-modal":!1},{footer:n(()=>[F("div",je,[t(S,{type:"primary",onClick:me},{default:n(()=>e[10]||(e[10]=[C("确 定")])),_:1}),t(S,{onClick:e[6]||(e[6]=k=>g.value=!1)},{default:n(()=>e[11]||(e[11]=[C("取 消")])),_:1})])]),default:n(()=>[l(E)==="add"?(y(),M("div",$e,[t(q,{gutter:20},{default:n(()=>[t(c,{lg:4,xs:24,style:{}},{default:n(()=>[t(u,{shadow:"hover"},{default:n(()=>[t(s,{modelValue:l(R),"onUpdate:modelValue":e[0]||(e[0]=k=>A(R)?R.value=k:null),placeholder:"请输入部门名称","prefix-icon":"Search",clearable:""},null,8,["modelValue"]),t(l(Y),{ref_key:"deptTreeRef",ref:B,class:"mt-2","node-key":"id",data:l(b),props:{label:"label",children:"children"},"expand-on-click-node":!1,"filter-node-method":ie,"highlight-current":"","default-expand-all":"",onNodeClick:de},null,8,["data"])]),_:1})]),_:1}),t(c,{lg:20,xs:24},{default:n(()=>{var k,j;return[t(Ie,{"enter-active-class":(k=l(_))==null?void 0:k.animate.searchAnimate.enter,"leave-active-class":(j=l(_))==null?void 0:j.animate.searchAnimate.leave},{default:n(()=>[L(F("div",qe,[t(pe,{ref:"queryFormRef",model:l(o),inline:!0},{default:n(()=>[t(m,{label:"用户名称",prop:"userName"},{default:n(()=>[t(s,{modelValue:l(o).userName,"onUpdate:modelValue":e[1]||(e[1]=d=>l(o).userName=d),placeholder:"请输入用户名称",clearable:"",onKeyup:O(N,["enter"])},null,8,["modelValue"])]),_:1}),t(m,{label:"手机号码",prop:"phonenumber"},{default:n(()=>[t(s,{modelValue:l(o).phonenumber,"onUpdate:modelValue":e[2]||(e[2]=d=>l(o).phonenumber=d),placeholder:"请输入手机号码",clearable:"",onKeyup:O(N,["enter"])},null,8,["modelValue"])]),_:1}),t(m,null,{default:n(()=>[t(S,{type:"primary",icon:"Search",onClick:N},{default:n(()=>e[8]||(e[8]=[C("搜索")])),_:1}),t(S,{icon:"Refresh",onClick:ne},{default:n(()=>e[9]||(e[9]=[C("重置")])),_:1})]),_:1})]),_:1},8,["model"])],512),[[P,l(x)]])]),_:1},8,["enter-active-class","leave-active-class"]),t(u,{shadow:"hover"},{header:n(()=>[t(q,{gutter:10},{default:n(()=>[t(ve,{showSearch:l(x),"onUpdate:showSearch":e[3]||(e[3]=d=>A(x)?x.value=d:null),search:!0,onQueryTable:N},null,8,["showSearch"])]),_:1})]),default:n(()=>[L((y(),U(l(D),{ref_key:"multipleTableRef",ref:f,data:l(w),"row-key":"userId",onSelectionChange:se},{default:n(()=>[t(h,{type:"selection",width:"50",align:"center"}),t(h,{key:"userId",label:"用户编号",align:"center",prop:"userId"}),t(h,{key:"userName",label:"用户名称",align:"center",prop:"userName","show-overflow-tooltip":!0}),t(h,{key:"nickName",label:"用户昵称",align:"center",prop:"nickName","show-overflow-tooltip":!0}),t(h,{key:"phonenumber",label:"手机号码",align:"center",prop:"phonenumber",width:"120"}),t(h,{label:"创建时间",align:"center",prop:"createTime",width:"160"},{default:n(d=>[F("span",null,G(d.row.createTime),1)]),_:1})]),_:1},8,["data"])),[[z,l(p)]]),L(t(fe,{page:l(o).pageNum,"onUpdate:page":e[4]||(e[4]=d=>l(o).pageNum=d),limit:l(o).pageSize,"onUpdate:limit":e[5]||(e[5]=d=>l(o).pageSize=d),total:l(V),onPagination:N},null,8,["page","limit","total"]),[[P,l(V)>0]])]),_:1}),t(u,{shadow:"hover"},{default:n(()=>[(y(!0),M(ke,null,ye(l(r),(d,_e)=>(y(),U(ge,{key:d.userId,style:{margin:"2px"},closable:"",onClose:Pe=>ce(d,_e)},{default:n(()=>[C(G(d.userName),1)]),_:2},1032,["onClose"]))),128))]),_:1})]}),_:1})]),_:1})])):W("",!0),l(E)==="delete"?(y(),M("div",ze,[L((y(),U(l(D),{data:l(K),onSelectionChange:ue},{default:n(()=>[t(h,{type:"selection",width:"55"}),t(h,{prop:"name",label:"任务名称"}),t(h,{prop:"assigneeName",label:"办理人"})]),_:1},8,["data"])),[[z,l(p)]])])):W("",!0)]),_:1},8,["modelValue","title","width","height"])}}});export{ra as _};
