import{d as ue,a as We,Y as ae,r as f,Z as Y,as as Xe,b3 as Ze,b as Je,$ as el,o as d,c as N,j as l,k as t,a0 as ll,e as a,w as U,m as V,x as z,F as T,q as F,p as c,X as te,y as g,W as oe,t as b,Q as se,R as al,K as ne,N as re,G as tl,C as ol,D as sl,I as nl,ab as rl,a1 as ul,U as dl,af as il,v as pl}from"./index-DDAliqzK.js";import{E as ml}from"./el-upload-gtPj48F2.js";/* empty css                    */import{E as fl}from"./el-link-CQyR00ym.js";import{E as cl}from"./el-checkbox-BucE91Wb.js";import{_ as _l}from"./upload-filled-CGD7kQ4d.js";/* empty css                       *//* empty css                 *//* empty css                */import{E as vl}from"./el-tree-select-D4iAZ1Ls.js";import{_ as bl}from"./index-RdVOGMqm.js";import{E as gl,a as yl}from"./el-table-column-DxCuKUMo.js";/* empty css               */import{_ as Vl}from"./index-2eSzZeHe.js";/* empty css               *//* empty css                */import{E as kl,a as wl}from"./el-form-item-Dtm-Ic1o.js";import{E as hl}from"./el-date-picker-DZLvxWBh.js";import{b as E}from"./index-CmqILhzb.js";import{o as Il}from"./index-DGhqMk7r.js";import{E as Ul}from"./index-x58AzXEe.js";import{E as El}from"./index-CokWeuRK.js";import{E as Cl}from"./index-D7RFStbC.js";import{E as Nl,a as xl}from"./index-BmCCDXTO.js";import"./index-DHwca6ts.js";import"./_baseClone-1ZiivbqZ.js";import"./_initCloneObject-B4dgLBrf.js";import"./index-CSfZWYHi.js";import"./index-BV8nIMlh.js";const Sl={class:"p-2"},Dl={class:"mb-[10px]"},Rl={class:"dialog-footer"},Tl={class:"text-center el-upload__tip"},Fl={class:"el-upload__tip"},$l={class:"dialog-footer"},Pl=ue({name:"User"}),fa=ue({...Pl,setup(ql){const de=We(),{proxy:n}=al(),{sys_normal_disable:H,sys_user_sex:ie}=ae(n==null?void 0:n.useDict("sys_normal_disable","sys_user_sex")),Q=f(),K=f(!0),$=f(!0),pe=f([]);f(!0),f(!0);const M=f(0),x=f(["",""]),me=f(""),A=f([]),fe=f(""),j=f([]),ce=f([]),_=Y({open:!1,title:"",isUploading:!1,updateSupport:0,headers:Xe(),url:"https://api.leadcodingway.com/prod-api/system/user/importData"}),h=f([{key:0,label:"用户编号",visible:!0,children:[]},{key:1,label:"用户名称",visible:!0,children:[]},{key:2,label:"用户昵称",visible:!0,children:[]},{key:3,label:"部门",visible:!0,children:[]},{key:4,label:"手机号码",visible:!0,children:[]},{key:5,label:"状态",visible:!0,children:[]},{key:6,label:"创建时间",visible:!0,children:[]}]),G=f(),W=f(),S=f(),L=f(),_e=f(),C=Y({visible:!1,title:""}),X={userId:void 0,deptId:void 0,userName:"",nickName:void 0,password:"",phonenumber:void 0,email:void 0,sex:void 0,status:"0",remark:"",postIds:[],roleIds:[]},ve={form:{...X},queryParams:{pageNum:1,pageSize:10,userName:"",phonenumber:"",status:"",deptId:"",roleId:""},rules:{userName:[{required:!0,message:"用户名称不能为空",trigger:"blur"},{min:2,max:20,message:"用户名称长度必须介于 2 和 20 之间",trigger:"blur"}],nickName:[{required:!0,message:"用户昵称不能为空",trigger:"blur"}],password:[{required:!0,message:"用户密码不能为空",trigger:"blur"},{min:5,max:20,message:"用户密码长度必须介于 5 和 20 之间",trigger:"blur"},{pattern:/^[^<>"'|\\]+$/,message:`不能包含非法字符：< > " ' \\ |`,trigger:"blur"}],email:[{type:"email",message:"请输入正确的邮箱地址",trigger:["blur","change"]}],phonenumber:[{pattern:/^1[3|4|5|6|7|8|9][0-9]\d{8}$/,message:"请输入正确的手机号码",trigger:"blur"}],roleIds:[{required:!0,message:"用户角色不能为空",trigger:"blur"}]}},be=Y(ve),{queryParams:i,form:r,rules:ge}=ae(be);Ze(()=>{var s;(s=G.value)==null||s.filter(me.value)},{flush:"post"});const ye=async()=>{const s=await E.deptTreeSelect();A.value=s.data},I=async()=>{K.value=!0;const s=await E.listVpadminUser(n==null?void 0:n.addDateRange(i.value,x.value));K.value=!1,Q.value=s.rows,M.value=s.total},D=()=>{i.value.pageNum=1,I()},Ve=()=>{var s,e;x.value=["",""],(s=W.value)==null||s.resetFields(),i.value.pageNum=1,i.value.deptId=void 0,i.value.email="",(e=G.value)==null||e.setCurrentKey(void 0),D()},ke=async s=>{const e=(s==null?void 0:s.userId)||pe.value,[p]=await ne(n==null?void 0:n.$modal.confirm('是否确认删除用户编号为"'+e+'"的数据项？'));p||(await E.delUser(e),await I(),n==null||n.$modal.msgSuccess("删除成功"))},we=async s=>{let e=s.status==="0"?"启用":"停用";try{await(n==null?void 0:n.$modal.confirm('确认要"'+e+'""'+s.userName+'"用户吗?')),await E.changeUserStatus(s.userId,s.status),n==null||n.$modal.msgSuccess(e+"成功")}catch{s.status=s.status==="0"?"1":"0"}},he=s=>{const e=s.userId;de.push("/system/user-auth/role/"+e)},Ie=async s=>{const[e,p]=await ne(re.prompt('请输入"'+s.userName+'"的新密码',"提示",{confirmButtonText:"确定",cancelButtonText:"取消",closeOnClickModal:!1,inputPattern:/^.{5,20}$/,inputErrorMessage:"用户密码长度必须介于 5 和 20 之间",inputValidator:m=>{if(/<|>|"|'|\||\\/.test(m))return`不能包含非法字符：< > " ' \\ |`}}));!e&&p&&(await E.resetUserPwd(s.userId,p.value),n==null||n.$modal.msgSuccess("修改成功，新密码是："+p.value))},Ue=()=>{n==null||n.download("system/user/exportVpadmin",{...i.value},`user_${new Date().getTime()}.xlsx`)},Ee=()=>{n==null||n.download("system/user/importTemplate",{},`user_template_${new Date().getTime()}.xlsx`)},Ce=()=>{_.isUploading=!0},Ne=(s,e)=>{var p;_.open=!1,_.isUploading=!1,(p=L.value)==null||p.handleRemove(e),re.alert("<div style='overflow: auto;overflow-x: hidden;max-height: 70vh;padding: 10px 20px 0;'>"+s.msg+"</div>","导入结果",{dangerouslyUseHTMLString:!0}),I()};function xe(){var s;(s=L.value)==null||s.submit()}const Se=()=>{var s;r.value={...X},(s=S.value)==null||s.resetFields()},De=()=>{C.visible=!1,Se()},Re=()=>{var s;(s=S.value)==null||s.validate(async e=>{e&&(r.value.userId?await E.updateUser(r.value):await E.addUser(r.value),n==null||n.$modal.msgSuccess("操作成功"),C.visible=!1,await I())})},Te=()=>{C.visible=!1,Fe()},Fe=()=>{var s,e;(s=S.value)==null||s.resetFields(),(e=S.value)==null||e.clearValidate(),r.value.id=void 0,r.value.status="1"};Je(()=>{ye(),I(),n==null||n.getConfigKey("sys.user.initPassword").then(s=>{fe.value=s.data})});async function $e(s){const e=await Il(s);j.value=e.data,r.value.postIds=[]}return(s,e)=>{const p=tl,m=kl,P=ol,q=sl,Pe=hl,y=nl,Z=wl,J=Ul,v=El,qe=Vl,k=Cl,w=gl,Be=rl,O=ul,Ke=yl,Me=bl,Le=vl,Oe=Nl,Ye=xl,ee=dl,ze=_l,He=il,Qe=cl,Ae=fl,je=ml,B=el("hasPermi"),Ge=pl;return d(),N("div",Sl,[l(k,{gutter:20},{default:t(()=>[l(v,{lg:24,xs:24},{default:t(()=>{var o,le;return[l(ll,{"enter-active-class":(o=a(n))==null?void 0:o.animate.searchAnimate.enter,"leave-active-class":(le=a(n))==null?void 0:le.animate.searchAnimate.leave},{default:t(()=>[U(V("div",Dl,[l(J,{shadow:"hover"},{default:t(()=>[l(Z,{ref_key:"queryFormRef",ref:W,model:a(i),inline:!0},{default:t(()=>[l(m,{label:"用户名称",prop:"userName"},{default:t(()=>[l(p,{modelValue:a(i).userName,"onUpdate:modelValue":e[0]||(e[0]=u=>a(i).userName=u),placeholder:"请输入用户名称",clearable:"",onKeyup:z(D,["enter"])},null,8,["modelValue"])]),_:1}),l(m,{label:"邮箱",prop:"email"},{default:t(()=>[l(p,{modelValue:a(i).email,"onUpdate:modelValue":e[1]||(e[1]=u=>a(i).email=u),placeholder:"请输入用户名称",clearable:"",onKeyup:z(D,["enter"])},null,8,["modelValue"])]),_:1}),l(m,{label:"Source",prop:"source"},{default:t(()=>[l(p,{modelValue:a(i).source,"onUpdate:modelValue":e[2]||(e[2]=u=>a(i).source=u),placeholder:"请输入用户名称",clearable:"",onKeyup:z(D,["enter"])},null,8,["modelValue"])]),_:1}),l(m,{label:"状态",prop:"status"},{default:t(()=>[l(q,{modelValue:a(i).status,"onUpdate:modelValue":e[3]||(e[3]=u=>a(i).status=u),placeholder:"用户状态",clearable:""},{default:t(()=>[(d(!0),N(T,null,F(a(H),u=>(d(),c(P,{key:u.value,label:u.label,value:u.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(m,{label:"创建时间",style:{width:"308px"}},{default:t(()=>[l(Pe,{modelValue:a(x),"onUpdate:modelValue":e[4]||(e[4]=u=>te(x)?x.value=u:null),"value-format":"YYYY-MM-DD HH:mm:ss",type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期","default-time":[new Date(2e3,1,1,0,0,0),new Date(2e3,1,1,23,59,59)]},null,8,["modelValue","default-time"])]),_:1}),l(m,null,{default:t(()=>[l(y,{type:"primary",icon:"Search",onClick:D},{default:t(()=>e[24]||(e[24]=[g("搜索")])),_:1}),l(y,{icon:"Refresh",onClick:Ve},{default:t(()=>e[25]||(e[25]=[g("重置")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1})],512),[[oe,a($)]])]),_:1},8,["enter-active-class","leave-active-class"]),l(J,{shadow:"hover"},{header:t(()=>[l(k,{gutter:10},{default:t(()=>[l(v,{span:1.5},{default:t(()=>[U((d(),c(y,{type:"primary",plain:"",icon:"Download",onClick:Ue},{default:t(()=>e[26]||(e[26]=[g("导出")])),_:1})),[[B,["vpadmin:project:export"]]])]),_:1}),l(qe,{showSearch:a($),"onUpdate:showSearch":e[5]||(e[5]=u=>te($)?$.value=u:null),onQueryTable:I},null,8,["showSearch"])]),_:1})]),default:t(()=>[U((d(),c(Ke,{data:a(Q)},{default:t(()=>[a(h)[0].visible?(d(),c(w,{key:"userId",label:"用户编号",align:"center",prop:"userId"})):b("",!0),a(h)[1].visible?(d(),c(w,{key:"userName",label:"用户名称",align:"center",prop:"userName","show-overflow-tooltip":!0})):b("",!0),a(h)[3].visible?(d(),c(w,{key:"deptName",label:"部门",align:"center",prop:"deptName","show-overflow-tooltip":!0})):b("",!0),a(h)[4].visible?(d(),c(w,{key:"email",label:"邮箱",align:"center",prop:"email",width:"200"})):b("",!0),a(h)[5].visible?(d(),c(w,{key:"source",label:"Source",align:"center",prop:"source",width:"100"})):b("",!0),a(h)[6].visible?(d(),c(w,{key:"status",label:"状态",align:"center",width:"80"},{default:t(u=>[l(Be,{modelValue:u.row.status,"onUpdate:modelValue":R=>u.row.status=R,"active-value":"0","inactive-value":"1",onChange:R=>we(u.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1})):b("",!0),a(h)[6].visible?(d(),c(w,{key:6,label:"创建时间",align:"center",prop:"createTime",width:"160"},{default:t(u=>[V("span",null,se(u.row.createTime),1)]),_:1})):b("",!0),l(w,{label:"操作",fixed:"right",width:"120","class-name":"small-padding fixed-width"},{default:t(u=>[u.row.userId!==1?(d(),c(O,{key:0,content:"删除",placement:"top"},{default:t(()=>[U(l(y,{link:"",type:"primary",icon:"Delete",onClick:R=>ke(u.row)},null,8,["onClick"]),[[B,["system:user:remove"]]])]),_:2},1024)):b("",!0),u.row.userId!==1?(d(),c(O,{key:1,content:"重置密码",placement:"top"},{default:t(()=>[U(l(y,{link:"",type:"primary",icon:"Key",onClick:R=>Ie(u.row)},null,8,["onClick"]),[[B,["system:user:resetPwd"]]])]),_:2},1024)):b("",!0),u.row.userId!==1?(d(),c(O,{key:2,content:"分配角色",placement:"top"},{default:t(()=>[U(l(y,{link:"",type:"primary",icon:"CircleCheck",onClick:R=>he(u.row)},null,8,["onClick"]),[[B,["system:user:edit"]]])]),_:2},1024)):b("",!0)]),_:1})]),_:1},8,["data"])),[[Ge,a(K)]]),U(l(Me,{page:a(i).pageNum,"onUpdate:page":e[6]||(e[6]=u=>a(i).pageNum=u),limit:a(i).pageSize,"onUpdate:limit":e[7]||(e[7]=u=>a(i).pageSize=u),total:a(M),onPagination:I},null,8,["page","limit","total"]),[[oe,a(M)>0]])]),_:1})]}),_:1})]),_:1}),l(ee,{ref_key:"formDialogRef",ref:_e,modelValue:a(C).visible,"onUpdate:modelValue":e[20]||(e[20]=o=>a(C).visible=o),title:a(C).title,width:"600px","append-to-body":"",onClose:Te},{footer:t(()=>[V("div",Rl,[l(y,{type:"primary",onClick:Re},{default:t(()=>e[27]||(e[27]=[g("确 定")])),_:1}),l(y,{onClick:e[19]||(e[19]=o=>De())},{default:t(()=>e[28]||(e[28]=[g("取 消")])),_:1})])]),default:t(()=>[l(Z,{ref_key:"userFormRef",ref:S,model:a(r),rules:a(ge),"label-width":"80px"},{default:t(()=>[l(k,null,{default:t(()=>[l(v,{span:12},{default:t(()=>[l(m,{label:"用户昵称",prop:"nickName"},{default:t(()=>[l(p,{modelValue:a(r).nickName,"onUpdate:modelValue":e[8]||(e[8]=o=>a(r).nickName=o),placeholder:"请输入用户昵称",maxlength:"30"},null,8,["modelValue"])]),_:1})]),_:1}),l(v,{span:12},{default:t(()=>[l(m,{label:"归属部门",prop:"deptId"},{default:t(()=>[l(Le,{modelValue:a(r).deptId,"onUpdate:modelValue":e[9]||(e[9]=o=>a(r).deptId=o),data:a(A),props:{value:"id",label:"label",children:"children"},"value-key":"id",placeholder:"请选择归属部门","check-strictly":"",onChange:$e},null,8,["modelValue","data"])]),_:1})]),_:1})]),_:1}),l(k,null,{default:t(()=>[l(v,{span:12},{default:t(()=>[l(m,{label:"手机号码",prop:"phonenumber"},{default:t(()=>[l(p,{modelValue:a(r).phonenumber,"onUpdate:modelValue":e[10]||(e[10]=o=>a(r).phonenumber=o),placeholder:"请输入手机号码",maxlength:"11"},null,8,["modelValue"])]),_:1})]),_:1}),l(v,{span:12},{default:t(()=>[l(m,{label:"邮箱",prop:"email"},{default:t(()=>[l(p,{modelValue:a(r).email,"onUpdate:modelValue":e[11]||(e[11]=o=>a(r).email=o),placeholder:"请输入邮箱",maxlength:"50"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(k,null,{default:t(()=>[l(v,{span:12},{default:t(()=>[a(r).userId==null?(d(),c(m,{key:0,label:"用户名称",prop:"userName"},{default:t(()=>[l(p,{modelValue:a(r).userName,"onUpdate:modelValue":e[12]||(e[12]=o=>a(r).userName=o),placeholder:"请输入用户名称",maxlength:"30"},null,8,["modelValue"])]),_:1})):b("",!0)]),_:1}),l(v,{span:12},{default:t(()=>[a(r).userId==null?(d(),c(m,{key:0,label:"用户密码",prop:"password"},{default:t(()=>[l(p,{modelValue:a(r).password,"onUpdate:modelValue":e[13]||(e[13]=o=>a(r).password=o),placeholder:"请输入用户密码",type:"password",maxlength:"20","show-password":""},null,8,["modelValue"])]),_:1})):b("",!0)]),_:1})]),_:1}),l(k,null,{default:t(()=>[l(v,{span:12},{default:t(()=>[l(m,{label:"用户性别"},{default:t(()=>[l(q,{modelValue:a(r).sex,"onUpdate:modelValue":e[14]||(e[14]=o=>a(r).sex=o),placeholder:"请选择"},{default:t(()=>[(d(!0),N(T,null,F(a(ie),o=>(d(),c(P,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(v,{span:12},{default:t(()=>[l(m,{label:"状态"},{default:t(()=>[l(Ye,{modelValue:a(r).status,"onUpdate:modelValue":e[15]||(e[15]=o=>a(r).status=o)},{default:t(()=>[(d(!0),N(T,null,F(a(H),o=>(d(),c(Oe,{key:o.value,value:o.value},{default:t(()=>[g(se(o.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(k,null,{default:t(()=>[l(v,{span:12},{default:t(()=>[l(m,{label:"岗位"},{default:t(()=>[l(q,{modelValue:a(r).postIds,"onUpdate:modelValue":e[16]||(e[16]=o=>a(r).postIds=o),multiple:"",placeholder:"请选择"},{default:t(()=>[(d(!0),N(T,null,F(a(j),o=>(d(),c(P,{key:o.postId,label:o.postName,value:o.postId,disabled:o.status=="1"},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(v,{span:12},{default:t(()=>[l(m,{label:"角色",prop:"roleIds"},{default:t(()=>[l(q,{modelValue:a(r).roleIds,"onUpdate:modelValue":e[17]||(e[17]=o=>a(r).roleIds=o),filterable:"",multiple:"",placeholder:"请选择"},{default:t(()=>[(d(!0),N(T,null,F(a(ce),o=>(d(),c(P,{key:o.roleId,label:o.roleName,value:o.roleId,disabled:o.status=="1"},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(k,null,{default:t(()=>[l(v,{span:24},{default:t(()=>[l(m,{label:"备注"},{default:t(()=>[l(p,{modelValue:a(r).remark,"onUpdate:modelValue":e[18]||(e[18]=o=>a(r).remark=o),type:"textarea",placeholder:"请输入内容"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),l(ee,{modelValue:a(_).open,"onUpdate:modelValue":e[23]||(e[23]=o=>a(_).open=o),title:a(_).title,width:"400px","append-to-body":""},{footer:t(()=>[V("div",$l,[l(y,{type:"primary",onClick:xe},{default:t(()=>e[33]||(e[33]=[g("确 定")])),_:1}),l(y,{onClick:e[22]||(e[22]=o=>a(_).open=!1)},{default:t(()=>e[34]||(e[34]=[g("取 消")])),_:1})])]),default:t(()=>[l(je,{ref_key:"uploadRef",ref:L,limit:1,accept:".xlsx, .xls",headers:a(_).headers,action:a(_).url+"?updateSupport="+a(_).updateSupport,disabled:a(_).isUploading,"on-progress":Ce,"on-success":Ne,"auto-upload":!1,drag:""},{tip:t(()=>[V("div",Tl,[V("div",Fl,[l(Qe,{modelValue:a(_).updateSupport,"onUpdate:modelValue":e[21]||(e[21]=o=>a(_).updateSupport=o)},null,8,["modelValue"]),e[29]||(e[29]=g("是否更新已经存在的用户数据"))]),e[31]||(e[31]=V("span",null,"仅允许导入xls、xlsx格式文件。",-1)),l(Ae,{type:"primary",underline:!1,style:{"font-size":"12px","vertical-align":"baseline"},onClick:Ee},{default:t(()=>e[30]||(e[30]=[g("下载模板")])),_:1})])]),default:t(()=>[l(He,{class:"el-icon--upload"},{default:t(()=>[l(ze)]),_:1}),e[32]||(e[32]=V("div",{class:"el-upload__text"},[g("将文件拖到此处，或"),V("em",null,"点击上传")],-1))]),_:1},8,["headers","action","disabled"])]),_:1},8,["modelValue","title"])])}}});export{fa as default};
