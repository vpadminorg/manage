import{aE as F,i as S,n as V,bB as A,Y as I,D as L,br as E,O as k,d as P,C as H,R as U,bx as Y,cK as z,bc as D,bd as Z,cu as $,aY as G,r as B,Z as M,b as J,ar as T,aR as Q}from"./index-D4nD6lq3.js";import{_ as R}from"./index-CsUbaV0a.js";const W=(e,{attrs:s,emit:i},{select:u,tree:n,key:a})=>{const o=F("tree-select");return S(()=>e.data,()=>{e.filterable&&V(()=>{var t,h;(h=n.value)==null||h.filter((t=u.value)==null?void 0:t.states.inputValue)})},{flush:"post"}),{...A(I(e),Object.keys(L.props)),...s,"onUpdate:modelValue":t=>i(E,t),valueKey:a,popperClass:k(()=>{const t=[o.e("popper")];return e.popperClass&&t.push(e.popperClass),t.join(" ")}),filterMethod:(t="")=>{var h;e.filterMethod?e.filterMethod(t):e.remoteMethod?e.remoteMethod(t):(h=n.value)==null||h.filter(t)}}},X=P({extends:H,setup(e,s){const i=H.setup(e,s);delete i.selectOptionClick;const u=U().proxy;return V(()=>{i.select.states.cachedOptions.get(u.value)||i.select.onOptionCreate(u)}),S(()=>s.attrs.visible,n=>{i.states.visible=n},{immediate:!0}),i},methods:{selectOptionClick(){this.$el.parentElement.click()}}});function j(e){return e||e===0}function w(e){return Array.isArray(e)&&e.length}function K(e){return Array.isArray(e)?e:j(e)?[e]:[]}function _(e,s,i,u,n){for(let a=0;a<e.length;a++){const o=e[a];if(s(o,a,e,n))return u?u(o,a,e,n):o;{const C=i(o);if(w(C)){const t=_(C,s,i,u,o);if(t)return t}}}}function p(e,s,i,u){for(let n=0;n<e.length;n++){const a=e[n];s(a,n,e,u);const o=i(a);w(o)&&p(o,s,i,a)}}const ee=(e,{attrs:s,slots:i,emit:u},{select:n,tree:a,key:o})=>{S(()=>e.modelValue,()=>{e.showCheckbox&&V(()=>{const l=a.value;l&&!Y(l.getCheckedKeys(),K(e.modelValue))&&l.setCheckedKeys(K(e.modelValue))})},{immediate:!0,deep:!0});const C=k(()=>({value:o.value,label:"label",children:"children",disabled:"disabled",isLeaf:"isLeaf",...e.props})),t=(l,c)=>{var d;const r=C.value[l];return D(r)?r(c,(d=a.value)==null?void 0:d.getNode(t("value",c))):c[r]},h=K(e.modelValue).map(l=>_(e.data||[],c=>t("value",c)===l,c=>t("children",c),(c,d,r,v)=>v&&t("value",v))).filter(l=>j(l)),g=k(()=>{if(!e.renderAfterExpand&&!e.lazy)return[];const l=[];return p(e.data.concat(e.cacheData),c=>{const d=t("value",c);l.push({value:d,currentLabel:t("label",c),isDisabled:t("disabled",c)})},c=>t("children",c)),l});return{...A(I(e),Object.keys(R.props)),...s,nodeKey:o,expandOnClickNode:k(()=>!e.checkStrictly&&e.expandOnClickNode),defaultExpandedKeys:k(()=>e.defaultExpandedKeys?e.defaultExpandedKeys.concat(h):h),renderContent:(l,{node:c,data:d,store:r})=>l(X,{value:t("value",d),label:t("label",d),disabled:t("disabled",d),visible:c.visible},e.renderContent?()=>e.renderContent(l,{node:c,data:d,store:r}):i.default?()=>i.default({node:c,data:d,store:r}):void 0),filterNodeMethod:(l,c,d)=>e.filterNodeMethod?e.filterNodeMethod(l,c,d):l?new RegExp(z(l),"i").test(t("label",c)||""):!0,onNodeClick:(l,c,d)=>{var r,v,m,b;if((r=s.onNodeClick)==null||r.call(s,l,c,d),!(e.showCheckbox&&e.checkOnClickNode)){if(!e.showCheckbox&&(e.checkStrictly||c.isLeaf)){if(!t("disabled",l)){const N=(v=n.value)==null?void 0:v.states.options.get(t("value",l));(m=n.value)==null||m.handleOptionSelect(N)}}else e.expandOnClickNode&&d.proxy.handleExpandIconClick();(b=n.value)==null||b.focus()}},onCheck:(l,c)=>{var d;if(!e.showCheckbox)return;const r=t("value",l),v={};p([a.value.store.root],f=>v[f.key]=f,f=>f.childNodes);const m=c.checkedKeys,b=e.multiple?K(e.modelValue).filter(f=>!(f in v)&&!m.includes(f)):[],N=b.concat(m);if(e.checkStrictly)u(E,e.multiple?N:N.includes(r)?r:void 0);else if(e.multiple)u(E,b.concat(a.value.getCheckedKeys(!0)));else{const f=_([l],y=>!w(t("children",y))&&!t("disabled",y),y=>t("children",y)),x=f?t("value",f):void 0,q=j(e.modelValue)&&!!_([l],y=>t("value",y)===e.modelValue,y=>t("children",y));u(E,x===e.modelValue||q?void 0:x)}V(()=>{var f;const x=K(e.modelValue);a.value.setCheckedKeys(x),(f=s.onCheck)==null||f.call(s,l,{checkedKeys:a.value.getCheckedKeys(),checkedNodes:a.value.getCheckedNodes(),halfCheckedKeys:a.value.getHalfCheckedKeys(),halfCheckedNodes:a.value.getHalfCheckedNodes()})}),(d=n.value)==null||d.focus()},cacheOptions:g}};var te=P({props:{data:{type:Array,default:()=>[]}},setup(e){const s=Z($);return S(()=>e.data,()=>{var i;e.data.forEach(n=>{s.states.cachedOptions.has(n.value)||s.states.cachedOptions.set(n.value,n)});const u=((i=s.selectRef)==null?void 0:i.querySelectorAll("input"))||[];G&&!Array.from(u).includes(document.activeElement)&&s.setSelected()},{flush:"post",immediate:!0}),()=>{}}});const le=P({name:"ElTreeSelect",inheritAttrs:!1,props:{...L.props,...R.props,cacheData:{type:Array,default:()=>[]}},setup(e,s){const{slots:i,expose:u}=s,n=B(),a=B(),o=k(()=>e.nodeKey||e.valueKey||"value"),C=W(e,s,{select:n,tree:a,key:o}),{cacheOptions:t,...h}=ee(e,s,{select:n,tree:a,key:o}),g=M({});return u(g),J(()=>{Object.assign(g,{...A(a.value,["filter","updateKeyChildren","getCheckedNodes","setCheckedNodes","getCheckedKeys","setCheckedKeys","setChecked","getHalfCheckedNodes","getHalfCheckedKeys","getCurrentKey","getCurrentNode","setCurrentKey","setCurrentNode","getNode","remove","append","insertBefore","insertAfter"]),...A(n.value,["focus","blur"])})}),()=>T(L,M({...C,ref:l=>n.value=l}),{...i,default:()=>[T(te,{data:t.value}),T(R,M({...h,ref:l=>a.value=l}))]})}});var O=Q(le,[["__file","tree-select.vue"]]);O.install=e=>{e.component(O.name,O)};const ne=O,se=ne;export{se as E};
