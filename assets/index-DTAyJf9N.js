import{d as B,Y as h,r as n,Z as I,b as J,o as m,c as j,j as e,k as o,w as D,m as C,e as l,x as F,F as X,q as ee,p as w,y as M,W as R,a0 as te,t as U,Q as ae,R as oe,G as le,C as re,D as se,I as ne,a1 as ie,v as ue}from"./index-D4nD6lq3.js";import{_ as de}from"./index-BH-aX6uU.js";import{E as pe,a as me}from"./el-table-column-Nw9CsZCh.js";import"./el-checkbox-DpS0yAA0.js";import{_ as ce}from"./index-Cu5tDpmP.js";/* empty css               */import{_ as _e}from"./index-CeC1FWzw.js";/* empty css                */import{E as ge,a as ve}from"./el-form-item-oceQVxPu.js";import{E as fe}from"./el-date-picker-Bpr8CaQ-.js";import{_ as ye,l as be,g as De}from"./DeployDetailDialog-BxyFb0_K.js";import{E as we}from"./index-DWSlLEJi.js";import{E as Se}from"./index-fvT2sidt.js";import"./_initCloneObject-Cyh6om-O.js";/* empty css                */import"./index-CsUbaV0a.js";import"./_baseClone-zQQn4kcl.js";import"./index-DfYNOEwA.js";import"./el-descriptions-item-CKWQQURW.js";const Ve={class:"p-2"},Ee={class:"mb-[10px]"},Te=B({name:"DeployHistory"}),We=B({...Te,setup(Ne){const{proxy:s}=oe(),{vpa_deploy_status:S}=h(s==null?void 0:s.useDict("vpa_deploy_status")),V=n([]);n(!1);const v=n(!0),f=n(!0);n([]),n(!0),n(!0);const y=n(0),c=n(["",""]),E=n();n();const i=I({visible:!1,title:"发布详情",data:{projectName:"",deployDescription:"",startTime:"",errorMessage:""}}),H=I({form:{...{id:void 0,projectId:void 0,projectName:void 0,deployDescription:void 0,deployStatus:void 0,startTime:void 0,endTime:void 0,duration:void 0,commitId:void 0,errorMessage:void 0,deptId:void 0,userId:void 0}},queryParams:{pageNum:1,pageSize:10,projectName:void 0,deployDescription:void 0,deployStatus:void 0,params:{startTime:void 0}},rules:{id:[{required:!0,message:"主键不能为空",trigger:"blur"}],projectId:[{required:!0,message:"项目ID不能为空",trigger:"blur"}],projectName:[{required:!0,message:"项目名称不能为空",trigger:"blur"}],deployDescription:[{required:!0,message:"发布描述不能为空",trigger:"blur"}],deployStatus:[{required:!0,message:"发布状态不能为空",trigger:"change"}],startTime:[{required:!0,message:"开始时间不能为空",trigger:"blur"}],endTime:[{required:!0,message:"结束时间不能为空",trigger:"blur"}],duration:[{required:!0,message:"编译耗时不能为空",trigger:"blur"}],commitId:[{required:!0,message:"发布的提交ID不能为空",trigger:"blur"}],errorMessage:[{required:!0,message:"错误信息不能为空",trigger:"blur"}],deptId:[{required:!0,message:"部门id不能为空",trigger:"blur"}],userId:[{required:!0,message:"用户id不能为空",trigger:"blur"}]}}),{queryParams:r,form:qe,rules:he}=h(H),_=async()=>{v.value=!0,r.value.params={},s==null||s.addDateRange(r.value,c.value,"StartTime");const u=await be(r.value);V.value=u.rows,y.value=u.total,v.value=!1},g=()=>{r.value.pageNum=1,_()},Y=()=>{var u;c.value=["",""],(u=E.value)==null||u.resetFields(),g()},L=async u=>{try{const t=await De(u.id);i.data.projectName=t.data.projectName,i.data.deployDescription=t.data.deployDescription,i.data.startTime=t.data.startTime,i.data.errorMessage=t.data.errorMessage,i.visible=!0}catch{s==null||s.$modal.msgError("获取详情失败")}};return J(()=>{_()}),(u,t)=>{var k,q;const T=le,p=ge,P=re,Q=se,z=fe,b=ne,K=ve,N=we,x=_e,A=Se,d=pe,$=ce,G=ie,O=me,W=de,Z=ue;return m(),j("div",Ve,[e(te,{"enter-active-class":(k=l(s))==null?void 0:k.animate.searchAnimate.enter,"leave-active-class":(q=l(s))==null?void 0:q.animate.searchAnimate.leave},{default:o(()=>[D(C("div",Ee,[e(N,{shadow:"hover"},{default:o(()=>[e(K,{ref_key:"queryFormRef",ref:E,model:l(r),inline:!0},{default:o(()=>[e(p,{label:"项目名称",prop:"projectName"},{default:o(()=>[e(T,{modelValue:l(r).projectName,"onUpdate:modelValue":t[0]||(t[0]=a=>l(r).projectName=a),placeholder:"请输入项目名称",clearable:"",onKeyup:F(g,["enter"])},null,8,["modelValue"])]),_:1}),e(p,{label:"发布描述",prop:"deployDescription"},{default:o(()=>[e(T,{modelValue:l(r).deployDescription,"onUpdate:modelValue":t[1]||(t[1]=a=>l(r).deployDescription=a),placeholder:"请输入发布描述",clearable:"",onKeyup:F(g,["enter"])},null,8,["modelValue"])]),_:1}),e(p,{label:"发布状态",prop:"deployStatus"},{default:o(()=>[e(Q,{modelValue:l(r).deployStatus,"onUpdate:modelValue":t[2]||(t[2]=a=>l(r).deployStatus=a),placeholder:"请选择发布状态",clearable:""},{default:o(()=>[(m(!0),j(X,null,ee(l(S),a=>(m(),w(P,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(p,{label:"开始时间",style:{width:"308px"}},{default:o(()=>[e(z,{modelValue:c.value,"onUpdate:modelValue":t[3]||(t[3]=a=>c.value=a),"value-format":"YYYY-MM-DD HH:mm:ss",type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期","default-time":[new Date(2e3,1,1,0,0,0),new Date(2e3,1,1,23,59,59)]},null,8,["modelValue","default-time"])]),_:1}),e(p,null,{default:o(()=>[e(b,{type:"primary",icon:"Search",onClick:g},{default:o(()=>t[8]||(t[8]=[M("搜索")])),_:1}),e(b,{icon:"Refresh",onClick:Y},{default:o(()=>t[9]||(t[9]=[M("重置")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1})],512),[[R,f.value]])]),_:1},8,["enter-active-class","leave-active-class"]),e(N,{shadow:"never"},{header:o(()=>[e(A,{gutter:10,class:"mb8"},{default:o(()=>[e(x,{showSearch:f.value,"onUpdate:showSearch":t[4]||(t[4]=a=>f.value=a),onQueryTable:_},null,8,["showSearch"])]),_:1})]),default:o(()=>[D((m(),w(O,{data:V.value},{default:o(()=>[U("",!0),e(d,{label:"项目名称",align:"center",prop:"projectName"}),e(d,{label:"发布描述",align:"center",prop:"deployDescription"}),e(d,{label:"发布状态",align:"center",prop:"deployStatus"},{default:o(a=>[e($,{options:l(S),value:a.row.deployStatus},null,8,["options","value"])]),_:1}),e(d,{label:"开始时间",align:"center",prop:"startTime",width:"180"},{default:o(a=>[C("span",null,ae(u.parseTime(a.row.startTime)),1)]),_:1}),e(d,{label:"编译耗时",align:"center",prop:"duration"}),e(d,{label:"操作",align:"center","class-name":"small-padding fixed-width"},{default:o(a=>[a.row.deployStatus==="0"?(m(),w(G,{key:0,content:"查看详情",placement:"top"},{default:o(()=>[e(b,{link:"",type:"primary",icon:"View",onClick:Ie=>L(a.row)},null,8,["onClick"])]),_:2},1024)):U("",!0)]),_:1})]),_:1},8,["data"])),[[Z,v.value]]),D(e(W,{page:l(r).pageNum,"onUpdate:page":t[5]||(t[5]=a=>l(r).pageNum=a),limit:l(r).pageSize,"onUpdate:limit":t[6]||(t[6]=a=>l(r).pageSize=a),total:y.value,onPagination:_},null,8,["page","limit","total"]),[[R,y.value>0]])]),_:1}),e(ye,{modelValue:l(i).visible,"onUpdate:modelValue":t[7]||(t[7]=a=>l(i).visible=a),title:l(i).title,data:l(i).data},null,8,["modelValue","title","data"])])}}});export{We as default};
