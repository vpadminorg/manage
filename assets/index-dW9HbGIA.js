import{d as be,a as ll,$ as ce,r as i,a0 as fe,b as tl,J as al,a1 as ol,o as p,c as Y,j as t,k as o,w as y,x as T,e as n,t as ve,F as J,p as W,m as v,Z as h,y as m,Y as _e,a2 as nl,q as R,R as ye,T as sl,n as ge,G as dl,C as ul,D as rl,I as il,ad as ml,a3 as pl,ah as cl,W as fl,v as vl}from"./index-SwfHvmsR.js";/* empty css                */import{E as _l}from"./el-checkbox-gjRiKN0S.js";/* empty css                       *//* empty css                 */import{E as yl}from"./el-input-number-DEtIMJqx.js";import{_ as gl}from"./index-CwtlzU0C.js";import{E as kl,a as bl}from"./el-table-column-DvXjLevZ.js";/* empty css               */import{_ as hl}from"./index-D6KF0Zrv.js";/* empty css               *//* empty css                */import{E as Cl,a as Vl}from"./el-form-item-BTGfmHo9.js";import{E as Sl}from"./el-date-picker-CnLWeVPa.js";import{l as wl,d as El,e as Rl,g as ke,u as Ul,f as Nl,h as Il,i as Kl}from"./index-CdO65AIb.js";import{r as Dl,t as Tl}from"./index-_C1nwlOk.js";import{E as $l}from"./index-BMMvtxBL.js";import{E as xl}from"./index-Cu3lnjet.js";import{E as Fl}from"./index-gXvdNh_C.js";import{E as ql,a as Al}from"./index-gGP__DGH.js";import{E as Ml}from"./index-Bqsyo0rw.js";import"./index-CWevaQ9i.js";import"./_initCloneObject-DuYGRlJO.js";import"./_baseClone-D_rg-wPN.js";const Bl={class:"p-2"},Pl={class:"mb-[10px]"},Ll={class:"dialog-footer"},Ol={class:"dialog-footer"},Yl=be({name:"Role"}),_t=be({...Yl,setup(Hl){const he=ll(),{proxy:u}=sl(),{sys_normal_disable:Z}=ce(u==null?void 0:u.useDict("sys_normal_disable")),X=i(),H=i(!0),$=i(!0),x=i([]),ee=i(!0),Ce=i(!0),U=i(0),N=i(["",""]),I=i([]),F=i(!1),q=i(!1),A=i(!0),M=i(!1),B=i([]),S=i(!1),Ve=i([{value:"1",label:"全部数据权限"},{value:"2",label:"自定数据权限"},{value:"3",label:"本部门数据权限"},{value:"4",label:"本部门及以下数据权限"},{value:"5",label:"仅本人数据权限"}]),le=i(),j=i(),te=i(),g=i(),k=i(),z={roleId:void 0,roleSort:1,status:"0",roleName:"",roleKey:"",menuCheckStrictly:!0,deptCheckStrictly:!0,remark:"",dataScope:"1",menuIds:[],deptIds:[]},Se=fe({form:{...z},queryParams:{pageNum:1,pageSize:10,roleName:"",roleKey:"",status:""},rules:{roleName:[{required:!0,message:"角色名称不能为空",trigger:"blur"}],roleKey:[{required:!0,message:"权限字符不能为空",trigger:"blur"}],roleSort:[{required:!0,message:"角色顺序不能为空",trigger:"blur"}]}}),{form:s,queryParams:c,rules:we}=ce(Se),_=fe({visible:!1,title:""}),C=()=>{H.value=!0,wl(u==null?void 0:u.addDateRange(c.value,N.value)).then(a=>{X.value=a.rows,U.value=a.total,H.value=!1})},P=()=>{c.value.pageNum=1,C()},Ee=()=>{var a;N.value=["",""],(a=le.value)==null||a.resetFields(),P()},ae=async a=>{const e=(a==null?void 0:a.roleId)||x.value;await(u==null?void 0:u.$modal.confirm("是否确认删除角色编号为"+e+"数据项目")),await El(e),C(),u==null||u.$modal.msgSuccess("删除成功")},Re=()=>{u==null||u.download("system/role/export",{...c.value},`role_${new Date().getTime()}.xlsx`)},Ue=a=>{x.value=a.map(e=>e.roleId),ee.value=a.length!=1,Ce.value=!a.length},Ne=async a=>{let e=a.status==="0"?"启用":"停用";try{await(u==null?void 0:u.$modal.confirm('确认要"'+e+'""'+a.roleName+'"角色吗?')),await Rl(a.roleId,a.status),u==null||u.$modal.msgSuccess(e+"成功")}catch{a.status=a.status==="0"?"1":"0"}},Ie=a=>{he.push("/system/role-auth/user/"+a.roleId)},Ke=async()=>{const a=await Tl();I.value=a.data},De=()=>{var r,d;let a=(r=k.value)==null?void 0:r.getCheckedKeys(),e=(d=k.value)==null?void 0:d.getHalfCheckedKeys();return e&&(a==null||a.unshift.apply(a,e)),a},Q=()=>{var a,e;(a=g.value)==null||a.setCheckedKeys([]),F.value=!1,q.value=!1,A.value=!0,M.value=!1,s.value={...z},(e=j.value)==null||e.resetFields()},Te=()=>{Q(),Ke(),_.visible=!0,_.title="添加角色"},oe=async a=>{Q();const e=(a==null?void 0:a.roleId)||x.value[0],{data:r}=await ke(e);Object.assign(s.value,r),s.value.roleSort=Number(s.value.roleSort);const d=await $e(e);_.title="修改角色",_.visible=!0,d.checkedKeys.forEach(L=>{ge(()=>{var K;(K=g.value)==null||K.setChecked(L,!0,!1)})})},$e=a=>Dl(a).then(e=>(I.value=e.data.menus,e.data)),xe=async a=>{const e=await Kl(a);return B.value=e.data.depts,e.data},ne=(a,e)=>{if(e=="menu"){let r=I.value;for(let d=0;d<r.length;d++)g.value&&(g.value.store.nodesMap[r[d].id].expanded=a)}else if(e=="dept"){let r=B.value;for(let d=0;d<r.length;d++)k.value&&(k.value.store.nodesMap[r[d].id].expanded=a)}},se=(a,e)=>{var r,d;e=="menu"?(r=g.value)==null||r.setCheckedNodes(a?I.value:[]):e=="dept"&&((d=k.value)==null||d.setCheckedNodes(a?B.value:[]))},de=(a,e)=>{e=="menu"?s.value.menuCheckStrictly=a:e=="dept"&&(s.value.deptCheckStrictly=a)},Fe=()=>{var r,d;let a=(r=g.value)==null?void 0:r.getCheckedKeys(),e=(d=g.value)==null?void 0:d.getHalfCheckedKeys();return e&&(a==null||a.unshift.apply(a,e)),a},qe=()=>{var a;(a=j.value)==null||a.validate(async e=>{e&&(s.value.menuIds=Fe(),s.value.roleId?await Ul(s.value):await Nl(s.value),u==null||u.$modal.msgSuccess("操作成功"),_.visible=!1,C())})},Ae=()=>{Q(),_.visible=!1},Me=a=>{var e;a!=="2"&&((e=k.value)==null||e.setCheckedKeys([]))},Be=async a=>{const e=await ke(a.roleId);Object.assign(s.value,e.data);const r=await xe(a.roleId);S.value=!0,_.title="分配数据权限",await ge(()=>{var d;(d=k.value)==null||d.setCheckedKeys(r.checkedKeys)})},Pe=async()=>{s.value.roleId&&(s.value.deptIds=De(),await Il(s.value),u==null||u.$modal.msgSuccess("修改成功"),S.value=!1,C())},Le=()=>{var a;(a=te.value)==null||a.resetFields(),s.value={...z},S.value=!1};return tl(()=>{C()}),(a,e)=>{var me,pe;const r=dl,d=Cl,L=ul,K=rl,Oe=Sl,f=il,G=Vl,ue=$l,O=xl,Ye=hl,He=Fl,V=kl,je=ml,D=pl,ze=bl,Qe=gl,Ge=al("question-filled"),Je=cl,We=yl,Ze=ql,Xe=Al,w=_l,re=Ml,ie=fl,b=ol("hasPermi"),el=vl;return p(),Y("div",Bl,[t(nl,{"enter-active-class":(me=n(u))==null?void 0:me.animate.searchAnimate.enter,"leave-active-class":(pe=n(u))==null?void 0:pe.animate.searchAnimate.leave},{default:o(()=>[y(T("div",Pl,[t(ue,{shadow:"hover"},{default:o(()=>[t(G,{ref_key:"queryFormRef",ref:le,model:n(c),inline:!0},{default:o(()=>[t(d,{label:"角色名称",prop:"roleName"},{default:o(()=>[t(r,{modelValue:n(c).roleName,"onUpdate:modelValue":e[0]||(e[0]=l=>n(c).roleName=l),placeholder:"请输入角色名称",clearable:"",onKeyup:ve(P,["enter"])},null,8,["modelValue"])]),_:1}),t(d,{label:"权限字符",prop:"roleKey"},{default:o(()=>[t(r,{modelValue:n(c).roleKey,"onUpdate:modelValue":e[1]||(e[1]=l=>n(c).roleKey=l),placeholder:"请输入权限字符",clearable:"",onKeyup:ve(P,["enter"])},null,8,["modelValue"])]),_:1}),t(d,{label:"状态",prop:"status"},{default:o(()=>[t(K,{modelValue:n(c).status,"onUpdate:modelValue":e[2]||(e[2]=l=>n(c).status=l),placeholder:"角色状态",clearable:""},{default:o(()=>[(p(!0),Y(J,null,W(n(Z),l=>(p(),v(L,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(d,{label:"创建时间",style:{width:"308px"}},{default:o(()=>[t(Oe,{modelValue:n(N),"onUpdate:modelValue":e[3]||(e[3]=l=>h(N)?N.value=l:null),"value-format":"YYYY-MM-DD HH:mm:ss",type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期","default-time":[new Date(2e3,1,1,0,0,0),new Date(2e3,1,1,23,59,59)]},null,8,["modelValue","default-time"])]),_:1}),t(d,null,{default:o(()=>[t(f,{type:"primary",icon:"Search",onClick:P},{default:o(()=>[m("搜索")]),_:1}),t(f,{icon:"Refresh",onClick:Ee},{default:o(()=>[m("重置")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})],512),[[_e,n($)]])]),_:1},8,["enter-active-class","leave-active-class"]),t(ue,{shadow:"hover"},{header:o(()=>[t(He,{gutter:10},{default:o(()=>[t(O,{span:1.5},{default:o(()=>[y((p(),v(f,{type:"primary",plain:"",icon:"Plus",onClick:e[4]||(e[4]=l=>Te())},{default:o(()=>[m("新增")]),_:1})),[[b,["system:role:add"]]])]),_:1}),t(O,{span:1.5},{default:o(()=>[y((p(),v(f,{type:"success",plain:"",disabled:n(ee),icon:"Edit",onClick:e[5]||(e[5]=l=>oe())},{default:o(()=>[m("修改")]),_:1},8,["disabled"])),[[b,["system:role:edit"]]])]),_:1}),t(O,{span:1.5},{default:o(()=>[y((p(),v(f,{type:"danger",plain:"",disabled:n(x).length===0,onClick:e[6]||(e[6]=l=>ae())},{default:o(()=>[m("删除")]),_:1},8,["disabled"])),[[b,["system:role:delete"]]])]),_:1}),t(O,{span:1.5},{default:o(()=>[y((p(),v(f,{type:"warning",plain:"",icon:"Download",onClick:Re},{default:o(()=>[m("导出")]),_:1})),[[b,["system:role:export"]]])]),_:1}),t(Ye,{showSearch:n($),"onUpdate:showSearch":e[7]||(e[7]=l=>h($)?$.value=l:null),onQueryTable:C},null,8,["showSearch"])]),_:1})]),default:o(()=>[y((p(),v(ze,{ref:"roleTableRef",data:n(X),onSelectionChange:Ue},{default:o(()=>[t(V,{type:"selection",width:"55",align:"center"}),R("",!0),t(V,{label:"角色名称",prop:"roleName","show-overflow-tooltip":!0,width:"150"}),t(V,{label:"权限字符",prop:"roleKey","show-overflow-tooltip":!0,width:"200"}),t(V,{label:"显示顺序",prop:"roleSort",width:"100"}),t(V,{label:"状态",align:"center",width:"100"},{default:o(l=>[t(je,{modelValue:l.row.status,"onUpdate:modelValue":E=>l.row.status=E,"active-value":"0","inactive-value":"1",onChange:E=>Ne(l.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),t(V,{label:"创建时间",align:"center",prop:"createTime"},{default:o(l=>[T("span",null,ye(a.parseTime(l.row.createTime)),1)]),_:1}),t(V,{fixed:"right",label:"操作",width:"180"},{default:o(l=>[l.row.roleId!==1?(p(),v(D,{key:0,content:"修改",placement:"top"},{default:o(()=>[y(t(f,{link:"",type:"primary",icon:"Edit",onClick:E=>oe(l.row)},null,8,["onClick"]),[[b,["system:role:edit"]]])]),_:2},1024)):R("",!0),l.row.roleId!==1?(p(),v(D,{key:1,content:"删除",placement:"top"},{default:o(()=>[y(t(f,{link:"",type:"primary",icon:"Delete",onClick:E=>ae(l.row)},null,8,["onClick"]),[[b,["system:role:remove"]]])]),_:2},1024)):R("",!0),l.row.roleId!==1?(p(),v(D,{key:2,content:"数据权限",placement:"top"},{default:o(()=>[y(t(f,{link:"",type:"primary",icon:"CircleCheck",onClick:E=>Be(l.row)},null,8,["onClick"]),[[b,["system:role:edit"]]])]),_:2},1024)):R("",!0),l.row.roleId!==1?(p(),v(D,{key:3,content:"分配用户",placement:"top"},{default:o(()=>[y(t(f,{link:"",type:"primary",icon:"User",onClick:E=>Ie(l.row)},null,8,["onClick"]),[[b,["system:role:edit"]]])]),_:2},1024)):R("",!0)]),_:1})]),_:1},8,["data"])),[[el,n(H)]]),n(U)>0?(p(),v(Qe,{key:0,total:n(U),"onUpdate:total":e[8]||(e[8]=l=>h(U)?U.value=l:null),page:n(c).pageNum,"onUpdate:page":e[9]||(e[9]=l=>n(c).pageNum=l),limit:n(c).pageSize,"onUpdate:limit":e[10]||(e[10]=l=>n(c).pageSize=l),onPagination:C},null,8,["total","page","limit"])):R("",!0)]),_:1}),t(ie,{modelValue:n(_).visible,"onUpdate:modelValue":e[22]||(e[22]=l=>n(_).visible=l),title:n(_).title,width:"500px","append-to-body":""},{footer:o(()=>[T("div",Ll,[t(f,{type:"primary",onClick:qe},{default:o(()=>[m("确 定")]),_:1}),t(f,{onClick:Ae},{default:o(()=>[m("取 消")]),_:1})])]),default:o(()=>[t(G,{ref_key:"roleFormRef",ref:j,model:n(s),rules:n(we),"label-width":"100px"},{default:o(()=>[t(d,{label:"角色名称",prop:"roleName"},{default:o(()=>[t(r,{modelValue:n(s).roleName,"onUpdate:modelValue":e[11]||(e[11]=l=>n(s).roleName=l),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1}),t(d,{prop:"roleKey"},{label:o(()=>[T("span",null,[t(D,{content:"控制器中定义的权限字符，如：@SaCheckRole('admin')",placement:"top"},{default:o(()=>[t(Je,null,{default:o(()=>[t(Ge)]),_:1})]),_:1}),m(" 权限字符 ")])]),default:o(()=>[t(r,{modelValue:n(s).roleKey,"onUpdate:modelValue":e[12]||(e[12]=l=>n(s).roleKey=l),placeholder:"请输入权限字符"},null,8,["modelValue"])]),_:1}),t(d,{label:"角色顺序",prop:"roleSort"},{default:o(()=>[t(We,{modelValue:n(s).roleSort,"onUpdate:modelValue":e[13]||(e[13]=l=>n(s).roleSort=l),"controls-position":"right",min:0},null,8,["modelValue"])]),_:1}),t(d,{label:"状态"},{default:o(()=>[t(Xe,{modelValue:n(s).status,"onUpdate:modelValue":e[14]||(e[14]=l=>n(s).status=l)},{default:o(()=>[(p(!0),Y(J,null,W(n(Z),l=>(p(),v(Ze,{key:l.value,value:l.value},{default:o(()=>[m(ye(l.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(d,{label:"菜单权限"},{default:o(()=>[t(w,{modelValue:n(F),"onUpdate:modelValue":e[15]||(e[15]=l=>h(F)?F.value=l:null),onChange:e[16]||(e[16]=l=>ne(l,"menu"))},{default:o(()=>[m("展开/折叠")]),_:1},8,["modelValue"]),t(w,{modelValue:n(q),"onUpdate:modelValue":e[17]||(e[17]=l=>h(q)?q.value=l:null),onChange:e[18]||(e[18]=l=>se(l,"menu"))},{default:o(()=>[m("全选/全不选")]),_:1},8,["modelValue"]),t(w,{modelValue:n(s).menuCheckStrictly,"onUpdate:modelValue":e[19]||(e[19]=l=>n(s).menuCheckStrictly=l),onChange:e[20]||(e[20]=l=>de(l,"menu"))},{default:o(()=>[m("父子联动")]),_:1},8,["modelValue"]),t(re,{ref_key:"menuRef",ref:g,class:"tree-border",data:n(I),"show-checkbox":"","node-key":"id","check-strictly":!n(s).menuCheckStrictly,"empty-text":"加载中，请稍候",props:{label:"label",children:"children"}},null,8,["data","check-strictly"])]),_:1}),t(d,{label:"备注"},{default:o(()=>[t(r,{modelValue:n(s).remark,"onUpdate:modelValue":e[21]||(e[21]=l=>n(s).remark=l),type:"textarea",placeholder:"请输入内容"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),t(ie,{modelValue:n(S),"onUpdate:modelValue":e[32]||(e[32]=l=>h(S)?S.value=l:null),title:n(_).title,width:"500px","append-to-body":""},{footer:o(()=>[T("div",Ol,[t(f,{type:"primary",onClick:Pe},{default:o(()=>[m("确 定")]),_:1}),t(f,{onClick:Le},{default:o(()=>[m("取 消")]),_:1})])]),default:o(()=>[t(G,{ref_key:"dataScopeRef",ref:te,model:n(s),"label-width":"80px"},{default:o(()=>[t(d,{label:"角色名称"},{default:o(()=>[t(r,{modelValue:n(s).roleName,"onUpdate:modelValue":e[23]||(e[23]=l=>n(s).roleName=l),disabled:!0},null,8,["modelValue"])]),_:1}),t(d,{label:"权限字符"},{default:o(()=>[t(r,{modelValue:n(s).roleKey,"onUpdate:modelValue":e[24]||(e[24]=l=>n(s).roleKey=l),disabled:!0},null,8,["modelValue"])]),_:1}),t(d,{label:"权限范围"},{default:o(()=>[t(K,{modelValue:n(s).dataScope,"onUpdate:modelValue":e[25]||(e[25]=l=>n(s).dataScope=l),onChange:Me},{default:o(()=>[(p(!0),Y(J,null,W(n(Ve),l=>(p(),v(L,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),y(t(d,{label:"数据权限"},{default:o(()=>[t(w,{modelValue:n(A),"onUpdate:modelValue":e[26]||(e[26]=l=>h(A)?A.value=l:null),onChange:e[27]||(e[27]=l=>ne(l,"dept"))},{default:o(()=>[m("展开/折叠")]),_:1},8,["modelValue"]),t(w,{modelValue:n(M),"onUpdate:modelValue":e[28]||(e[28]=l=>h(M)?M.value=l:null),onChange:e[29]||(e[29]=l=>se(l,"dept"))},{default:o(()=>[m("全选/全不选")]),_:1},8,["modelValue"]),t(w,{modelValue:n(s).deptCheckStrictly,"onUpdate:modelValue":e[30]||(e[30]=l=>n(s).deptCheckStrictly=l),onChange:e[31]||(e[31]=l=>de(l,"dept"))},{default:o(()=>[m("父子联动")]),_:1},8,["modelValue"]),t(re,{ref_key:"deptRef",ref:k,class:"tree-border",data:n(B),"show-checkbox":"","default-expand-all":"","node-key":"id","check-strictly":!n(s).deptCheckStrictly,"empty-text":"加载中，请稍候",props:{label:"label",children:"children"}},null,8,["data","check-strictly"])]),_:1},512),[[_e,n(s).dataScope==="2"]])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}});export{_t as default};
