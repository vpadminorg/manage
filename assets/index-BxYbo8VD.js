import{aa as E,d as D,ac as h,r as d,as as M,O as q,i as G,o as r,c as u,j as p,k as g,y as c,e as _,F as I,m as b,Q as T,t as k,q as H,bn as Q,I as J,R as K,L as P}from"./index-D4nD6lq3.js";import{E as W}from"./el-link-BLiuvJwr.js";import{E as X}from"./el-upload-D0KnpWzb.js";/* empty css                    */function fe(o){return E({url:"/resource/oss/list",method:"get",params:o})}function Y(o){return E({url:"/resource/oss/listByIds/"+o,method:"get"})}function Z(o){return E({url:"/resource/oss/"+o,method:"delete"})}const x={class:"upload-file"},ee={key:0,class:"el-upload__tip"},le={style:{color:"#f56c6c"}},te={style:{color:"#f56c6c"}},se={class:"el-icon-document"},ae={class:"ele-upload-list__item-content-action"},oe=D({__name:"index",props:{modelValue:{type:[String,Object,Array],default:()=>[]},limit:h.number.def(5),fileSize:h.number.def(5),fileType:h.array.def(["doc","xls","ppt","txt","pdf"]),isShowTip:h.bool.def(!0)},emits:["update:modelValue"],setup(o,{emit:L}){const i=o,{proxy:t}=K(),S=L,f=d(0),v=d([]),O=d("https://api.leadcodingway.com/prod-api"+"/resource/oss/upload"),U=d(M()),n=d([]),V=q(()=>i.isShowTip&&(i.fileType||i.fileSize)),$=d();G(()=>i.modelValue,async e=>{if(e){let l=1,s=[];Array.isArray(e)?s=e:s=(await Y(e)).data.map(m=>({name:m.originalName,url:m.url,ossId:m.ossId})),n.value=s.map(a=>(a={name:a.name,url:a.url,ossId:a.ossId},a.uid=a.uid||new Date().getTime()+l++,a))}else return n.value=[],[]},{deep:!0,immediate:!0});const z=e=>{if(i.fileType.length){const l=e.name.split("."),s=l[l.length-1];if(!(i.fileType.indexOf(s)>=0))return t==null||t.$modal.msgError(`文件格式不正确, 请上传${i.fileType.join("/")}格式文件!`),!1}return i.fileSize&&!(e.size/1024/1024<i.fileSize)?(t==null||t.$modal.msgError(`上传文件大小不能超过 ${i.fileSize} MB!`),!1):(t==null||t.$modal.loading("正在上传文件，请稍候..."),f.value++,!0)},N=()=>{t==null||t.$modal.msgError(`上传文件数量不能超过 ${i.limit} 个!`)},C=()=>{t==null||t.$modal.msgError("上传文件失败")},j=(e,l)=>{var s;e.code===200?(v.value.push({name:e.data.fileName,url:e.data.url,ossId:e.data.ossId}),w()):(f.value--,t==null||t.$modal.closeLoading(),t==null||t.$modal.msgError(e.msg),(s=$.value)==null||s.handleRemove(l),w())},F=e=>{let l=n.value[e].ossId;Z(l),n.value.splice(e,1),S("update:modelValue",B(n.value))},w=()=>{f.value>0&&v.value.length===f.value&&(n.value=n.value.filter(e=>e.url!==void 0).concat(v.value),v.value=[],f.value=0,S("update:modelValue",B(n.value)),t==null||t.$modal.closeLoading())},R=e=>e.lastIndexOf("/")>-1?e.slice(e.lastIndexOf("/")+1):e,B=(e,l)=>{let s="";return l=l||",",e.forEach(a=>{a.ossId&&(s+=a.ossId+l)}),s!=""?s.substring(0,s.length-1):""};return(e,l)=>{const s=J,a=X,m=W;return r(),u("div",x,[p(a,{ref_key:"fileUploadRef",ref:$,multiple:"",action:_(O),"before-upload":z,"file-list":_(n),limit:o.limit,"on-error":C,"on-exceed":N,"on-success":j,"show-file-list":!1,headers:_(U),class:"upload-file-uploader"},{default:g(()=>[p(s,{type:"primary"},{default:g(()=>l[0]||(l[0]=[c("选取文件")])),_:1})]),_:1},8,["action","file-list","limit","headers"]),_(V)?(r(),u("div",ee,[l[3]||(l[3]=c(" 请上传 ")),o.fileSize?(r(),u(I,{key:0},[l[1]||(l[1]=c(" 大小不超过 ")),b("b",le,T(o.fileSize)+"MB",1)],64)):k("",!0),o.fileType?(r(),u(I,{key:1},[l[2]||(l[2]=c(" 格式为 ")),b("b",te,T(o.fileType.join("/")),1)],64)):k("",!0),l[4]||(l[4]=c(" 的文件 "))])):k("",!0),p(Q,{class:"upload-file-list el-upload-list el-upload-list--text",name:"el-fade-in-linear",tag:"ul"},{default:g(()=>[(r(!0),u(I,null,H(_(n),(y,A)=>(r(),u("li",{key:y.uid,class:"el-upload-list__item ele-upload-list__item-content"},[p(m,{href:`${y.url}`,underline:!1,target:"_blank"},{default:g(()=>[b("span",se,T(R(y.name)),1)]),_:2},1032,["href"]),b("div",ae,[p(s,{type:"danger",link:"",onClick:ne=>F(A)},{default:g(()=>l[5]||(l[5]=[c("删除")])),_:2},1032,["onClick"])])]))),128))]),_:1})])}}}),me=P(oe,[["__scopeId","data-v-bcbe3161"]]);export{me as _,fe as a,Z as d,Y as l};
