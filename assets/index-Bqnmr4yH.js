import{d as R,Y as q,r as m,Z as se,b as re,$ as ie,o as p,c as ue,j as l,k as o,w as c,m as E,e as s,x as z,y as i,W as B,a0 as de,p as w,X as me,t as C,Q as h,R as pe,G as ce,I as _e,a9 as fe,v as ve}from"./index-DDAliqzK.js";/* empty css                */import{_ as we}from"./index-RdVOGMqm.js";import{E as ge,a as ye}from"./el-table-column-DxCuKUMo.js";import"./el-checkbox-BucE91Wb.js";import{_ as ke}from"./index-cbmq-Xhe.js";/* empty css               */import{_ as be}from"./index-2eSzZeHe.js";/* empty css               */import{E as Ce,a as De}from"./el-form-item-Dtm-Ic1o.js";import{l as Ee,d as he}from"./index-DQUQ1Qj6.js";import{c as $e}from"./index-DCwUpbkk.js";import{E as Le}from"./index-CokWeuRK.js";import{E as Se}from"./index-D7RFStbC.js";import{E as Ve}from"./index-x58AzXEe.js";import"./_initCloneObject-B4dgLBrf.js";/* empty css                */import"./index-CSfZWYHi.js";import"./_baseClone-1ZiivbqZ.js";const Pe={class:"p-2"},Te={class:"search"},Ne=R({name:"Leave"}),Oe=R({...Ne,setup(qe){const{proxy:a}=pe(),{wf_business_status:U}=q(a==null?void 0:a.useDict("wf_business_status")),$=m([]),_=m(!0),g=m(!0),L=m([]),A=m(!0),F=m(!0),D=m(0),I=[{value:"1",label:"事假"},{value:"2",label:"调休"},{value:"3",label:"病假"},{value:"4",label:"婚假"}],S=m(),Q=se({form:{},queryParams:{pageNum:1,pageSize:10,startLeaveDays:void 0,endLeaveDays:void 0},rules:{}}),{queryParams:r}=q(Q),f=async()=>{_.value=!0;const n=await Ee(r.value);$.value=n.rows,D.value=n.total,_.value=!1},y=()=>{r.value.pageNum=1,f()},K=()=>{var n;(n=S.value)==null||n.resetFields(),y()},j=n=>{L.value=n.map(e=>e.id),A.value=n.length!=1,F.value=!n.length},x=()=>{a.$tab.closePage(a.$route),a.$router.push({path:"/workflow/leaveEdit/index",query:{type:"add"}})},G=n=>{a.$tab.closePage(a.$route),a.$router.push({path:"/workflow/leaveEdit/index",query:{id:n.id,type:"update"}})},M=n=>{a.$tab.closePage(a.$route),a.$router.push({path:"/workflow/leaveEdit/index",query:{id:n.id,type:"view"}})},W=async n=>{const e=(n==null?void 0:n.id)||L.value;await(a==null?void 0:a.$modal.confirm('是否确认删除请假编号为"'+e+'"的数据项？').finally(()=>_.value=!1)),await he(e),a==null||a.$modal.msgSuccess("删除成功"),await f()},X=()=>{a==null||a.download("workflow/leave/export",{...r.value},`leave_${new Date().getTime()}.xlsx`)},Y=async n=>{await(a==null?void 0:a.$modal.confirm("是否确认撤销当前单据？")),_.value=!0,await $e(n).finally(()=>_.value=!1),await f(),a==null||a.$modal.msgSuccess("撤销成功")};return re(()=>{f()}),(n,e)=>{var T,N;const V=ce,k=Ce,u=_e,Z=De,P=Le,H=be,J=Se,d=ge,O=fe,ee=ke,ae=ye,te=we,le=Ve,b=ie("hasPermi"),oe=ve;return p(),ue("div",Pe,[l(de,{"enter-active-class":(T=s(a))==null?void 0:T.animate.searchAnimate.enter,"leave-active-class":(N=s(a))==null?void 0:N.animate.searchAnimate.leave},{default:o(()=>[c(E("div",Te,[l(Z,{ref_key:"queryFormRef",ref:S,model:s(r),inline:!0},{default:o(()=>[l(k,{label:"请假天数",prop:"startLeaveDays"},{default:o(()=>[l(V,{modelValue:s(r).startLeaveDays,"onUpdate:modelValue":e[0]||(e[0]=t=>s(r).startLeaveDays=t),placeholder:"请输入请假天数",clearable:"",onKeyup:z(y,["enter"])},null,8,["modelValue"])]),_:1}),l(k,{prop:"endLeaveDays"},{default:o(()=>e[5]||(e[5]=[i(" 至 ")])),_:1}),l(k,{prop:"endLeaveDays"},{default:o(()=>[l(V,{modelValue:s(r).endLeaveDays,"onUpdate:modelValue":e[1]||(e[1]=t=>s(r).endLeaveDays=t),placeholder:"请输入请假天数",clearable:"",onKeyup:z(y,["enter"])},null,8,["modelValue"])]),_:1}),l(k,null,{default:o(()=>[l(u,{type:"primary",icon:"Search",onClick:y},{default:o(()=>e[6]||(e[6]=[i("搜索")])),_:1}),l(u,{icon:"Refresh",onClick:K},{default:o(()=>e[7]||(e[7]=[i("重置")])),_:1})]),_:1})]),_:1},8,["model"])],512),[[B,s(g)]])]),_:1},8,["enter-active-class","leave-active-class"]),l(le,{shadow:"never"},{header:o(()=>[l(J,{gutter:10,class:"mb8"},{default:o(()=>[l(P,{span:1.5},{default:o(()=>[c((p(),w(u,{type:"primary",plain:"",icon:"Plus",onClick:x},{default:o(()=>e[8]||(e[8]=[i("新增")])),_:1})),[[b,["workflow:leave:add"]]])]),_:1}),l(P,{span:1.5},{default:o(()=>[c((p(),w(u,{type:"warning",plain:"",icon:"Download",onClick:X},{default:o(()=>e[9]||(e[9]=[i("导出")])),_:1})),[[b,["workflow:leave:export"]]])]),_:1}),l(H,{showSearch:s(g),"onUpdate:showSearch":e[2]||(e[2]=t=>me(g)?g.value=t:null),onQueryTable:f},null,8,["showSearch"])]),_:1})]),default:o(()=>[c((p(),w(ae,{data:s($),onSelectionChange:j},{default:o(()=>[l(d,{type:"selection",width:"55",align:"center"}),C("",!0),l(d,{label:"请假类型",align:"center"},{default:o(t=>[l(O,null,{default:o(()=>{var v;return[i(h((v=I.find(ne=>ne.value===t.row.leaveType))==null?void 0:v.label),1)]}),_:2},1024)]),_:1}),l(d,{label:"开始时间",align:"center",prop:"startDate"},{default:o(t=>[E("span",null,h(n.parseTime(t.row.startDate,"{y}-{m}-{d}")),1)]),_:1}),l(d,{label:"结束时间",align:"center",prop:"endDate"},{default:o(t=>[E("span",null,h(n.parseTime(t.row.endDate,"{y}-{m}-{d}")),1)]),_:1}),l(d,{label:"请假天数",align:"center",prop:"leaveDays"}),l(d,{label:"请假原因",align:"center",prop:"remark"}),l(d,{align:"center",label:"流程状态","min-width":"70"},{default:o(t=>[l(ee,{options:s(U),value:t.row.status},null,8,["options","value"])]),_:1}),l(d,{label:"操作",align:"center","class-name":"small-padding fixed-width"},{default:o(t=>[t.row.status==="draft"||t.row.status==="cancel"||t.row.status==="back"?c((p(),w(u,{key:0,size:"small",link:"",type:"primary",icon:"Edit",onClick:v=>G(t.row)},{default:o(()=>e[10]||(e[10]=[i("修改")])),_:2},1032,["onClick"])),[[b,["workflow:leave:edit"]]]):C("",!0),t.row.status==="draft"||t.row.status==="cancel"||t.row.status==="back"?c((p(),w(u,{key:1,size:"small",link:"",type:"primary",icon:"Delete",onClick:v=>W(t.row)},{default:o(()=>e[11]||(e[11]=[i("删除")])),_:2},1032,["onClick"])),[[b,["workflow:leave:remove"]]]):C("",!0),l(u,{link:"",type:"primary",size:"small",icon:"View",onClick:v=>M(t.row)},{default:o(()=>e[12]||(e[12]=[i("查看")])),_:2},1032,["onClick"]),t.row.status==="waiting"?(p(),w(u,{key:2,link:"",size:"small",type:"primary",icon:"Notification",onClick:v=>Y(t.row.id)},{default:o(()=>e[13]||(e[13]=[i("撤销")])),_:2},1032,["onClick"])):C("",!0)]),_:1})]),_:1},8,["data"])),[[oe,s(_)]]),c(l(te,{page:s(r).pageNum,"onUpdate:page":e[3]||(e[3]=t=>s(r).pageNum=t),limit:s(r).pageSize,"onUpdate:limit":e[4]||(e[4]=t=>s(r).pageSize=t),total:s(D),onPagination:f},null,8,["page","limit","total"]),[[B,s(D)>0]])]),_:1})])}}});export{Oe as default};
