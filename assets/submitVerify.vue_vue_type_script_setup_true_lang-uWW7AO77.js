import{d as be,r as o,a0 as pe,b as ke,o as v,m,k as l,x as z,j as t,y as u,q as y,w as P,e as I,c as x,F as K,p as O,R as ge,n as _e,I as ye,ab as Ie,G as Ce,C as Ve,D as Te,W as we,v as Se,T as De}from"./index-BdO_PCud.js";import{_ as Ue}from"./index-CUkuICKT.js";import{a as W,E as Ne}from"./el-form-item-nBjrsFHP.js";import{E as $e,a as Ee}from"./el-checkbox-DR_n8wcT.js";import{g as Be,c as he,a as Le,b as Re,t as Ae,d as Fe,e as Me}from"./index-CrD_S-ys.js";import{_ as B}from"./index.vue_vue_type_script_setup_true_lang-Dha29s-4.js";import{_ as je}from"./multiInstanceUser.vue_vue_type_script_setup_true_name_User_lang-XoioSYUZ.js";const ze={class:"dialog-footer"},Pe={class:"dialog-footer",style:{float:"right","padding-bottom":"20px"}},Qe=be({__name:"submitVerify",props:{taskVariables:{type:Object,default:()=>{}}},emits:["submitCallback","cancelCallback"],setup(G,{expose:q,emit:H}){const{proxy:e}=De(),h=o(),L=o(),R=o(),S=o(),J=G,c=o(!0),n=o(!0),_=o(""),k=o([]),U=o(void 0),N=o(!1),D=o(!0),V=o(!0),$=o([]),r=o({id:void 0,name:void 0,description:void 0,priority:void 0,owner:void 0,assignee:void 0,assigneeName:void 0,processInstanceId:void 0,executionId:void 0,taskDefinitionId:void 0,processDefinitionId:void 0,endTime:void 0,taskDefinitionKey:void 0,dueDate:void 0,category:void 0,parentTaskId:void 0,tenantId:void 0,claimTime:void 0,businessStatus:void 0,businessStatusName:void 0,processDefinitionName:void 0,processDefinitionKey:void 0,participantVo:void 0,multiInstance:void 0,businessKey:void 0,wfNodeConfigVo:void 0}),E=o(""),b=pe({visible:!1,title:"提示"}),d=o({taskId:void 0,message:void 0,variables:{},messageType:["1"],wfCopyList:[]}),f=o({taskId:void 0,targetActivityId:void 0,message:void 0,variables:{},messageType:["1"]}),Q=()=>{b.visible=!1},X=i=>{U.value=void 0,k.value=[],d.value.fileId=void 0,_.value=i,d.value.message=void 0,b.visible=!0,c.value=!0,n.value=!0,_e(()=>{Be(_.value).then(a=>{r.value=a.data,c.value=!1,n.value=!1})})};ke(()=>{});const T=H,Y=async()=>{if(d.value.taskId=_.value,d.value.taskVariables=J.taskVariables,k.value&&k.value.length>0){let i=[];k.value.forEach(a=>{let g={userId:a.userId,userName:a.nickName};i.push(g)}),d.value.wfCopyList=i}await(e==null?void 0:e.$modal.confirm("是否确认提交？")),c.value=!0,n.value=!0;try{await he(d.value),b.visible=!1,T("submitCallback"),e==null||e.$modal.msgSuccess("操作成功")}finally{c.value=!1,n.value=!1}},Z=async()=>{f.value={},f.value.messageType=["1"],N.value=!0,D.value=!0,V.value=!0;let i=await Le(r.value.processInstanceId);$.value=i.data,D.value=!1,V.value=!1,f.value.targetActivityId=$.value[0].nodeId},ee=async()=>{f.value.taskId=_.value,await(e==null?void 0:e.$modal.confirm("是否确认驳回到申请人？")),c.value=!0,D.value=!0,V.value=!0,await Re(f.value).finally(()=>c.value=!1),b.visible=!1,D.value=!1,V.value=!1,T("submitCallback"),e==null||e.$modal.msgSuccess("操作成功")},A=async()=>{b.visible=!1,n.value=!1,T("cancelCallback")},ae=()=>{h.value.open()},le=i=>{i&&i.length>0&&(k.value=i,U.value=k.value.map(a=>a.userId).join(","))},te=i=>{const a=i.userId,g=k.value.findIndex(w=>w.userId===a);k.value.splice(g,1),U.value=k.value.map(w=>w.userId).join(",")},se=()=>{S.value&&(E.value="加签人员",S.value.getAddMultiInstanceList(_.value,[]))},ie=()=>{S.value&&(E.value="减签人员",S.value.getDeleteMultiInstanceList(_.value))},oe=()=>{L.value.open()},ue=async i=>{if(i&&i.length>0){let a={taskId:_.value,userId:i[0].userId,comment:d.value.message};await(e==null?void 0:e.$modal.confirm("是否确认提交？")),c.value=!0,n.value=!0,await Ae(a).finally(()=>c.value=!1),b.visible=!1,T("submitCallback"),e==null||e.$modal.msgSuccess("操作成功")}else e==null||e.$modal.msgWarning("请选择用户！")},ne=()=>{R.value.open()},de=async i=>{if(i&&i.length>0){let a={taskId:_.value,userId:i[0].userId,nickName:i[0].nickName};await(e==null?void 0:e.$modal.confirm("是否确认提交？")),c.value=!0,n.value=!0,await Fe(a).finally(()=>c.value=!1),b.visible=!1,T("submitCallback"),e==null||e.$modal.msgSuccess("操作成功")}else e==null||e.$modal.msgWarning("请选择用户！")},ve=async i=>{let a={taskId:_.value,comment:d.value.message};await(e==null?void 0:e.$modal.confirm("是否确认终止？")),c.value=!0,n.value=!0,await Me(a).finally(()=>c.value=!1),b.visible=!1,T("submitCallback"),e==null||e.$modal.msgSuccess("操作成功")};return q({openDialog:X}),(i,a)=>{const g=$e,w=Ee,C=Ne,ce=Ue,p=ye,re=Ie,F=Ce,me=Ve,fe=Te,M=we,j=Se;return v(),m(M,{modelValue:I(b).visible,"onUpdate:modelValue":a[8]||(a[8]=s=>I(b).visible=s),title:I(b).title,width:"50%",draggable:"","before-close":A,center:"","close-on-click-modal":!1},{footer:l(()=>[z("span",ze,[t(p,{disabled:n.value,type:"primary",onClick:Y},{default:l(()=>[u(" 提交 ")]),_:1},8,["disabled"]),r.value.businessStatus==="waiting"?(v(),m(p,{key:0,disabled:n.value,type:"primary",onClick:ne},{default:l(()=>[u(" 委托 ")]),_:1},8,["disabled"])):y("",!0),r.value.businessStatus==="waiting"?(v(),m(p,{key:1,disabled:n.value,type:"primary",onClick:oe},{default:l(()=>[u(" 转办 ")]),_:1},8,["disabled"])):y("",!0),r.value.businessStatus==="waiting"&&r.value.multiInstance?(v(),m(p,{key:2,disabled:n.value,type:"primary",onClick:se},{default:l(()=>[u(" 加签 ")]),_:1},8,["disabled"])):y("",!0),r.value.businessStatus==="waiting"&&r.value.multiInstance?(v(),m(p,{key:3,disabled:n.value,type:"primary",onClick:ie},{default:l(()=>[u(" 减签 ")]),_:1},8,["disabled"])):y("",!0),r.value.businessStatus==="waiting"?(v(),m(p,{key:4,disabled:n.value,type:"danger",onClick:ve},{default:l(()=>[u(" 终止 ")]),_:1},8,["disabled"])):y("",!0),r.value.businessStatus==="waiting"?(v(),m(p,{key:5,disabled:n.value,type:"danger",onClick:Z},{default:l(()=>[u(" 退回 ")]),_:1},8,["disabled"])):y("",!0),t(p,{disabled:n.value,onClick:A},{default:l(()=>[u("取消")]),_:1},8,["disabled"])])]),default:l(()=>[P((v(),m(I(W),{model:d.value,"label-width":"120px"},{default:l(()=>[t(C,{label:"消息提醒"},{default:l(()=>[t(w,{modelValue:d.value.messageType,"onUpdate:modelValue":a[0]||(a[0]=s=>d.value.messageType=s)},{default:l(()=>[t(g,{label:"1",name:"type",disabled:""},{default:l(()=>[u("站内信")]),_:1}),t(g,{label:"2",name:"type"},{default:l(()=>[u("邮件")]),_:1}),t(g,{label:"3",name:"type"},{default:l(()=>[u("短信")]),_:1})]),_:1},8,["modelValue"])]),_:1}),r.value.businessStatus==="waiting"?(v(),m(C,{key:0,label:"附件"},{default:l(()=>[t(ce,{modelValue:d.value.fileId,"onUpdate:modelValue":a[1]||(a[1]=s=>d.value.fileId=s),"file-type":["doc","xls","ppt","txt","pdf","xlsx","docx","zip"],"file-size":"20"},null,8,["modelValue"])]),_:1})):y("",!0),t(C,{label:"抄送"},{default:l(()=>[t(p,{type:"primary",icon:"Plus",circle:"",onClick:ae}),(v(!0),x(K,null,O(k.value,s=>(v(),m(re,{key:s.userId,closable:"",style:{margin:"2px"},onClose:xe=>te(s)},{default:l(()=>[u(ge(s.userName),1)]),_:2},1032,["onClose"]))),128))]),_:1}),r.value.businessStatus==="waiting"?(v(),m(C,{key:1,label:"审批意见"},{default:l(()=>[t(F,{modelValue:d.value.message,"onUpdate:modelValue":a[2]||(a[2]=s=>d.value.message=s),type:"textarea",resize:"none"},null,8,["modelValue"])]),_:1})):y("",!0)]),_:1},8,["model"])),[[j,c.value]]),t(I(B),{ref_key:"userSelectCopyRef",ref:h,multiple:!0,data:U.value,onConfirmCallBack:le},null,8,["data"]),t(I(B),{ref_key:"transferTaskRef",ref:L,multiple:!1,onConfirmCallBack:ue},null,512),t(I(B),{ref_key:"delegateTaskRef",ref:R,multiple:!1,onConfirmCallBack:de},null,512),t(je,{ref_key:"multiInstanceUserRef",ref:S,title:E.value,onSubmitCallback:Q},null,8,["title"]),t(M,{modelValue:N.value,"onUpdate:modelValue":a[7]||(a[7]=s=>N.value=s),draggable:"",title:"驳回",width:"40%","close-on-click-modal":!1},{footer:l(()=>[z("div",Pe,[t(p,{disabled:V.value,type:"primary",onClick:ee},{default:l(()=>[u("确认")]),_:1},8,["disabled"]),t(p,{disabled:V.value,onClick:a[6]||(a[6]=s=>N.value=!1)},{default:l(()=>[u("取消")]),_:1},8,["disabled"])])]),default:l(()=>[r.value.businessStatus==="waiting"?P((v(),m(I(W),{key:0,model:f.value,"label-width":"120px"},{default:l(()=>[t(C,{label:"驳回节点"},{default:l(()=>[t(fe,{modelValue:f.value.targetActivityId,"onUpdate:modelValue":a[3]||(a[3]=s=>f.value.targetActivityId=s),clearable:"",placeholder:"请选择",style:{width:"300px"}},{default:l(()=>[(v(!0),x(K,null,O($.value,s=>(v(),m(me,{key:s.nodeId,label:s.nodeName,value:s.nodeId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(C,{label:"消息提醒"},{default:l(()=>[t(w,{modelValue:f.value.messageType,"onUpdate:modelValue":a[4]||(a[4]=s=>f.value.messageType=s)},{default:l(()=>[t(g,{label:"1",name:"type",disabled:""},{default:l(()=>[u("站内信")]),_:1}),t(g,{label:"2",name:"type"},{default:l(()=>[u("邮件")]),_:1}),t(g,{label:"3",name:"type"},{default:l(()=>[u("短信")]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(C,{label:"审批意见"},{default:l(()=>[t(F,{modelValue:f.value.message,"onUpdate:modelValue":a[5]||(a[5]=s=>f.value.message=s),type:"textarea",resize:"none"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])),[[j,D.value]]):y("",!0)]),_:1},8,["modelValue"])]),_:1},8,["modelValue","title"])}}});export{Qe as _};
