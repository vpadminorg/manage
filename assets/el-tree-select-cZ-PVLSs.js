import{aG as B,i as M,n as V,bD as A,$ as q,D as L,bt as x,Q as k,d as P,C as R,T as D,bz as F,cM as U,be as $,bf as G,cw as Q,a_ as J,r as I,a0 as S,b as W,at as T,aT as X}from"./index-CCqTiRkP.js";import{_ as j}from"./index-BMk1bPmy.js";const Y=(e,{attrs:s,emit:i},{select:o,tree:n,key:a})=>{const u=B("tree-select");return M(()=>e.data,()=>{e.filterable&&V(()=>{var t,h;(h=n.value)==null||h.filter((t=o.value)==null?void 0:t.states.inputValue)})},{flush:"post"}),{...A(q(e),Object.keys(L.props)),...s,"onUpdate:modelValue":t=>i(x,t),valueKey:a,popperClass:k(()=>{const t=[u.e("popper")];return e.popperClass&&t.push(e.popperClass),t.join(" ")}),filterMethod:(t="")=>{var h;e.filterMethod?e.filterMethod(t):e.remoteMethod?e.remoteMethod(t):(h=n.value)==null||h.filter(t)}}},Z=P({extends:R,setup(e,s){const i=R.setup(e,s);delete i.selectOptionClick;const o=D().proxy;return V(()=>{i.select.states.cachedOptions.get(o.value)||i.select.onOptionCreate(o)}),M(()=>s.attrs.visible,n=>{i.states.visible=n},{immediate:!0}),i},methods:{selectOptionClick(){this.$el.parentElement.click()}}});function p(e){return e||e===0}function H(e){return Array.isArray(e)&&e.length}function K(e){return Array.isArray(e)?e:p(e)?[e]:[]}function E(e,s,i,o,n){for(let a=0;a<e.length;a++){const u=e[a];if(s(u,a,e,n))return o?o(u,a,e,n):u;{const C=i(u);if(H(C)){const t=E(C,s,i,o,u);if(t)return t}}}}function w(e,s,i,o){for(let n=0;n<e.length;n++){const a=e[n];s(a,n,e,o);const u=i(a);H(u)&&w(u,s,i,a)}}const ee=(e,{attrs:s,slots:i,emit:o},{select:n,tree:a,key:u})=>{M(()=>e.modelValue,()=>{e.showCheckbox&&V(()=>{const l=a.value;l&&!F(l.getCheckedKeys(),K(e.modelValue))&&l.setCheckedKeys(K(e.modelValue))})},{immediate:!0,deep:!0});const C=k(()=>({value:u.value,label:"label",children:"children",disabled:"disabled",isLeaf:"isLeaf",...e.props})),t=(l,c)=>{var d;const r=C.value[l];return $(r)?r(c,(d=a.value)==null?void 0:d.getNode(t("value",c))):c[r]},h=K(e.modelValue).map(l=>E(e.data||[],c=>t("value",c)===l,c=>t("children",c),(c,d,r,v)=>v&&t("value",v))).filter(l=>p(l)),g=k(()=>{if(!e.renderAfterExpand&&!e.lazy)return[];const l=[];return w(e.data.concat(e.cacheData),c=>{const d=t("value",c);l.push({value:d,currentLabel:t("label",c),isDisabled:t("disabled",c)})},c=>t("children",c)),l});return{...A(q(e),Object.keys(j.props)),...s,nodeKey:u,expandOnClickNode:k(()=>!e.checkStrictly&&e.expandOnClickNode),defaultExpandedKeys:k(()=>e.defaultExpandedKeys?e.defaultExpandedKeys.concat(h):h),renderContent:(l,{node:c,data:d,store:r})=>l(Z,{value:t("value",d),label:t("label",d),disabled:t("disabled",d),visible:c.visible},e.renderContent?()=>e.renderContent(l,{node:c,data:d,store:r}):i.default?()=>i.default({node:c,data:d,store:r}):void 0),filterNodeMethod:(l,c,d)=>e.filterNodeMethod?e.filterNodeMethod(l,c,d):l?new RegExp(U(l),"i").test(t("label",c)||""):!0,onNodeClick:(l,c,d)=>{var r,v,m,b;if((r=s.onNodeClick)==null||r.call(s,l,c,d),!(e.showCheckbox&&e.checkOnClickNode)){if(!e.showCheckbox&&(e.checkStrictly||c.isLeaf)){if(!t("disabled",l)){const N=(v=n.value)==null?void 0:v.states.options.get(t("value",l));(m=n.value)==null||m.handleOptionSelect(N)}}else e.expandOnClickNode&&d.proxy.handleExpandIconClick();(b=n.value)==null||b.focus()}},onCheck:(l,c)=>{var d;if(!e.showCheckbox)return;const r=t("value",l),v={};w([a.value.store.root],f=>v[f.key]=f,f=>f.childNodes);const m=c.checkedKeys,b=e.multiple?K(e.modelValue).filter(f=>!(f in v)&&!m.includes(f)):[],N=b.concat(m);if(e.checkStrictly)o(x,e.multiple?N:N.includes(r)?r:void 0);else if(e.multiple)o(x,b.concat(a.value.getCheckedKeys(!0)));else{const f=E([l],y=>!H(t("children",y))&&!t("disabled",y),y=>t("children",y)),_=f?t("value",f):void 0,z=p(e.modelValue)&&!!E([l],y=>t("value",y)===e.modelValue,y=>t("children",y));o(x,_===e.modelValue||z?void 0:_)}V(()=>{var f;const _=K(e.modelValue);a.value.setCheckedKeys(_),(f=s.onCheck)==null||f.call(s,l,{checkedKeys:a.value.getCheckedKeys(),checkedNodes:a.value.getCheckedNodes(),halfCheckedKeys:a.value.getHalfCheckedKeys(),halfCheckedNodes:a.value.getHalfCheckedNodes()})}),(d=n.value)==null||d.focus()},cacheOptions:g}};var te=P({props:{data:{type:Array,default:()=>[]}},setup(e){const s=G(Q);return M(()=>e.data,()=>{var i;e.data.forEach(n=>{s.states.cachedOptions.has(n.value)||s.states.cachedOptions.set(n.value,n)});const o=((i=s.selectRef)==null?void 0:i.querySelectorAll("input"))||[];J&&!Array.from(o).includes(document.activeElement)&&s.setSelected()},{flush:"post",immediate:!0}),()=>{}}});const le=P({name:"ElTreeSelect",inheritAttrs:!1,props:{...L.props,...j.props,cacheData:{type:Array,default:()=>[]}},setup(e,s){const{slots:i,expose:o}=s,n=I(),a=I(),u=k(()=>e.nodeKey||e.valueKey||"value"),C=Y(e,s,{select:n,tree:a,key:u}),{cacheOptions:t,...h}=ee(e,s,{select:n,tree:a,key:u}),g=S({});return o(g),W(()=>{Object.assign(g,{...A(a.value,["filter","updateKeyChildren","getCheckedNodes","setCheckedNodes","getCheckedKeys","setCheckedKeys","setChecked","getHalfCheckedNodes","getHalfCheckedKeys","getCurrentKey","getCurrentNode","setCurrentKey","setCurrentNode","getNode","remove","append","insertBefore","insertAfter"]),...A(n.value,["focus","blur"])})}),()=>T(L,S({...C,ref:l=>n.value=l}),{...i,default:()=>[T(te,{data:t.value}),T(j,S({...h,ref:l=>a.value=l}))]})}});var O=X(le,[["__file","tree-select.vue"]]);O.install=e=>{e.component(O.name,O)};const ne=O,se=ne;export{se as E};
