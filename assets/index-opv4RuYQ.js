import{ac as L,d as te,$ as G,r as f,a0 as Z,b as we,a1 as he,o as c,c as T,j as e,k as l,w as b,x as S,e as t,t as F,F as J,p as X,m as w,Z as x,y as d,Y as ee,a2 as ye,R as u,q as le,T as Te,G as Ve,C as Ce,D as ke,I as Ee,a3 as Ne,W as Se,v as De}from"./index-_v2uieGc.js";import{_ as Ie}from"./index-B7XPQ3lw.js";import{E as Re,a as Ue}from"./el-table-column-Q2QHI77F.js";import"./el-checkbox-C6h3hzMD.js";import{_ as Fe}from"./index-DXIR9_gV.js";/* empty css               */import{_ as Le}from"./index-Bi2yoGwv.js";/* empty css               *//* empty css                */import{E as $e,a as qe}from"./el-form-item-BZcdB44L.js";import{E as Pe}from"./el-date-picker-Csz6W1Cg.js";import{E as Be}from"./index-ctcZQfix.js";import{E as Me}from"./index-7OoO_SlU.js";import{E as Ye}from"./index-DJNwvRpE.js";import"./_initCloneObject-DMl0_0C4.js";/* empty css                */import"./index-BFoUAo4m.js";import"./_baseClone-Cj6s47u0.js";import"./index-D4mmW5IN.js";function Ae(V){return L({url:"/monitor/operlog/list",method:"get",params:V})}function Ke(V){return L({url:"/monitor/operlog/"+V,method:"delete"})}function Oe(){return L({url:"/monitor/operlog/clean",method:"delete"})}const je={class:"p-2"},ze={class:"mb-[10px]"},Qe={key:0},He={key:1},We={class:"dialog-footer"},Ge=te({name:"Operlog"}),gl=te({...Ge,setup(V){const{proxy:n}=Te(),{sys_oper_type:D,sys_common_status:$}=G(n==null?void 0:n.useDict("sys_oper_type","sys_common_status")),q=f([]),I=f(!0),C=f(!0),P=f([]),B=f(!0),R=f(0),h=f(["",""]),y=f({prop:"operTime",order:"descending"}),M=f(),Y=f(),k=Z({visible:!1,title:""}),oe=Z({form:{operId:void 0,tenantId:void 0,title:"",businessType:0,businessTypes:void 0,method:"",requestMethod:"",operatorType:0,operName:"",deptName:"",operUrl:"",operIp:"",operLocation:"",operParam:"",jsonResult:"",status:0,errorMsg:"",operTime:"",costTime:0},queryParams:{pageNum:1,pageSize:10,operIp:"",title:"",operName:"",businessType:"",status:"",orderByColumn:y.value.prop,isAsc:y.value.order},rules:{}}),{queryParams:s,form:r}=G(oe),g=async()=>{I.value=!0;const i=await Ae(n==null?void 0:n.addDateRange(s.value,h.value));q.value=i.rows,R.value=i.total,I.value=!1},ae=i=>n==null?void 0:n.selectDictLabel(D.value,i.businessType),E=()=>{s.value.pageNum=1,g()},ne=()=>{var i,a;h.value=["",""],(i=Y.value)==null||i.resetFields(),s.value.pageNum=1,(a=M.value)==null||a.sort(y.value.prop,y.value.order)},se=i=>{P.value=i.map(a=>a.operId),B.value=!i.length},re=i=>{s.value.orderByColumn=i.prop,s.value.isAsc=i.order,g()},ie=i=>{k.visible=!0,r.value=i},pe=async i=>{const a=P.value;await(n==null?void 0:n.$modal.confirm('是否确认删除日志编号为"'+a+'"的数据项?')),await Ke(a),await g(),n==null||n.$modal.msgSuccess("删除成功")},ue=async()=>{await(n==null?void 0:n.$modal.confirm("是否确认清空所有操作日志数据项?")),await Oe(),await g(),n==null||n.$modal.msgSuccess("清空成功")},de=()=>{n==null||n.download("monitor/operlog/export",{...s.value},`config_${new Date().getTime()}.xlsx`)};return we(()=>{g()}),(i,a)=>{var H,W;const U=Ve,p=$e,A=Ce,K=ke,me=Pe,v=Ee,O=qe,j=Be,m=Me,ce=Le,z=Ye,_=Re,Q=Fe,_e=Ne,fe=Ue,ge=Ie,ve=Se,N=he("hasPermi"),be=De;return c(),T("div",je,[e(ye,{"enter-active-class":(H=t(n))==null?void 0:H.animate.searchAnimate.enter,"leave-active-class":(W=t(n))==null?void 0:W.animate.searchAnimate.leave},{default:l(()=>[b(S("div",ze,[e(j,{shadow:"hover"},{default:l(()=>[e(O,{ref_key:"queryFormRef",ref:Y,model:t(s),inline:!0},{default:l(()=>[e(p,{label:"操作地址",prop:"operIp"},{default:l(()=>[e(U,{modelValue:t(s).operIp,"onUpdate:modelValue":a[0]||(a[0]=o=>t(s).operIp=o),placeholder:"请输入操作地址",clearable:"",onKeyup:F(E,["enter"])},null,8,["modelValue"])]),_:1}),e(p,{label:"系统模块",prop:"title"},{default:l(()=>[e(U,{modelValue:t(s).title,"onUpdate:modelValue":a[1]||(a[1]=o=>t(s).title=o),placeholder:"请输入系统模块",clearable:"",onKeyup:F(E,["enter"])},null,8,["modelValue"])]),_:1}),e(p,{label:"操作人员",prop:"operName"},{default:l(()=>[e(U,{modelValue:t(s).operName,"onUpdate:modelValue":a[2]||(a[2]=o=>t(s).operName=o),placeholder:"请输入操作人员",clearable:"",onKeyup:F(E,["enter"])},null,8,["modelValue"])]),_:1}),e(p,{label:"类型",prop:"businessType"},{default:l(()=>[e(K,{modelValue:t(s).businessType,"onUpdate:modelValue":a[3]||(a[3]=o=>t(s).businessType=o),placeholder:"操作类型",clearable:""},{default:l(()=>[(c(!0),T(J,null,X(t(D),o=>(c(),w(A,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(p,{label:"状态",prop:"status"},{default:l(()=>[e(K,{modelValue:t(s).status,"onUpdate:modelValue":a[4]||(a[4]=o=>t(s).status=o),placeholder:"操作状态",clearable:""},{default:l(()=>[(c(!0),T(J,null,X(t($),o=>(c(),w(A,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(p,{label:"操作时间",style:{width:"308px"}},{default:l(()=>[e(me,{modelValue:t(h),"onUpdate:modelValue":a[5]||(a[5]=o=>x(h)?h.value=o:null),"value-format":"YYYY-MM-DD HH:mm:ss",type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期","default-time":[new Date(2e3,1,1,0,0,0),new Date(2e3,1,1,23,59,59)]},null,8,["modelValue","default-time"])]),_:1}),e(p,null,{default:l(()=>[e(v,{type:"primary",icon:"Search",onClick:E},{default:l(()=>[d("搜索")]),_:1}),e(v,{icon:"Refresh",onClick:ne},{default:l(()=>[d("重置")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})],512),[[ee,t(C)]])]),_:1},8,["enter-active-class","leave-active-class"]),e(j,{shadow:"hover"},{header:l(()=>[e(z,{gutter:10,class:"mb8"},{default:l(()=>[e(m,{span:1.5},{default:l(()=>[b((c(),w(v,{type:"danger",plain:"",icon:"Delete",disabled:t(B),onClick:a[6]||(a[6]=o=>pe())},{default:l(()=>[d(" 删除 ")]),_:1},8,["disabled"])),[[N,["monitor:operlog:remove"]]])]),_:1}),e(m,{span:1.5},{default:l(()=>[b((c(),w(v,{type:"danger",plain:"",icon:"WarnTriangleFilled",onClick:ue},{default:l(()=>[d("清空")]),_:1})),[[N,["monitor:operlog:remove"]]])]),_:1}),e(m,{span:1.5},{default:l(()=>[b((c(),w(v,{type:"warning",plain:"",icon:"Download",onClick:de},{default:l(()=>[d("导出")]),_:1})),[[N,["monitor:operlog:export"]]])]),_:1}),e(ce,{showSearch:t(C),"onUpdate:showSearch":a[7]||(a[7]=o=>x(C)?C.value=o:null),onQueryTable:g},null,8,["showSearch"])]),_:1})]),default:l(()=>[b((c(),w(fe,{ref_key:"operLogTableRef",ref:M,data:t(q),"default-sort":t(y),onSelectionChange:se,onSortChange:re},{default:l(()=>[e(_,{type:"selection",width:"50",align:"center"}),e(_,{label:"日志编号",align:"center",prop:"operId"}),e(_,{label:"系统模块",align:"center",prop:"title","show-overflow-tooltip":!0}),e(_,{label:"操作类型",align:"center",prop:"businessType"},{default:l(o=>[e(Q,{options:t(D),value:o.row.businessType},null,8,["options","value"])]),_:1}),e(_,{label:"操作人员",align:"center",width:"110",prop:"operName","show-overflow-tooltip":!0,sortable:"custom","sort-orders":["descending","ascending"]}),e(_,{label:"部门",align:"center",prop:"deptName",width:"130","show-overflow-tooltip":!0}),e(_,{label:"操作地址",align:"center",prop:"operIp",width:"130","show-overflow-tooltip":!0}),e(_,{label:"操作状态",align:"center",prop:"status"},{default:l(o=>[e(Q,{options:t($),value:o.row.status},null,8,["options","value"])]),_:1}),e(_,{label:"操作日期",align:"center",prop:"operTime",width:"180",sortable:"custom","sort-orders":["descending","ascending"]},{default:l(o=>[S("span",null,u(i.parseTime(o.row.operTime)),1)]),_:1}),e(_,{label:"消耗时间",align:"center",prop:"costTime",width:"110","show-overflow-tooltip":!0,sortable:"custom","sort-orders":["descending","ascending"]},{default:l(o=>[S("span",null,u(o.row.costTime)+"毫秒",1)]),_:1}),e(_,{label:"操作",fixed:"right",align:"center","class-name":"small-padding fixed-width"},{default:l(o=>[e(_e,{content:"详细",placement:"top"},{default:l(()=>[b(e(v,{link:"",type:"primary",icon:"View",onClick:Ze=>ie(o.row)},null,8,["onClick"]),[[N,["monitor:operlog:query"]]])]),_:2},1024)]),_:1})]),_:1},8,["data","default-sort"])),[[be,t(I)]]),b(e(ge,{page:t(s).pageNum,"onUpdate:page":a[8]||(a[8]=o=>t(s).pageNum=o),limit:t(s).pageSize,"onUpdate:limit":a[9]||(a[9]=o=>t(s).pageSize=o),total:t(R),onPagination:g},null,8,["page","limit","total"]),[[ee,t(R)>0]])]),_:1}),e(ve,{modelValue:t(k).visible,"onUpdate:modelValue":a[11]||(a[11]=o=>t(k).visible=o),title:"操作日志详细",width:"700px","append-to-body":""},{footer:l(()=>[S("div",We,[e(v,{onClick:a[10]||(a[10]=o=>t(k).visible=!1)},{default:l(()=>[d("关 闭")]),_:1})])]),default:l(()=>[e(O,{model:t(r),"label-width":"100px"},{default:l(()=>[e(z,null,{default:l(()=>[e(m,{span:24},{default:l(()=>[e(p,{label:"登录信息："},{default:l(()=>[d(u(t(r).operName)+" / "+u(t(r).deptName)+" / "+u(t(r).operIp)+" / "+u(t(r).operLocation),1)]),_:1})]),_:1}),e(m,{span:12},{default:l(()=>[e(p,{label:"请求信息："},{default:l(()=>[d(u(t(r).requestMethod)+" "+u(t(r).operUrl),1)]),_:1})]),_:1}),e(m,{span:12},{default:l(()=>[e(p,{label:"操作模块："},{default:l(()=>[d(u(t(r).title)+" / "+u(ae(t(r))),1)]),_:1})]),_:1}),e(m,{span:24},{default:l(()=>[e(p,{label:"操作方法："},{default:l(()=>[d(u(t(r).method),1)]),_:1})]),_:1}),e(m,{span:24},{default:l(()=>[e(p,{label:"请求参数："},{default:l(()=>[d(u(t(r).operParam),1)]),_:1})]),_:1}),e(m,{span:24},{default:l(()=>[e(p,{label:"返回参数："},{default:l(()=>[d(u(t(r).jsonResult),1)]),_:1})]),_:1}),e(m,{span:6},{default:l(()=>[e(p,{label:"操作状态："},{default:l(()=>[t(r).status===0?(c(),T("div",Qe,"正常")):t(r).status===1?(c(),T("div",He,"失败")):le("",!0)]),_:1})]),_:1}),e(m,{span:8},{default:l(()=>[e(p,{label:"消耗时间："},{default:l(()=>[d(u(t(r).costTime)+"毫秒",1)]),_:1})]),_:1}),e(m,{span:10},{default:l(()=>[e(p,{label:"操作时间："},{default:l(()=>[d(u(i.parseTime(t(r).operTime)),1)]),_:1})]),_:1}),e(m,{span:24},{default:l(()=>[t(r).status===1?(c(),w(p,{key:0,label:"异常信息："},{default:l(()=>[d(u(t(r).errorMsg),1)]),_:1})):le("",!0)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}});export{gl as default};
