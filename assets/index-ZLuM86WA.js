import{d as J,r as u,a0 as W,$ as Ce,b as we,a1 as Ve,o as h,c as Ee,j as t,k as n,w as f,x as Y,e as o,t as Pe,y as m,Y as Z,a2 as Te,m as V,Z as q,q as Ne,T as Se,M as Ie,n as Ue,G as xe,I as $e,ad as Fe,a3 as Re,W as De,v as qe}from"./index-SwfHvmsR.js";/* empty css                */import{E as Be}from"./el-checkbox-gjRiKN0S.js";import{_ as Ke}from"./index-CwtlzU0C.js";import{E as Me,a as Ae}from"./el-table-column-DvXjLevZ.js";/* empty css               */import{_ as Le}from"./index-D6KF0Zrv.js";/* empty css               *//* empty css                */import{E as ze,a as Qe}from"./el-form-item-BTGfmHo9.js";import{l as je,c as Ge,g as He,u as Oe,a as We,d as Ye}from"./index-9KK4ZSRG.js";import{t as Ze,b as Je}from"./index-_C1nwlOk.js";import{E as Xe}from"./index-BMMvtxBL.js";import{E as ea}from"./index-Cu3lnjet.js";import{E as aa}from"./index-gXvdNh_C.js";import{E as ta}from"./index-Bqsyo0rw.js";import"./_initCloneObject-DuYGRlJO.js";import"./_baseClone-D_rg-wPN.js";const la={class:"p-2"},na={class:"mb-[10px]"},oa={class:"dialog-footer"},sa=J({name:"TenantPackage"}),Pa=J({...sa,setup(ia){const{proxy:s}=Se(),B=u([]),E=u(!1),y=u(!0),P=u(!0),U=u([]),K=u(!0),M=u(!0),x=u(0),T=u(!1),N=u(!1),b=u([]),k=u(),A=u(),$=u(),g=W({visible:!1,title:""}),L={packageId:void 0,packageName:"",menuIds:"",remark:"",menuCheckStrictly:!0},X=W({form:{...L},queryParams:{pageNum:1,pageSize:10,packageName:""},rules:{packageId:[{required:!0,message:"租户套餐id不能为空",trigger:"blur"}],packageName:[{required:!0,message:"套餐名称不能为空",trigger:"blur"}]}}),{queryParams:p,form:c,rules:ee}=Ce(X),ae=async()=>{const{data:a}=await Ze();b.value=a},te=()=>{var i,d;let a=(i=k.value)==null?void 0:i.getCheckedKeys(),e=(d=k.value)==null?void 0:d.getHalfCheckedKeys();return e&&(a==null||a.unshift.apply(a,e)),a},le=async a=>{const e=await Je(a);return b.value=e.data.menus,Promise.resolve(e)},_=async()=>{y.value=!0;const a=await je(p.value);B.value=a.rows,x.value=a.total,y.value=!1},ne=async a=>{let e=a.status==="0"?"启用":"停用";const[i]=await Ie(s==null?void 0:s.$modal.confirm('确认要"'+e+'""'+a.packageName+'"套餐吗？'));i?a.status=a.status==="0"?"1":"0":(await Ge(a.packageId,a.status),s==null||s.$modal.msgSuccess(e+"成功"))},oe=()=>{F(),g.visible=!1},F=()=>{var a,e;(a=k.value)==null||a.setCheckedKeys([]),T.value=!1,N.value=!1,c.value={...L},(e=$.value)==null||e.resetFields()},R=()=>{p.value.pageNum=1,_()},se=()=>{var a;(a=A.value)==null||a.resetFields(),R()},ie=a=>{U.value=a.map(e=>e.packageId),K.value=a.length!=1,M.value=!a.length},ce=(a,e)=>{{let i=b.value;for(let d=0;d<i.length;d++)k.value&&(k.value.store.nodesMap[i[d].id].expanded=a)}},de=(a,e)=>{var i;(i=k.value)==null||i.setCheckedNodes(a?b.value:[])},ue=(a,e)=>{c.value.menuCheckStrictly=a},re=()=>{F(),ae(),g.visible=!0,g.title="添加租户套餐"},z=async a=>{F();const e=(a==null?void 0:a.packageId)||U.value[0],i=await He(e);c.value=i.data;const d=await le(e);g.visible=!0,g.title="修改租户套餐",d.data.checkedKeys.forEach(r=>{Ue(()=>{var C;(C=k.value)==null||C.setChecked(r,!0,!1)})})},me=()=>{var a;(a=$.value)==null||a.validate(async e=>{e&&(E.value=!0,c.value.menuIds=te(),c.value.packageId!=null?await Oe(c.value).finally(()=>E.value=!1):await We(c.value).finally(()=>E.value=!1),s==null||s.$modal.msgSuccess("操作成功"),g.visible=!1,await _())})},Q=async a=>{const e=(a==null?void 0:a.packageId)||U.value;await(s==null?void 0:s.$modal.confirm('是否确认删除租户套餐编号为"'+e+'"的数据项？').finally(()=>{y.value=!1})),await Ye(e),y.value=!0,await _(),s==null||s.$modal.msgSuccess("删除成功")},pe=()=>{s==null||s.download("system/tenant/package/export",{...p.value},`tenantPackage_${new Date().getTime()}.xlsx`)};return we(()=>{_()}),(a,e)=>{var H,O;const i=xe,d=ze,r=$e,C=Qe,j=Xe,S=ea,ge=Le,fe=aa,w=Me,ke=Fe,G=Re,_e=Ae,ve=Ke,D=Be,he=ta,ye=De,v=Ve("hasPermi"),be=qe;return h(),Ee("div",la,[t(Te,{"enter-active-class":(H=o(s))==null?void 0:H.animate.searchAnimate.enter,"leave-active-class":(O=o(s))==null?void 0:O.animate.searchAnimate.leave},{default:n(()=>[f(Y("div",na,[t(j,{shadow:"hover"},{default:n(()=>[t(C,{ref_key:"queryFormRef",ref:A,model:o(p),inline:!0},{default:n(()=>[t(d,{label:"套餐名称",prop:"packageName"},{default:n(()=>[t(i,{modelValue:o(p).packageName,"onUpdate:modelValue":e[0]||(e[0]=l=>o(p).packageName=l),placeholder:"请输入套餐名称",clearable:"",onKeyup:Pe(R,["enter"])},null,8,["modelValue"])]),_:1}),t(d,null,{default:n(()=>[t(r,{type:"primary",icon:"Search",onClick:R},{default:n(()=>[m("搜索")]),_:1}),t(r,{icon:"Refresh",onClick:se},{default:n(()=>[m("重置")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})],512),[[Z,o(P)]])]),_:1},8,["enter-active-class","leave-active-class"]),t(j,{shadow:"hover"},{header:n(()=>[t(fe,{gutter:10,class:"mb8"},{default:n(()=>[t(S,{span:1.5},{default:n(()=>[f((h(),V(r,{type:"primary",plain:"",icon:"Plus",onClick:re},{default:n(()=>[m(" 新增 ")]),_:1})),[[v,["system:tenantPackage:add"]]])]),_:1}),t(S,{span:1.5},{default:n(()=>[f((h(),V(r,{type:"success",plain:"",icon:"Edit",disabled:o(K),onClick:e[1]||(e[1]=l=>z())},{default:n(()=>[m(" 修改 ")]),_:1},8,["disabled"])),[[v,["system:tenantPackage:edit"]]])]),_:1}),t(S,{span:1.5},{default:n(()=>[f((h(),V(r,{type:"danger",plain:"",icon:"Delete",disabled:o(M),onClick:e[2]||(e[2]=l=>Q())},{default:n(()=>[m(" 删除 ")]),_:1},8,["disabled"])),[[v,["system:tenantPackage:remove"]]])]),_:1}),t(S,{span:1.5},{default:n(()=>[f((h(),V(r,{type:"warning",plain:"",icon:"Download",onClick:pe},{default:n(()=>[m("导出 ")]),_:1})),[[v,["system:tenantPackage:export"]]])]),_:1}),t(ge,{showSearch:o(P),"onUpdate:showSearch":e[3]||(e[3]=l=>q(P)?P.value=l:null),onQueryTable:_},null,8,["showSearch"])]),_:1})]),default:n(()=>[f((h(),V(_e,{data:o(B),onSelectionChange:ie},{default:n(()=>[t(w,{type:"selection",width:"55",align:"center"}),Ne("",!0),t(w,{label:"套餐名称",align:"center",prop:"packageName"}),t(w,{label:"备注",align:"center",prop:"remark"}),t(w,{label:"状态",align:"center",prop:"status"},{default:n(l=>[t(ke,{modelValue:l.row.status,"onUpdate:modelValue":I=>l.row.status=I,"active-value":"0","inactive-value":"1",onClick:I=>ne(l.row)},null,8,["modelValue","onUpdate:modelValue","onClick"])]),_:1}),t(w,{label:"操作",align:"center","class-name":"small-padding fixed-width"},{default:n(l=>[t(G,{content:"修改",placement:"top"},{default:n(()=>[f(t(r,{link:"",type:"primary",icon:"Edit",onClick:I=>z(l.row)},null,8,["onClick"]),[[v,["system:tenantPackage:edit"]]])]),_:2},1024),t(G,{content:"删除",placement:"top"},{default:n(()=>[f(t(r,{link:"",type:"primary",icon:"Delete",onClick:I=>Q(l.row)},null,8,["onClick"]),[[v,["system:tenantPackage:remove"]]])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[be,o(y)]]),f(t(ve,{page:o(p).pageNum,"onUpdate:page":e[4]||(e[4]=l=>o(p).pageNum=l),limit:o(p).pageSize,"onUpdate:limit":e[5]||(e[5]=l=>o(p).pageSize=l),total:o(x),onPagination:_},null,8,["page","limit","total"]),[[Z,o(x)>0]])]),_:1}),t(ye,{modelValue:o(g).visible,"onUpdate:modelValue":e[14]||(e[14]=l=>o(g).visible=l),title:o(g).title,width:"500px","append-to-body":""},{footer:n(()=>[Y("div",oa,[t(r,{loading:o(E),type:"primary",onClick:me},{default:n(()=>[m("确 定")]),_:1},8,["loading"]),t(r,{onClick:oe},{default:n(()=>[m("取 消")]),_:1})])]),default:n(()=>[t(C,{ref_key:"tenantPackageFormRef",ref:$,model:o(c),rules:o(ee),"label-width":"80px"},{default:n(()=>[t(d,{label:"套餐名称",prop:"packageName"},{default:n(()=>[t(i,{modelValue:o(c).packageName,"onUpdate:modelValue":e[6]||(e[6]=l=>o(c).packageName=l),placeholder:"请输入套餐名称"},null,8,["modelValue"])]),_:1}),t(d,{label:"关联菜单"},{default:n(()=>[t(D,{modelValue:o(T),"onUpdate:modelValue":e[7]||(e[7]=l=>q(T)?T.value=l:null),onChange:e[8]||(e[8]=l=>ce(l,"menu"))},{default:n(()=>[m("展开/折叠")]),_:1},8,["modelValue"]),t(D,{modelValue:o(N),"onUpdate:modelValue":e[9]||(e[9]=l=>q(N)?N.value=l:null),onChange:e[10]||(e[10]=l=>de(l,"menu"))},{default:n(()=>[m("全选/全不选 ")]),_:1},8,["modelValue"]),t(D,{modelValue:o(c).menuCheckStrictly,"onUpdate:modelValue":e[11]||(e[11]=l=>o(c).menuCheckStrictly=l),onChange:e[12]||(e[12]=l=>ue(l,"menu"))},{default:n(()=>[m("父子联动 ")]),_:1},8,["modelValue"]),t(he,{ref_key:"menuTreeRef",ref:k,class:"tree-border",data:o(b),"show-checkbox":"","node-key":"id","check-strictly":!o(c).menuCheckStrictly,"empty-text":"加载中，请稍候",props:{label:"label",children:"children"}},null,8,["data","check-strictly"])]),_:1}),t(d,{label:"备注",prop:"remark"},{default:n(()=>[t(i,{modelValue:o(c).remark,"onUpdate:modelValue":e[13]||(e[13]=l=>o(c).remark=l),placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}});export{Pa as default};
