import{ac as T,d as se,$ as le,r as c,a0 as te,b as je,a1 as Fe,o as u,c as y,j as a,k as o,w as b,x as oe,e as l,t as ne,F as V,p as h,m as p,y as C,Y as re,a2 as Ue,Z as Pe,q as ie,R as De,T as qe,P as Re,G as $e,C as Ie,D as Be,I as Le,ad as xe,a3 as Ae,W as ze,v as Ge}from"./index-SwfHvmsR.js";/* empty css                       *//* empty css                 */import{_ as Ke}from"./index-CwtlzU0C.js";import{E as Me,a as Qe}from"./el-table-column-DvXjLevZ.js";import"./el-checkbox-gjRiKN0S.js";import{_ as Ye}from"./index-YuVMnXy9.js";/* empty css               */import{_ as Oe}from"./index-D6KF0Zrv.js";/* empty css               *//* empty css                */import{E as Ze,a as We}from"./el-form-item-BTGfmHo9.js";import{g as He}from"./edit-DZIUfVI6.js";import{E as Je}from"./index-BMMvtxBL.js";import{E as Xe}from"./index-Cu3lnjet.js";import{E as ea}from"./index-gXvdNh_C.js";import{E as aa,a as la}from"./index-gGP__DGH.js";import"./_initCloneObject-DuYGRlJO.js";/* empty css                */import"./index-Bqsyo0rw.js";import"./_baseClone-D_rg-wPN.js";const ta=f=>T({url:"/vpadmin/paymentConfig/list",method:"get",params:f}),oa=f=>T({url:"/vpadmin/paymentConfig/"+f,method:"get"}),na=f=>T({url:"/vpadmin/paymentConfig",method:"post",data:f}),ue=f=>T({url:"/vpadmin/paymentConfig",method:"put",data:f}),ra=f=>T({url:"/vpadmin/paymentConfig/"+f,method:"delete"}),ia={class:"p-2"},ua={class:"mb-[10px]"},sa={class:"dialog-footer"},ma=se({name:"PaymentConfig"}),Pa=se({...ma,setup(f){const{proxy:i}=qe(),{sys_normal_disable:A,vpa_payment_platform_type:q,vpa_payment_type:R}=le(i==null?void 0:i.useDict("sys_normal_disable","vpa_payment_platform_type","vpa_payment_type")),z=c([]),j=c(!1),F=c(!0),U=c(!0),$=c([]),G=c(!0),K=c(!0),I=c(0),M=c(),B=c(),L=c([]),_=te({visible:!1,title:"",isEdit:!1}),Q={id:void 0,projectId:void 0,projectName:void 0,platform:void 0,paymentType:void 0,tierName:void 0,autoSend:"1",emailFrom:void 0,emailContent:void 0},me=te({form:{...Q},queryParams:{pageNum:1,pageSize:10,projectName:void 0,platform:void 0,paymentType:void 0,tierName:void 0,autoSend:void 0,params:{}},rules:{id:[{required:!0,message:"主键不能为空",trigger:"blur"}],projectId:[{required:!0,message:"关联的项目ID不能为空",trigger:"blur"}],projectName:[{required:!0,message:"项目名称不能为空",trigger:"blur"}],platform:[{required:!0,message:"支付平台不能为空",trigger:"change"}],paymentType:[{required:!0,message:"支付类型不能为空",trigger:"change"}],autoSend:[{required:!0,message:"自动发送邮件不能为空",trigger:"blur"}],tierName:[{required:!0,message:"用户等级不能为空",trigger:"blur"}]}}),{queryParams:s,form:r,rules:de}=le(me),w=async()=>{F.value=!0;const n=await ta(s.value);z.value=n.rows,I.value=n.total,F.value=!1},Y=async()=>{try{const n=await He();L.value=n.data}catch(n){console.error("Failed to fetch project list:",n)}},pe=()=>{x(),_.visible=!1},x=()=>{var n;r.value={...Q},r.value.tierName=void 0,(n=B.value)==null||n.resetFields()},P=()=>{s.value.pageNum=1,w()},ce=()=>{var n;(n=M.value)==null||n.resetFields(),P()},fe=n=>{$.value=n.map(t=>t.id),G.value=n.length!=1,K.value=!n.length},ve=n=>{const t=L.value.find(m=>m.id===n);t&&(r.value.projectName=t.projectName)},_e=async(n,t)=>{try{const m=t==="0"?"确认要启用该配置吗？":"确认要禁用该配置吗？";await Re.confirm(m,"确认信息",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await ue({...n,autoSend:t}),i==null||i.$modal.msgSuccess("更新成功")}catch(m){console.error("Failed to update autoSend status:",m),i==null||i.$modal.msgError("更新失败"),n.autoSend=t==="0"?"1":"0"}},ge=()=>{x(),Y(),_.visible=!0,_.title="添加支付配置信息"},O=async n=>{x(),await Y();const t=(n==null?void 0:n.id)||$.value[0],m=await oa(t);Object.assign(r.value,m.data),_.visible=!0,_.title="修改支付配置信息"},ye=()=>{var n;(n=B.value)==null||n.validate(async t=>{t&&(j.value=!0,r.value.id?await ue(r.value).finally(()=>j.value=!1):await na(r.value).finally(()=>j.value=!1),i==null||i.$modal.msgSuccess("操作成功"),_.visible=!1,await w())})},Z=async n=>{const t=(n==null?void 0:n.id)||$.value;await(i==null?void 0:i.$modal.confirm('是否确认删除支付配置信息编号为"'+t+'"的数据项？').finally(()=>F.value=!1)),await ra(t),i==null||i.$modal.msgSuccess("删除成功"),await w()},be=()=>{i==null||i.download("vpadmin/paymentConfig/export",{...s.value},`paymentConfig_${new Date().getTime()}.xlsx`)};return je(()=>{w()}),(n,t)=>{var ee,ae;const m=$e,d=Ze,k=Ie,S=Be,v=Le,W=We,H=Je,D=Xe,Ce=Oe,Ve=ea,g=Me,J=Ye,he=xe,X=Ae,we=Qe,ke=Ke,Se=aa,Ee=la,Ne=ze,E=Fe("hasPermi"),Te=Ge;return u(),y("div",ia,[a(Ue,{"enter-active-class":(ee=l(i))==null?void 0:ee.animate.searchAnimate.enter,"leave-active-class":(ae=l(i))==null?void 0:ae.animate.searchAnimate.leave},{default:o(()=>[b(oe("div",ua,[a(H,{shadow:"hover"},{default:o(()=>[a(W,{ref_key:"queryFormRef",ref:M,model:l(s),inline:!0},{default:o(()=>[a(d,{label:"项目名称",prop:"projectName"},{default:o(()=>[a(m,{modelValue:l(s).projectName,"onUpdate:modelValue":t[0]||(t[0]=e=>l(s).projectName=e),placeholder:"请输入项目名称",clearable:"",onKeyup:ne(P,["enter"])},null,8,["modelValue"])]),_:1}),a(d,{label:"支付平台",prop:"platform"},{default:o(()=>[a(S,{modelValue:l(s).platform,"onUpdate:modelValue":t[1]||(t[1]=e=>l(s).platform=e),placeholder:"请选择支付平台",clearable:""},{default:o(()=>[(u(!0),y(V,null,h(l(q),e=>(u(),p(k,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(d,{label:"支付类型",prop:"paymentType"},{default:o(()=>[a(S,{modelValue:l(s).paymentType,"onUpdate:modelValue":t[2]||(t[2]=e=>l(s).paymentType=e),placeholder:"请选择支付类型",clearable:""},{default:o(()=>[(u(!0),y(V,null,h(l(R),e=>(u(),p(k,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(d,{label:"用户等级",prop:"tierName"},{default:o(()=>[a(m,{modelValue:l(s).tierName,"onUpdate:modelValue":t[3]||(t[3]=e=>l(s).tierName=e),placeholder:"请输入用户等级",clearable:"",onKeyup:ne(P,["enter"])},null,8,["modelValue"])]),_:1}),a(d,{label:"自动发送邮件",prop:"status"},{default:o(()=>[a(S,{modelValue:l(s).autoSend,"onUpdate:modelValue":t[4]||(t[4]=e=>l(s).autoSend=e),placeholder:"请选择",clearable:""},{default:o(()=>[(u(!0),y(V,null,h(l(A),e=>(u(),p(k,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(d,null,{default:o(()=>[a(v,{type:"primary",icon:"Search",onClick:P},{default:o(()=>[C("搜索")]),_:1}),a(v,{icon:"Refresh",onClick:ce},{default:o(()=>[C("重置")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})],512),[[re,l(U)]])]),_:1},8,["enter-active-class","leave-active-class"]),a(H,{shadow:"never"},{header:o(()=>[a(Ve,{gutter:10,class:"mb8"},{default:o(()=>[a(D,{span:1.5},{default:o(()=>[b((u(),p(v,{type:"primary",plain:"",icon:"Plus",onClick:ge},{default:o(()=>[C("新增")]),_:1})),[[E,["vpadmin:paymentConfig:add"]]])]),_:1}),a(D,{span:1.5},{default:o(()=>[b((u(),p(v,{type:"success",plain:"",icon:"Edit",disabled:l(G),onClick:t[5]||(t[5]=e=>O())},{default:o(()=>[C("修改")]),_:1},8,["disabled"])),[[E,["vpadmin:paymentConfig:edit"]]])]),_:1}),a(D,{span:1.5},{default:o(()=>[b((u(),p(v,{type:"danger",plain:"",icon:"Delete",disabled:l(K),onClick:t[6]||(t[6]=e=>Z())},{default:o(()=>[C("删除")]),_:1},8,["disabled"])),[[E,["vpadmin:paymentConfig:remove"]]])]),_:1}),a(D,{span:1.5},{default:o(()=>[b((u(),p(v,{type:"warning",plain:"",icon:"Download",onClick:be},{default:o(()=>[C("导出")]),_:1})),[[E,["vpadmin:paymentConfig:export"]]])]),_:1}),a(Ce,{showSearch:l(U),"onUpdate:showSearch":t[7]||(t[7]=e=>Pe(U)?U.value=e:null),onQueryTable:w},null,8,["showSearch"])]),_:1})]),default:o(()=>[b((u(),p(we,{data:l(z),onSelectionChange:fe},{default:o(()=>[a(g,{type:"selection",width:"55",align:"center"}),a(g,{label:"项目名称",align:"center",prop:"projectName"}),a(g,{label:"支付平台",align:"center",prop:"platform"},{default:o(e=>[a(J,{options:l(q),value:e.row.platform},null,8,["options","value"])]),_:1}),a(g,{label:"支付类型",align:"center",prop:"paymentType"},{default:o(e=>[a(J,{options:l(R),value:e.row.paymentType},null,8,["options","value"])]),_:1}),a(g,{label:"用户等级",align:"center",prop:"tierName"}),a(g,{key:"status",label:"自动发送邮件",align:"center"},{default:o(e=>[a(he,{modelValue:e.row.autoSend,"onUpdate:modelValue":N=>e.row.autoSend=N,"active-value":"0","inactive-value":"1",onChange:N=>_e(e.row,N)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),a(g,{label:"发件人地址",align:"center",prop:"emailFrom"}),a(g,{label:"邮件正文",align:"center",prop:"emailContent"}),a(g,{label:"操作",align:"center","class-name":"small-padding fixed-width"},{default:o(e=>[a(X,{content:"修改",placement:"top"},{default:o(()=>[b(a(v,{link:"",type:"primary",icon:"Edit",onClick:N=>O(e.row)},null,8,["onClick"]),[[E,["vpadmin:paymentConfig:edit"]]])]),_:2},1024),a(X,{content:"删除",placement:"top"},{default:o(()=>[b(a(v,{link:"",type:"primary",icon:"Delete",onClick:N=>Z(e.row)},null,8,["onClick"]),[[E,["vpadmin:paymentConfig:remove"]]])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[Te,l(F)]]),b(a(ke,{page:l(s).pageNum,"onUpdate:page":t[8]||(t[8]=e=>l(s).pageNum=e),limit:l(s).pageSize,"onUpdate:limit":t[9]||(t[9]=e=>l(s).pageSize=e),total:l(I),onPagination:w},null,8,["page","limit","total"]),[[re,l(I)>0]])]),_:1}),a(Ne,{modelValue:l(_).visible,"onUpdate:modelValue":t[17]||(t[17]=e=>l(_).visible=e),title:l(_).title,width:"500px","append-to-body":""},{footer:o(()=>[oe("div",sa,[a(v,{loading:l(j),type:"primary",onClick:ye},{default:o(()=>[C("确 定")]),_:1},8,["loading"]),a(v,{onClick:pe},{default:o(()=>[C("取 消")]),_:1})])]),default:o(()=>[a(W,{ref_key:"paymentConfigFormRef",ref:B,model:l(r),rules:l(de),"label-width":"80px"},{default:o(()=>[a(d,{label:"项目",prop:"projectId"},{default:o(()=>[a(S,{modelValue:l(r).projectId,"onUpdate:modelValue":t[10]||(t[10]=e=>l(r).projectId=e),placeholder:"请选择项目",onChange:ve},{default:o(()=>[(u(!0),y(V,null,h(l(L),e=>(u(),p(k,{key:e.id,label:e.projectName,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(d,{label:"支付平台",prop:"platform"},{default:o(()=>[a(S,{modelValue:l(r).platform,"onUpdate:modelValue":t[11]||(t[11]=e=>l(r).platform=e),placeholder:"请选择支付平台"},{default:o(()=>[(u(!0),y(V,null,h(l(q),e=>(u(),p(k,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(d,{label:"支付类型",prop:"paymentType"},{default:o(()=>[a(S,{modelValue:l(r).paymentType,"onUpdate:modelValue":t[12]||(t[12]=e=>l(r).paymentType=e),placeholder:"请选择支付类型"},{default:o(()=>[(u(!0),y(V,null,h(l(R),e=>(u(),p(k,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(r).paymentType==="2"?(u(),p(d,{key:0,label:"用户等级",prop:"tierName"},{default:o(()=>[a(m,{modelValue:l(r).tierName,"onUpdate:modelValue":t[13]||(t[13]=e=>l(r).tierName=e),placeholder:"请输入用户等级"},null,8,["modelValue"])]),_:1})):ie("",!0),a(d,{label:"自动发送邮件",prop:"status"},{default:o(()=>[a(Ee,{modelValue:l(r).autoSend,"onUpdate:modelValue":t[14]||(t[14]=e=>l(r).autoSend=e)},{default:o(()=>[(u(!0),y(V,null,h(l(A),e=>(u(),p(Se,{key:e.value,value:e.value},{default:o(()=>[C(De(e.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(r).autoSend==="0"?(u(),y(V,{key:1},[a(d,{label:"发件人地址",prop:"emailFrom"},{default:o(()=>[a(m,{modelValue:l(r).emailFrom,"onUpdate:modelValue":t[15]||(t[15]=e=>l(r).emailFrom=e),placeholder:"请输入发件人地址"},null,8,["modelValue"])]),_:1}),a(d,{label:"邮件正文",prop:"emailContent"},{default:o(()=>[a(m,{modelValue:l(r).emailContent,"onUpdate:modelValue":t[16]||(t[16]=e=>l(r).emailContent=e),type:"textarea",rows:5,placeholder:"vpadmin不负责保存您任何受保护的内容，请不要将任何受保护的digital content, license keys等直接放到邮件内容里.  You can provide a publicly available link to the content you are selling. e.g. a Google Drive url, a YouTube video or a Zoom invite."},null,8,["modelValue"])]),_:1})],64)):ie("",!0)]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}});export{Pa as default};
