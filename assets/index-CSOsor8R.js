import{d as R,$ as q,r as d,a0 as se,b as re,a1 as ie,o as m,c as ue,j as t,k as l,w as p,x as D,e as n,t as z,y as i,Y as B,a2 as ce,m as w,Z as de,q as b,R as E,T as me,G as pe,I as _e,ab as fe,v as ve}from"./index-_v2uieGc.js";/* empty css                */import{_ as we}from"./index-B7XPQ3lw.js";import{E as ge,a as ye}from"./el-table-column-Q2QHI77F.js";import"./el-checkbox-C6h3hzMD.js";import{_ as he}from"./index-DXIR9_gV.js";/* empty css               */import{_ as ke}from"./index-Bi2yoGwv.js";/* empty css               */import{E as be,a as Ce}from"./el-form-item-BZcdB44L.js";import{l as De,d as Ee}from"./index-B5mtHC3j.js";import{c as $e}from"./index-C9jLFToD.js";import{E as Le}from"./index-7OoO_SlU.js";import{E as Se}from"./index-DJNwvRpE.js";import{E as Ve}from"./index-ctcZQfix.js";import"./_initCloneObject-DMl0_0C4.js";/* empty css                */import"./index-BFoUAo4m.js";import"./_baseClone-Cj6s47u0.js";const Pe={class:"p-2"},Te={class:"search"},Ne=R({name:"Leave"}),Xe=R({...Ne,setup(qe){const{proxy:e}=me(),{wf_business_status:U}=q(e==null?void 0:e.useDict("wf_business_status")),$=d([]),_=d(!0),g=d(!0),L=d([]),A=d(!0),F=d(!0),C=d(0),I=[{value:"1",label:"事假"},{value:"2",label:"调休"},{value:"3",label:"病假"},{value:"4",label:"婚假"}],S=d(),K=se({form:{},queryParams:{pageNum:1,pageSize:10,startLeaveDays:void 0,endLeaveDays:void 0},rules:{}}),{queryParams:r}=q(K),f=async()=>{_.value=!0;const o=await De(r.value);$.value=o.rows,C.value=o.total,_.value=!1},y=()=>{r.value.pageNum=1,f()},Q=()=>{var o;(o=S.value)==null||o.resetFields(),y()},j=o=>{L.value=o.map(s=>s.id),A.value=o.length!=1,F.value=!o.length},x=()=>{e.$tab.closePage(e.$route),e.$router.push({path:"/workflow/leaveEdit/index",query:{type:"add"}})},G=o=>{e.$tab.closePage(e.$route),e.$router.push({path:"/workflow/leaveEdit/index",query:{id:o.id,type:"update"}})},M=o=>{e.$tab.closePage(e.$route),e.$router.push({path:"/workflow/leaveEdit/index",query:{id:o.id,type:"view"}})},Y=async o=>{const s=(o==null?void 0:o.id)||L.value;await(e==null?void 0:e.$modal.confirm('是否确认删除请假编号为"'+s+'"的数据项？').finally(()=>_.value=!1)),await Ee(s),e==null||e.$modal.msgSuccess("删除成功"),await f()},Z=()=>{e==null||e.download("workflow/leave/export",{...r.value},`leave_${new Date().getTime()}.xlsx`)},H=async o=>{await(e==null?void 0:e.$modal.confirm("是否确认撤销当前单据？")),_.value=!0,await $e(o).finally(()=>_.value=!1),await f(),e==null||e.$modal.msgSuccess("撤销成功")};return re(()=>{f()}),(o,s)=>{var T,N;const V=pe,h=be,u=_e,J=Ce,P=Le,O=ke,W=Se,c=ge,X=fe,ee=he,ae=ye,te=we,le=Ve,k=ie("hasPermi"),oe=ve;return m(),ue("div",Pe,[t(ce,{"enter-active-class":(T=n(e))==null?void 0:T.animate.searchAnimate.enter,"leave-active-class":(N=n(e))==null?void 0:N.animate.searchAnimate.leave},{default:l(()=>[p(D("div",Te,[t(J,{ref_key:"queryFormRef",ref:S,model:n(r),inline:!0},{default:l(()=>[t(h,{label:"请假天数",prop:"startLeaveDays"},{default:l(()=>[t(V,{modelValue:n(r).startLeaveDays,"onUpdate:modelValue":s[0]||(s[0]=a=>n(r).startLeaveDays=a),placeholder:"请输入请假天数",clearable:"",onKeyup:z(y,["enter"])},null,8,["modelValue"])]),_:1}),t(h,{prop:"endLeaveDays"},{default:l(()=>[i(" 至 ")]),_:1}),t(h,{prop:"endLeaveDays"},{default:l(()=>[t(V,{modelValue:n(r).endLeaveDays,"onUpdate:modelValue":s[1]||(s[1]=a=>n(r).endLeaveDays=a),placeholder:"请输入请假天数",clearable:"",onKeyup:z(y,["enter"])},null,8,["modelValue"])]),_:1}),t(h,null,{default:l(()=>[t(u,{type:"primary",icon:"Search",onClick:y},{default:l(()=>[i("搜索")]),_:1}),t(u,{icon:"Refresh",onClick:Q},{default:l(()=>[i("重置")]),_:1})]),_:1})]),_:1},8,["model"])],512),[[B,n(g)]])]),_:1},8,["enter-active-class","leave-active-class"]),t(le,{shadow:"never"},{header:l(()=>[t(W,{gutter:10,class:"mb8"},{default:l(()=>[t(P,{span:1.5},{default:l(()=>[p((m(),w(u,{type:"primary",plain:"",icon:"Plus",onClick:x},{default:l(()=>[i("新增")]),_:1})),[[k,["workflow:leave:add"]]])]),_:1}),t(P,{span:1.5},{default:l(()=>[p((m(),w(u,{type:"warning",plain:"",icon:"Download",onClick:Z},{default:l(()=>[i("导出")]),_:1})),[[k,["workflow:leave:export"]]])]),_:1}),t(O,{showSearch:n(g),"onUpdate:showSearch":s[2]||(s[2]=a=>de(g)?g.value=a:null),onQueryTable:f},null,8,["showSearch"])]),_:1})]),default:l(()=>[p((m(),w(ae,{data:n($),onSelectionChange:j},{default:l(()=>[t(c,{type:"selection",width:"55",align:"center"}),b("",!0),t(c,{label:"请假类型",align:"center"},{default:l(a=>[t(X,null,{default:l(()=>{var v;return[i(E((v=I.find(ne=>ne.value===a.row.leaveType))==null?void 0:v.label),1)]}),_:2},1024)]),_:1}),t(c,{label:"开始时间",align:"center",prop:"startDate"},{default:l(a=>[D("span",null,E(o.parseTime(a.row.startDate,"{y}-{m}-{d}")),1)]),_:1}),t(c,{label:"结束时间",align:"center",prop:"endDate"},{default:l(a=>[D("span",null,E(o.parseTime(a.row.endDate,"{y}-{m}-{d}")),1)]),_:1}),t(c,{label:"请假天数",align:"center",prop:"leaveDays"}),t(c,{label:"请假原因",align:"center",prop:"remark"}),t(c,{align:"center",label:"流程状态","min-width":"70"},{default:l(a=>[t(ee,{options:n(U),value:a.row.status},null,8,["options","value"])]),_:1}),t(c,{label:"操作",align:"center","class-name":"small-padding fixed-width"},{default:l(a=>[a.row.status==="draft"||a.row.status==="cancel"||a.row.status==="back"?p((m(),w(u,{key:0,size:"small",link:"",type:"primary",icon:"Edit",onClick:v=>G(a.row)},{default:l(()=>[i("修改")]),_:2},1032,["onClick"])),[[k,["workflow:leave:edit"]]]):b("",!0),a.row.status==="draft"||a.row.status==="cancel"||a.row.status==="back"?p((m(),w(u,{key:1,size:"small",link:"",type:"primary",icon:"Delete",onClick:v=>Y(a.row)},{default:l(()=>[i("删除")]),_:2},1032,["onClick"])),[[k,["workflow:leave:remove"]]]):b("",!0),t(u,{link:"",type:"primary",size:"small",icon:"View",onClick:v=>M(a.row)},{default:l(()=>[i("查看")]),_:2},1032,["onClick"]),a.row.status==="waiting"?(m(),w(u,{key:2,link:"",size:"small",type:"primary",icon:"Notification",onClick:v=>H(a.row.id)},{default:l(()=>[i("撤销")]),_:2},1032,["onClick"])):b("",!0)]),_:1})]),_:1},8,["data"])),[[oe,n(_)]]),p(t(te,{page:n(r).pageNum,"onUpdate:page":s[3]||(s[3]=a=>n(r).pageNum=a),limit:n(r).pageSize,"onUpdate:limit":s[4]||(s[4]=a=>n(r).pageSize=a),total:n(C),onPagination:f},null,8,["page","limit","total"]),[[B,n(C)>0]])]),_:1})])}}});export{Xe as default};
