import{r as u,d as fe,Y as ve,O as ge,b3 as _e,i as he,J as O,o as U,c as Q,j as l,k as o,y as w,e as a,X as be,a0 as ke,w as H,m as P,x as X,W as j,cX as we,Q as G,F as ye,q as xe,p as Ce,R as Ie,n as Ne,G as Re,I as Ee,a9 as Ve,U as Se}from"./index-DDAliqzK.js";/* empty css               */import{_ as De}from"./index-RdVOGMqm.js";import{_ as Te}from"./index-cbmq-Xhe.js";import{E as Ue,a as Be}from"./el-form-item-Dtm-Ic1o.js";/* empty css               *//* empty css                *//* empty css                */import"./el-checkbox-BucE91Wb.js";import{b as B}from"./index-CmqILhzb.js";import{E as Fe}from"./index-CSfZWYHi.js";import{E as Ae}from"./index-x58AzXEe.js";import{E as Le}from"./index-CokWeuRK.js";import{E as qe}from"./index-D7RFStbC.js";const Ke=I=>{const _=u(!1);return{title:u(I.title||""),visible:_,openDialog:()=>{_.value=!0},closeDialog:()=>{_.value=!1}}},ze={class:"mb-[10px]"},lt=fe({__name:"index",props:{modelValue:{default:void 0},multiple:{type:Boolean,default:!0},data:{default:void 0}},emits:["update:modelValue","confirmCallBack"],setup(I,{expose:_,emit:F}){const h=I,N=F,{proxy:c}=Ie(),{sys_normal_disable:J}=ve(c==null?void 0:c.useDict("sys_normal_disable")),b=u(),R=u(!0),W=u(!0),E=u(0),A=u(["",""]),y=u(""),L=u([]),s=u([]),V=u(),q=u(),p=u(),d=Ke({title:"用户选择"}),i=u({pageNum:1,pageSize:10,userName:"",phonenumber:"",status:"",deptId:"",roleId:""}),S=ge(()=>$(h.data));_e(()=>{var t;(t=V.value)==null||t.filter(y.value)},{flush:"post"});const Y=()=>{N("update:modelValue",s.value),N("confirmCallBack",s.value),d.closeDialog()},$=t=>t instanceof Array?[...t]:typeof t=="string"?t.split(","):typeof t=="number"?[t]:(console.warn("<UserSelect> The data type of data should be array or string or number, but I received other"),[]),M=(t,e)=>t?e.label.indexOf(t)!==-1:!0,Z=async()=>{const t=await B.deptTreeSelect();L.value=t.data},D=async()=>{R.value=!0;const t=await B.listUser(c==null?void 0:c.addDateRange(i.value,A.value));R.value=!1,b.value=t.rows,E.value=t.total},ee=async()=>{await D();const t=b.value.filter(e=>s.value.some(n=>n.userId===e.userId));await p.value.setCheckboxRow(t,!0)},te=t=>{i.value.deptId=t.id,k()},k=()=>{i.value.pageNum=1,D()},K=(t=!0)=>{var e,n;A.value=["",""],(e=q.value)==null||e.resetFields(),i.value.pageNum=1,i.value.deptId=void 0,(n=V.value)==null||n.setCurrentKey(void 0),t&&k()},le=t=>{!h.multiple&&t.checked&&(p.value.setCheckboxRow(s.value,!1),s.value=[]);const e=t.row;t.checked?s.value.push(e):s.value=s.value.filter(n=>n.userId!==e.userId)},ae=t=>{const e=b.value;t.checked?e.forEach(n=>{s.value.some(f=>f.userId===n.userId)||s.value.push(n)}):s.value=s.value.filter(n=>!e.some(f=>f.userId===n.userId))},oe=t=>{var v;const e=t.userId,n=s.value.findIndex(x=>x.userId===e),f=s.value[n];(v=p.value)==null||v.setCheckboxRow(f,!1),s.value.splice(n,1)},ne=async()=>{if(S.value.length>0){const{data:t}=await B.optionSelect(S.value);s.value=t;const e=b.value.filter(n=>S.value.includes(String(n.userId)));await Ne(()=>{p.value.setCheckboxRow(e,!0)})}},se=()=>{d.closeDialog()};return he(()=>d.visible.value,async t=>{t?(await Z(),await D(),await ne()):(p.value.clearCheckboxReserve(),p.value.clearCheckboxRow(),K(!1),s.value=[])}),_({open:d.openDialog,close:d.closeDialog}),(t,e)=>{const n=Re,f=Fe,v=Ae,x=Le,T=Ue,C=Ee,re=Be,ie=Ve,m=O("vxe-column"),ue=Te,ce=O("vxe-table"),de=De,me=qe,pe=Se;return U(),Q("div",null,[l(pe,{modelValue:a(d).visible.value,"onUpdate:modelValue":e[6]||(e[6]=g=>a(d).visible.value=g),title:a(d).title.value,width:"80%","append-to-body":""},{footer:o(()=>[l(C,{onClick:se},{default:o(()=>e[9]||(e[9]=[w("取消")])),_:1}),l(C,{type:"primary",onClick:Y},{default:o(()=>e[10]||(e[10]=[w("确定")])),_:1})]),default:o(()=>[l(me,{gutter:20},{default:o(()=>[l(x,{lg:4,xs:24,style:{}},{default:o(()=>[l(v,{shadow:"hover"},{default:o(()=>[l(n,{modelValue:a(y),"onUpdate:modelValue":e[0]||(e[0]=g=>be(y)?y.value=g:null),placeholder:"请输入部门名称","prefix-icon":"Search",clearable:""},null,8,["modelValue"]),l(f,{ref_key:"deptTreeRef",ref:V,class:"mt-2","node-key":"id",data:a(L),props:{label:"label",children:"children"},"expand-on-click-node":!1,"filter-node-method":M,"highlight-current":"","default-expand-all":"",onNodeClick:te},null,8,["data"])]),_:1})]),_:1}),l(x,{lg:20,xs:24},{default:o(()=>{var g,z;return[l(ke,{"enter-active-class":(g=a(c))==null?void 0:g.animate.searchAnimate.enter,"leave-active-class":(z=a(c))==null?void 0:z.animate.searchAnimate.leave},{default:o(()=>[H(P("div",ze,[l(v,{shadow:"hover"},{default:o(()=>[l(re,{ref_key:"queryFormRef",ref:q,model:a(i),inline:!0},{default:o(()=>[l(T,{label:"用户名称",prop:"userName"},{default:o(()=>[l(n,{modelValue:a(i).userName,"onUpdate:modelValue":e[1]||(e[1]=r=>a(i).userName=r),placeholder:"请输入用户名称",clearable:"",onKeyup:X(k,["enter"])},null,8,["modelValue"])]),_:1}),l(T,{label:"手机号码",prop:"phonenumber"},{default:o(()=>[l(n,{modelValue:a(i).phonenumber,"onUpdate:modelValue":e[2]||(e[2]=r=>a(i).phonenumber=r),placeholder:"请输入手机号码",clearable:"",onKeyup:X(k,["enter"])},null,8,["modelValue"])]),_:1}),l(T,null,{default:o(()=>[l(C,{type:"primary",icon:"Search",onClick:k},{default:o(()=>e[7]||(e[7]=[w("搜索")])),_:1}),l(C,{icon:"Refresh",onClick:e[3]||(e[3]=()=>K())},{default:o(()=>e[8]||(e[8]=[w("重置")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1})],512),[[j,a(W)]])]),_:1},8,["enter-active-class","leave-active-class"]),l(v,{shadow:"hover"},we({default:o(()=>[l(ce,{ref_key:"tableRef",ref:p,height:"400px",border:"","show-overflow":"",data:a(b),loading:a(R),"row-config":{keyField:"userId",isHover:!0},"checkbox-config":{reserve:!0,trigger:"row",highlight:!0,showHeader:h.multiple},onCheckboxAll:ae,onCheckboxChange:le},{default:o(()=>[l(m,{type:"checkbox",width:"50",align:"center"}),l(m,{key:"userId",title:"用户编号",align:"center",field:"userId"}),l(m,{key:"userName",title:"用户名称",align:"center",field:"userName"}),l(m,{key:"nickName",title:"用户昵称",align:"center",field:"nickName"}),l(m,{key:"deptName",title:"部门",align:"center",field:"deptName"}),l(m,{key:"phonenumber",title:"手机号码",align:"center",field:"phonenumber",width:"120"}),l(m,{key:"status",title:"状态",align:"center"},{default:o(r=>[l(ue,{options:a(J),value:r.row.status},null,8,["options","value"])]),_:1}),l(m,{title:"创建时间",align:"center",width:"160"},{default:o(r=>[P("span",null,G(r.row.createTime),1)]),_:1})]),_:1},8,["data","loading","checkbox-config"]),H(l(de,{page:a(i).pageNum,"onUpdate:page":e[4]||(e[4]=r=>a(i).pageNum=r),limit:a(i).pageSize,"onUpdate:limit":e[5]||(e[5]=r=>a(i).pageSize=r),total:a(E),onPagination:ee},null,8,["page","limit","total"]),[[j,a(E)>0]])]),_:2},[h.multiple?{name:"header",fn:o(()=>[(U(!0),Q(ye,null,xe(a(s),r=>(U(),Ce(ie,{key:r.userId,closable:"",style:{margin:"2px"},onClose:Oe=>oe(r)},{default:o(()=>[w(G(r.userName),1)]),_:2},1032,["onClose"]))),128))]),key:"0"}:void 0]),1024)]}),_:1})]),_:1})]),_:1},8,["modelValue","title"])])}}});export{lt as _,Ke as u};
