import{r as u,d as fe,$ as ve,Q as _e,b5 as ge,i as he,J as Q,o as U,c as H,j as l,k as o,y as w,e as a,Z as be,a2 as ke,w as O,x as P,t as Z,Y as $,cZ as we,R as j,F as ye,p as xe,m as Ce,T as Ie,n as Ne,G as Re,I as Ee,ab as Ve,W as Se}from"./index-_v2uieGc.js";/* empty css               */import{_ as De}from"./index-B7XPQ3lw.js";import{_ as Te}from"./index-DXIR9_gV.js";import{E as Ue,a as Be}from"./el-form-item-BZcdB44L.js";/* empty css               *//* empty css                *//* empty css                */import"./el-checkbox-C6h3hzMD.js";import{b as B}from"./index-B43E_f47.js";import{E as Fe}from"./index-BFoUAo4m.js";import{E as Ae}from"./index-ctcZQfix.js";import{E as Le}from"./index-7OoO_SlU.js";import{E as Ke}from"./index-DJNwvRpE.js";const qe=I=>{const g=u(!1);return{title:u(I.title||""),visible:g,openDialog:()=>{g.value=!0},closeDialog:()=>{g.value=!1}}},ze={class:"mb-[10px]"},lt=fe({__name:"index",props:{modelValue:{default:void 0},multiple:{type:Boolean,default:!0},data:{default:void 0}},emits:["update:modelValue","confirmCallBack"],setup(I,{expose:g,emit:F}){const h=I,N=F,{proxy:c}=Ie(),{sys_normal_disable:G}=ve(c==null?void 0:c.useDict("sys_normal_disable")),b=u(),R=u(!0),J=u(!0),E=u(0),A=u(["",""]),y=u(""),L=u([]),s=u([]),V=u(),K=u(),p=u(),d=qe({title:"用户选择"}),i=u({pageNum:1,pageSize:10,userName:"",phonenumber:"",status:"",deptId:"",roleId:""}),S=_e(()=>Y(h.data));ge(()=>{var e;(e=V.value)==null||e.filter(y.value)},{flush:"post"});const W=()=>{N("update:modelValue",s.value),N("confirmCallBack",s.value),d.closeDialog()},Y=e=>e instanceof Array?[...e]:typeof e=="string"?e.split(","):typeof e=="number"?[e]:(console.warn("<UserSelect> The data type of data should be array or string or number, but I received other"),[]),M=(e,t)=>e?t.label.indexOf(e)!==-1:!0,X=async()=>{const e=await B.deptTreeSelect();L.value=e.data},D=async()=>{R.value=!0;const e=await B.listUser(c==null?void 0:c.addDateRange(i.value,A.value));R.value=!1,b.value=e.rows,E.value=e.total},ee=async()=>{await D();const e=b.value.filter(t=>s.value.some(n=>n.userId===t.userId));await p.value.setCheckboxRow(e,!0)},te=e=>{i.value.deptId=e.id,k()},k=()=>{i.value.pageNum=1,D()},q=(e=!0)=>{var t,n;A.value=["",""],(t=K.value)==null||t.resetFields(),i.value.pageNum=1,i.value.deptId=void 0,(n=V.value)==null||n.setCurrentKey(void 0),e&&k()},le=e=>{!h.multiple&&e.checked&&(p.value.setCheckboxRow(s.value,!1),s.value=[]);const t=e.row;e.checked?s.value.push(t):s.value=s.value.filter(n=>n.userId!==t.userId)},ae=e=>{const t=b.value;e.checked?t.forEach(n=>{s.value.some(f=>f.userId===n.userId)||s.value.push(n)}):s.value=s.value.filter(n=>!t.some(f=>f.userId===n.userId))},oe=e=>{var v;const t=e.userId,n=s.value.findIndex(x=>x.userId===t),f=s.value[n];(v=p.value)==null||v.setCheckboxRow(f,!1),s.value.splice(n,1)},ne=async()=>{if(S.value.length>0){const{data:e}=await B.optionSelect(S.value);s.value=e;const t=b.value.filter(n=>S.value.includes(String(n.userId)));await Ne(()=>{p.value.setCheckboxRow(t,!0)})}},se=()=>{d.closeDialog()};return he(()=>d.visible.value,async e=>{e?(await X(),await D(),await ne()):(p.value.clearCheckboxReserve(),p.value.clearCheckboxRow(),q(!1),s.value=[])}),g({open:d.openDialog,close:d.closeDialog}),(e,t)=>{const n=Re,f=Fe,v=Ae,x=Le,T=Ue,C=Ee,re=Be,ie=Ve,m=Q("vxe-column"),ue=Te,ce=Q("vxe-table"),de=De,me=Ke,pe=Se;return U(),H("div",null,[l(pe,{modelValue:a(d).visible.value,"onUpdate:modelValue":t[6]||(t[6]=_=>a(d).visible.value=_),title:a(d).title.value,width:"80%","append-to-body":""},{footer:o(()=>[l(C,{onClick:se},{default:o(()=>[w("取消")]),_:1}),l(C,{type:"primary",onClick:W},{default:o(()=>[w("确定")]),_:1})]),default:o(()=>[l(me,{gutter:20},{default:o(()=>[l(x,{lg:4,xs:24,style:{}},{default:o(()=>[l(v,{shadow:"hover"},{default:o(()=>[l(n,{modelValue:a(y),"onUpdate:modelValue":t[0]||(t[0]=_=>be(y)?y.value=_:null),placeholder:"请输入部门名称","prefix-icon":"Search",clearable:""},null,8,["modelValue"]),l(f,{ref_key:"deptTreeRef",ref:V,class:"mt-2","node-key":"id",data:a(L),props:{label:"label",children:"children"},"expand-on-click-node":!1,"filter-node-method":M,"highlight-current":"","default-expand-all":"",onNodeClick:te},null,8,["data"])]),_:1})]),_:1}),l(x,{lg:20,xs:24},{default:o(()=>{var _,z;return[l(ke,{"enter-active-class":(_=a(c))==null?void 0:_.animate.searchAnimate.enter,"leave-active-class":(z=a(c))==null?void 0:z.animate.searchAnimate.leave},{default:o(()=>[O(P("div",ze,[l(v,{shadow:"hover"},{default:o(()=>[l(re,{ref_key:"queryFormRef",ref:K,model:a(i),inline:!0},{default:o(()=>[l(T,{label:"用户名称",prop:"userName"},{default:o(()=>[l(n,{modelValue:a(i).userName,"onUpdate:modelValue":t[1]||(t[1]=r=>a(i).userName=r),placeholder:"请输入用户名称",clearable:"",onKeyup:Z(k,["enter"])},null,8,["modelValue"])]),_:1}),l(T,{label:"手机号码",prop:"phonenumber"},{default:o(()=>[l(n,{modelValue:a(i).phonenumber,"onUpdate:modelValue":t[2]||(t[2]=r=>a(i).phonenumber=r),placeholder:"请输入手机号码",clearable:"",onKeyup:Z(k,["enter"])},null,8,["modelValue"])]),_:1}),l(T,null,{default:o(()=>[l(C,{type:"primary",icon:"Search",onClick:k},{default:o(()=>[w("搜索")]),_:1}),l(C,{icon:"Refresh",onClick:t[3]||(t[3]=()=>q())},{default:o(()=>[w("重置")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})],512),[[$,a(J)]])]),_:1},8,["enter-active-class","leave-active-class"]),l(v,{shadow:"hover"},we({default:o(()=>[l(ce,{ref_key:"tableRef",ref:p,height:"400px",border:"","show-overflow":"",data:a(b),loading:a(R),"row-config":{keyField:"userId",isHover:!0},"checkbox-config":{reserve:!0,trigger:"row",highlight:!0,showHeader:h.multiple},onCheckboxAll:ae,onCheckboxChange:le},{default:o(()=>[l(m,{type:"checkbox",width:"50",align:"center"}),l(m,{key:"userId",title:"用户编号",align:"center",field:"userId"}),l(m,{key:"userName",title:"用户名称",align:"center",field:"userName"}),l(m,{key:"nickName",title:"用户昵称",align:"center",field:"nickName"}),l(m,{key:"deptName",title:"部门",align:"center",field:"deptName"}),l(m,{key:"phonenumber",title:"手机号码",align:"center",field:"phonenumber",width:"120"}),l(m,{key:"status",title:"状态",align:"center"},{default:o(r=>[l(ue,{options:a(G),value:r.row.status},null,8,["options","value"])]),_:1}),l(m,{title:"创建时间",align:"center",width:"160"},{default:o(r=>[P("span",null,j(r.row.createTime),1)]),_:1})]),_:1},8,["data","loading","checkbox-config"]),O(l(de,{page:a(i).pageNum,"onUpdate:page":t[4]||(t[4]=r=>a(i).pageNum=r),limit:a(i).pageSize,"onUpdate:limit":t[5]||(t[5]=r=>a(i).pageSize=r),total:a(E),onPagination:ee},null,8,["page","limit","total"]),[[$,a(E)>0]])]),_:2},[h.multiple?{name:"header",fn:o(()=>[(U(!0),H(ye,null,xe(a(s),r=>(U(),Ce(ie,{key:r.userId,closable:"",style:{margin:"2px"},onClose:Qe=>oe(r)},{default:o(()=>[w(j(r.userName),1)]),_:2},1032,["onClose"]))),128))]),key:"0"}:void 0]),1024)]}),_:1})]),_:1})]),_:1},8,["modelValue","title"])])}}});export{lt as _,qe as u};
